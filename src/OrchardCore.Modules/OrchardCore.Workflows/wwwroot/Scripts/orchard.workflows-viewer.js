/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
var WorkflowCanvas = /** @class */function () {
  function WorkflowCanvas(container, workflowType) {
    var _this = this;
    this.container = container;
    this.workflowType = workflowType;
    this.minCanvasHeight = 400;
    this.getActivityElements = function () {
      return $(_this.container).find('.activity');
    };
    this.getDefaults = function () {
      return {
        Anchor: "Continuous",
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        EndpointStyles: [{
          fillStyle: '#225588'
        }],
        Endpoints: [["Dot", {
          radius: 7
        }], ["Blank"]],
        ConnectionOverlays: [["Arrow", {
          width: 12,
          length: 12,
          location: -5
        }]],
        ConnectorZIndex: 5
      };
    };
    this.createJsPlumbInstance = function () {
      return jsPlumb.getInstance({
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        ConnectionOverlays: [['Arrow', {
          location: 1,
          visible: true,
          width: 11,
          length: 11
        }], ['Label', {
          location: 0.5,
          id: 'label',
          cssClass: 'connection-label'
        }]],
        Container: _this.container
      });
    };
    this.getEndpointColor = function (activity) {
      return activity.isBlocking || activity.isStart ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };
    this.getSourceEndpointOptions = function (activity, outcome) {
      // The definition of source endpoints.
      var paintColor = _this.getEndpointColor(activity);
      return {
        endpoint: 'Dot',
        anchor: 'Continuous',
        paintStyle: {
          stroke: paintColor,
          fill: paintColor,
          radius: 7,
          strokeWidth: 1
        },
        isSource: true,
        connector: ['Flowchart', {
          stub: [40, 60],
          gap: 0,
          cornerRadius: 5,
          alwaysRespectStubs: true
        }],
        connectorStyle: {
          strokeWidth: 2,
          stroke: '#999999',
          joinstyle: 'round',
          outlineStroke: 'white',
          outlineWidth: 2
        },
        hoverPaintStyle: {
          fill: '#216477',
          stroke: '#216477'
        },
        connectorHoverStyle: {
          strokeWidth: 3,
          stroke: '#216477',
          outlineWidth: 5,
          outlineStroke: 'white'
        },
        connectorOverlays: [['Label', {
          location: [3, -1.5],
          cssClass: 'endpointSourceLabel'
        }]],
        dragOptions: {},
        uuid: "".concat(activity.id, "-").concat(outcome.name),
        parameters: {
          outcome: outcome
        }
      };
    };
    this.getActivity = function (id, activities) {
      if (activities === void 0) {
        activities = null;
      }
      if (!activities) {
        activities = this.workflowType.activities;
      }
      return $.grep(activities, function (x) {
        return x.id === id;
      })[0];
    };
    this.updateConnections = function (plumber) {
      var workflowId = _this.workflowType.id;
      // Connect activities.
      for (var _i = 0, _a = _this.workflowType.transitions; _i < _a.length; _i++) {
        var transitionModel = _a[_i];
        var sourceEndpointUuid = "".concat(transitionModel.sourceActivityId, "-").concat(transitionModel.sourceOutcomeName);
        var sourceEndpoint = plumber.getEndpoint(sourceEndpointUuid);
        var destinationElementId = "activity-".concat(workflowId, "-").concat(transitionModel.destinationActivityId);
        plumber.connect({
          source: sourceEndpoint,
          target: destinationElementId
        });
      }
    };
    this.updateCanvasHeight = function () {
      var $container = $(this.container);
      // Get the activity element with the highest Y coordinate.
      var $activityElements = $container.find(".activity");
      var currentElementTop = 0;
      var currentActivityHeight = 0;
      for (var _i = 0, _a = $activityElements.toArray(); _i < _a.length; _i++) {
        var activityElement = _a[_i];
        var $activityElement = $(activityElement);
        var top_1 = $activityElement.position().top;
        if (top_1 > currentElementTop) {
          currentElementTop = top_1;
          currentActivityHeight = $activityElement.height();
        }
      }
      var newCanvasHeight = currentElementTop + currentActivityHeight;
      var elementBottom = currentElementTop + currentActivityHeight;
      var stretchValue = 100;
      if (newCanvasHeight - elementBottom <= stretchValue) {
        newCanvasHeight += stretchValue;
      }
      $container.height(Math.max(this.minCanvasHeight, newCanvasHeight));
    };
  }
  return WorkflowCanvas;
}();
///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
///<reference path='./workflow-canvas.ts' />
var __extends = this && this.__extends || function () {
  var _extendStatics = function extendStatics(d, b) {
    _extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) {
        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
      }
    };
    return _extendStatics(d, b);
  };
  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    _extendStatics(d, b);
    function __() {
      this.constructor = d;
    }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();
var WorkflowViewer = /** @class */function (_super) {
  __extends(WorkflowViewer, _super);
  function WorkflowViewer(container, workflowType) {
    var _this = _super.call(this, container, workflowType) || this;
    _this.container = container;
    _this.workflowType = workflowType;
    _this.getEndpointColor = function (activity) {
      return activity.isBlocking ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };
    var self = _this;
    jsPlumb.ready(function () {
      jsPlumb.importDefaults(_this.getDefaults());
      var plumber = _this.createJsPlumbInstance();
      // Listen for new connections.
      plumber.bind('connection', function (connInfo, originalEvent) {
        var connection = connInfo.connection;
        var outcome = connection.getParameters().outcome;
        var label = connection.getOverlay('label');
        label.setLabel(outcome.displayName);
      });
      var activityElements = _this.getActivityElements();
      var areEqualOutcomes = function areEqualOutcomes(outcomes1, outcomes2) {
        if (outcomes1.length != outcomes2.length) {
          return false;
        }
        for (var i = 0; i < outcomes1.length; i++) {
          var outcome1 = outcomes1[i];
          var outcome2 = outcomes2[i];
          if (outcome1.name != outcome2.displayName || outcome1.displayName != outcome2.displayName) {
            return false;
          }
        }
        return true;
      };
      // Suspend drawing and initialize.
      plumber.batch(function () {
        var workflowId = _this.workflowType.id;
        activityElements.each(function (index, activityElement) {
          var $activityElement = $(activityElement);
          var activityId = $activityElement.data('activity-id');
          var activity = _this.getActivity(activityId);
          // Configure the activity as a target.
          plumber.makeTarget(activityElement, {
            dropOptions: {
              hoverClass: 'hover'
            },
            anchor: 'Continuous',
            endpoint: ['Blank', {
              radius: 8
            }]
          });
          // Add source endpoints.
          for (var _i = 0, _a = activity.outcomes; _i < _a.length; _i++) {
            var outcome = _a[_i];
            var sourceEndpointOptions = _this.getSourceEndpointOptions(activity, outcome);
            plumber.addEndpoint(activityElement, {
              connectorOverlays: [['Label', {
                label: outcome.displayName,
                cssClass: 'connection-label'
              }]]
            }, sourceEndpointOptions);
          }
        });
        // Connect activities.
        _this.updateConnections(plumber);
        // Re-query the activity elements.
        activityElements = _this.getActivityElements();
        // Make all activity elements visible.
        activityElements.show();
        _this.updateCanvasHeight();
      });
      _this.jsPlumbInstance = plumber;
    });
    return _this;
  }
  return WorkflowViewer;
}(WorkflowCanvas);
$.fn.workflowViewer = function () {
  this.each(function (index, element) {
    var $element = $(element);
    var workflowType = $element.data('workflow-type');
    $element.data('workflowViewer', new WorkflowViewer(element, workflowType));
  });
  return this;
};
$(document).ready(function () {
  var workflowViewer = $('.workflow-canvas').workflowViewer().data('workflowViewer');
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndvcmtmbG93LWNhbnZhcy50cyIsIndvcmtmbG93LWNhbnZhcy5qcyIsIndvcmtmbG93LXZpZXdlci50cyIsIndvcmtmbG93LXZpZXdlci5qcyJdLCJuYW1lcyI6WyJXb3JrZmxvd0NhbnZhcyIsImNvbnRhaW5lciIsIndvcmtmbG93VHlwZSIsIl90aGlzIiwibWluQ2FudmFzSGVpZ2h0IiwiZ2V0QWN0aXZpdHlFbGVtZW50cyIsIiQiLCJmaW5kIiwiZ2V0RGVmYXVsdHMiLCJBbmNob3IiLCJEcmFnT3B0aW9ucyIsImN1cnNvciIsInpJbmRleCIsIkVuZHBvaW50U3R5bGVzIiwiZmlsbFN0eWxlIiwiRW5kcG9pbnRzIiwicmFkaXVzIiwiQ29ubmVjdGlvbk92ZXJsYXlzIiwid2lkdGgiLCJsZW5ndGgiLCJsb2NhdGlvbiIsIkNvbm5lY3RvclpJbmRleCIsImNyZWF0ZUpzUGx1bWJJbnN0YW5jZSIsImpzUGx1bWIiLCJnZXRJbnN0YW5jZSIsInZpc2libGUiLCJpZCIsImNzc0NsYXNzIiwiQ29udGFpbmVyIiwiZ2V0RW5kcG9pbnRDb2xvciIsImFjdGl2aXR5IiwiaXNCbG9ja2luZyIsImlzU3RhcnQiLCJpc0V2ZW50IiwiZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zIiwib3V0Y29tZSIsInBhaW50Q29sb3IiLCJlbmRwb2ludCIsImFuY2hvciIsInBhaW50U3R5bGUiLCJzdHJva2UiLCJmaWxsIiwic3Ryb2tlV2lkdGgiLCJpc1NvdXJjZSIsImNvbm5lY3RvciIsInN0dWIiLCJnYXAiLCJjb3JuZXJSYWRpdXMiLCJhbHdheXNSZXNwZWN0U3R1YnMiLCJjb25uZWN0b3JTdHlsZSIsImpvaW5zdHlsZSIsIm91dGxpbmVTdHJva2UiLCJvdXRsaW5lV2lkdGgiLCJob3ZlclBhaW50U3R5bGUiLCJjb25uZWN0b3JIb3ZlclN0eWxlIiwiY29ubmVjdG9yT3ZlcmxheXMiLCJkcmFnT3B0aW9ucyIsInV1aWQiLCJjb25jYXQiLCJuYW1lIiwicGFyYW1ldGVycyIsImdldEFjdGl2aXR5IiwiYWN0aXZpdGllcyIsImdyZXAiLCJ4IiwidXBkYXRlQ29ubmVjdGlvbnMiLCJwbHVtYmVyIiwid29ya2Zsb3dJZCIsIl9pIiwiX2EiLCJ0cmFuc2l0aW9ucyIsInRyYW5zaXRpb25Nb2RlbCIsInNvdXJjZUVuZHBvaW50VXVpZCIsInNvdXJjZUFjdGl2aXR5SWQiLCJzb3VyY2VPdXRjb21lTmFtZSIsInNvdXJjZUVuZHBvaW50IiwiZ2V0RW5kcG9pbnQiLCJkZXN0aW5hdGlvbkVsZW1lbnRJZCIsImRlc3RpbmF0aW9uQWN0aXZpdHlJZCIsImNvbm5lY3QiLCJzb3VyY2UiLCJ0YXJnZXQiLCJ1cGRhdGVDYW52YXNIZWlnaHQiLCIkY29udGFpbmVyIiwiJGFjdGl2aXR5RWxlbWVudHMiLCJjdXJyZW50RWxlbWVudFRvcCIsImN1cnJlbnRBY3Rpdml0eUhlaWdodCIsInRvQXJyYXkiLCJhY3Rpdml0eUVsZW1lbnQiLCIkYWN0aXZpdHlFbGVtZW50IiwidG9wXzEiLCJwb3NpdGlvbiIsInRvcCIsImhlaWdodCIsIm5ld0NhbnZhc0hlaWdodCIsImVsZW1lbnRCb3R0b20iLCJzdHJldGNoVmFsdWUiLCJNYXRoIiwibWF4IiwiX19leHRlbmRzIiwiZXh0ZW5kU3RhdGljcyIsImQiLCJiIiwiT2JqZWN0Iiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJBcnJheSIsInAiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJUeXBlRXJyb3IiLCJTdHJpbmciLCJfXyIsImNvbnN0cnVjdG9yIiwiY3JlYXRlIiwiV29ya2Zsb3dWaWV3ZXIiLCJfc3VwZXIiLCJzZWxmIiwicmVhZHkiLCJpbXBvcnREZWZhdWx0cyIsImJpbmQiLCJjb25uSW5mbyIsIm9yaWdpbmFsRXZlbnQiLCJjb25uZWN0aW9uIiwiZ2V0UGFyYW1ldGVycyIsImxhYmVsIiwiZ2V0T3ZlcmxheSIsInNldExhYmVsIiwiZGlzcGxheU5hbWUiLCJhY3Rpdml0eUVsZW1lbnRzIiwiYXJlRXF1YWxPdXRjb21lcyIsIm91dGNvbWVzMSIsIm91dGNvbWVzMiIsImkiLCJvdXRjb21lMSIsIm91dGNvbWUyIiwiYmF0Y2giLCJlYWNoIiwiaW5kZXgiLCJhY3Rpdml0eUlkIiwiZGF0YSIsIm1ha2VUYXJnZXQiLCJkcm9wT3B0aW9ucyIsImhvdmVyQ2xhc3MiLCJvdXRjb21lcyIsInNvdXJjZUVuZHBvaW50T3B0aW9ucyIsImFkZEVuZHBvaW50Iiwic2hvdyIsImpzUGx1bWJJbnN0YW5jZSIsImZuIiwid29ya2Zsb3dWaWV3ZXIiLCJlbGVtZW50IiwiJGVsZW1lbnQiLCJkb2N1bWVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFFQSxJQUFBQSxjQUFBLEdBQUEsYUFBQSxZQUFBO0VBR0ksU0FBQUEsY0FBQSxDQUFzQkMsU0FBc0IsRUFBWUMsWUFBb0MsRUFBQTtJQUE1RixJQUFBQyxLQUFBLEdBQUEsSUFBQTtJQUFzQixJQUFBLENBQUFGLFNBQVMsR0FBVEEsU0FBUztJQUF5QixJQUFBLENBQUFDLFlBQVksR0FBWkEsWUFBWTtJQUY1RCxJQUFBLENBQUFFLGVBQWUsR0FBVyxHQUFHO0lBSzNCLElBQUEsQ0FBQUMsbUJBQW1CLEdBQUcsWUFBQTtNQUM1QixPQUFPQyxDQUFDLENBQUNILEtBQUksQ0FBQ0YsU0FBUyxDQUFDLENBQUNNLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDOUMsQ0FBQztJQUVTLElBQUEsQ0FBQUMsV0FBVyxHQUFHLFlBQUE7TUFDcEIsT0FBTztRQUNIQyxNQUFNLEVBQUUsWUFBWTtRQUNwQkMsV0FBVyxFQUFFO1VBQUVDLE1BQU0sRUFBRSxTQUFTO1VBQUVDLE1BQU0sRUFBRTtRQUFJLENBQUU7UUFDaERDLGNBQWMsRUFBRSxDQUFDO1VBQUVDLFNBQVMsRUFBRTtRQUFTLENBQUUsQ0FBQztRQUMxQ0MsU0FBUyxFQUFFLENBQUMsQ0FBQyxLQUFLLEVBQUU7VUFBRUMsTUFBTSxFQUFFO1FBQUMsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM5Q0Msa0JBQWtC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QkFBbUIsRUFBRTtRQUU3QztRQUNBNkgsZ0JBQWdCLENBQUNrQixJQUFJLEVBQUU7UUFFdkJqSixLQUFJLENBQUMrRSxrQkFBa0IsRUFBRTtNQUM3QixDQUFDLENBQUM7TUFFRi9FLEtBQUksQ0FBQ2tKLGVBQWUsR0FBR25GLE9BQU87SUFDbEMsQ0FBQyxDQUFDO0lDRUYsT0FBTy9ELEtBQUs7RUREaEI7RUFLSixPQUFBaUgsY0FBQztBQUFELENBbEZBLENBQTZCcEgsY0FBYyxDQUFBO0FBb0YzQ00sQ0FBQyxDQUFDZ0osRUFBRSxDQUFDQyxjQUFjLEdBQUcsWUFBQTtFQUNsQixJQUFJLENBQUNiLElBQUksQ0FBQyxVQUFDQyxLQUFLLEVBQUVhLE9BQU8sRUFBQTtJQUNyQixJQUFJQyxRQUFRLEdBQUduSixDQUFDLENBQUNrSixPQUFPLENBQUM7SUFDekIsSUFBSXRKLFlBQVksR0FBMkJ1SixRQUFRLENBQUNaLElBQUksQ0FBQyxlQUFlLENBQUM7SUFFekVZLFFBQVEsQ0FBQ1osSUFBSSxDQUFDLGdCQUFnQixFQUFFLElBQUl6QixjQUFjLENBQUNvQyxPQUFPLEVBQUV0SixZQUFZLENBQUMsQ0FBQztFQUM5RSxDQUFDLENBQUM7RUFFRixPQUFPLElBQUk7QUFDZixDQUFDO0FBRURJLENBQUMsQ0FBQ29KLFFBQVEsQ0FBQyxDQUFDbkMsS0FBSyxDQUFDLFlBQUE7RUFDZCxJQUFNZ0MsY0FBYyxHQUFtQmpKLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDaUosY0FBYyxFQUFFLENBQUNWLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztBQUN4RyxDQUFDLENBQUMiLCJmaWxlIjoib3JjaGFyZC53b3JrZmxvd3Mtdmlld2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50cycgLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanNwbHVtYi90eXBpbmdzLmQudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XHJcblxyXG5hYnN0cmFjdCBjbGFzcyBXb3JrZmxvd0NhbnZhcyB7XHJcbiAgICBwcml2YXRlIG1pbkNhbnZhc0hlaWdodDogbnVtYmVyID0gNDAwO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBjb250YWluZXI6IEhUTUxFbGVtZW50LCBwcm90ZWN0ZWQgd29ya2Zsb3dUeXBlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlKSB7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldEFjdGl2aXR5RWxlbWVudHMgPSAoKTogSlF1ZXJ5ID0+IHtcclxuICAgICAgICByZXR1cm4gJCh0aGlzLmNvbnRhaW5lcikuZmluZCgnLmFjdGl2aXR5Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldERlZmF1bHRzID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIEFuY2hvcjogXCJDb250aW51b3VzXCIsXHJcbiAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcclxuICAgICAgICAgICAgRW5kcG9pbnRTdHlsZXM6IFt7IGZpbGxTdHlsZTogJyMyMjU1ODgnIH1dLFxyXG4gICAgICAgICAgICBFbmRwb2ludHM6IFtbXCJEb3RcIiwgeyByYWRpdXM6IDcgfV0sIFtcIkJsYW5rXCJdXSxcclxuICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXHJcbiAgICAgICAgICAgICAgICBbXCJBcnJvd1wiLCB7IHdpZHRoOiAxMiwgbGVuZ3RoOiAxMiwgbG9jYXRpb246IC01IH1dLFxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBDb25uZWN0b3JaSW5kZXg6IDVcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHByb3RlY3RlZCBjcmVhdGVKc1BsdW1iSW5zdGFuY2UgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGpzUGx1bWIuZ2V0SW5zdGFuY2Uoe1xyXG4gICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXHJcbiAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgWydBcnJvdycsIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogMSxcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMSxcclxuICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IDExXHJcbiAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgICAgIFsnTGFiZWwnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDAuNSxcclxuICAgICAgICAgICAgICAgICAgICBpZDogJ2xhYmVsJyxcclxuICAgICAgICAgICAgICAgICAgICBjc3NDbGFzczogJ2Nvbm5lY3Rpb24tbGFiZWwnXHJcbiAgICAgICAgICAgICAgICB9XVxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBDb250YWluZXI6IHRoaXMuY29udGFpbmVyXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHByb3RlY3RlZCBnZXRFbmRwb2ludENvbG9yID0gKGFjdGl2aXR5OiBXb3JrZmxvd3MuQWN0aXZpdHkpID0+IHtcclxuICAgICAgICByZXR1cm4gYWN0aXZpdHkuaXNCbG9ja2luZyB8fCBhY3Rpdml0eS5pc1N0YXJ0ID8gJyM3YWIwMmMnIDogYWN0aXZpdHkuaXNFdmVudCA/ICcjM2E4YWNkJyA6ICcjN2FiMDJjJztcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zID0gKGFjdGl2aXR5OiBXb3JrZmxvd3MuQWN0aXZpdHksIG91dGNvbWU6IFdvcmtmbG93cy5PdXRjb21lKTogRW5kcG9pbnRPcHRpb25zID0+IHtcclxuICAgICAgICAvLyBUaGUgZGVmaW5pdGlvbiBvZiBzb3VyY2UgZW5kcG9pbnRzLlxyXG4gICAgICAgIGNvbnN0IHBhaW50Q29sb3IgPSB0aGlzLmdldEVuZHBvaW50Q29sb3IoYWN0aXZpdHkpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGVuZHBvaW50OiAnRG90JyxcclxuICAgICAgICAgICAgYW5jaG9yOiAnQ29udGludW91cycsXHJcbiAgICAgICAgICAgIHBhaW50U3R5bGU6IHtcclxuICAgICAgICAgICAgICAgIHN0cm9rZTogcGFpbnRDb2xvcixcclxuICAgICAgICAgICAgICAgIGZpbGw6IHBhaW50Q29sb3IsXHJcbiAgICAgICAgICAgICAgICByYWRpdXM6IDcsXHJcbiAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBpc1NvdXJjZTogdHJ1ZSxcclxuICAgICAgICAgICAgY29ubmVjdG9yOiBbJ0Zsb3djaGFydCcsIHsgc3R1YjogWzQwLCA2MF0sIGdhcDogMCwgY29ybmVyUmFkaXVzOiA1LCBhbHdheXNSZXNwZWN0U3R1YnM6IHRydWUgfV0sXHJcbiAgICAgICAgICAgIGNvbm5lY3RvclN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMixcclxuICAgICAgICAgICAgICAgIHN0cm9rZTogJyM5OTk5OTknLFxyXG4gICAgICAgICAgICAgICAgam9pbnN0eWxlOiAncm91bmQnLFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogJ3doaXRlJyxcclxuICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogMlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBob3ZlclBhaW50U3R5bGU6IHtcclxuICAgICAgICAgICAgICAgIGZpbGw6ICcjMjE2NDc3JyxcclxuICAgICAgICAgICAgICAgIHN0cm9rZTogJyMyMTY0NzcnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbm5lY3RvckhvdmVyU3R5bGU6IHtcclxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAzLFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzIxNjQ3NycsXHJcbiAgICAgICAgICAgICAgICBvdXRsaW5lV2lkdGg6IDUsXHJcbiAgICAgICAgICAgICAgICBvdXRsaW5lU3Ryb2tlOiAnd2hpdGUnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbm5lY3Rvck92ZXJsYXlzOiBbWydMYWJlbCcsIHsgbG9jYXRpb246IFszLCAtMS41XSwgY3NzQ2xhc3M6ICdlbmRwb2ludFNvdXJjZUxhYmVsJyB9XV0sXHJcbiAgICAgICAgICAgIGRyYWdPcHRpb25zOiB7fSxcclxuICAgICAgICAgICAgdXVpZDogYCR7YWN0aXZpdHkuaWR9LSR7b3V0Y29tZS5uYW1lfWAsXHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IHtcclxuICAgICAgICAgICAgICAgIG91dGNvbWU6IG91dGNvbWVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIHByb3RlY3RlZCBnZXRBY3Rpdml0eSA9IGZ1bmN0aW9uIChpZDogc3RyaW5nLCBhY3Rpdml0aWVzOiBBcnJheTxXb3JrZmxvd3MuQWN0aXZpdHk+ID0gbnVsbCk6IFdvcmtmbG93cy5BY3Rpdml0eSB7XHJcbiAgICAgICAgaWYgKCFhY3Rpdml0aWVzKSB7XHJcbiAgICAgICAgICAgIGFjdGl2aXRpZXMgPSB0aGlzLndvcmtmbG93VHlwZS5hY3Rpdml0aWVzO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJC5ncmVwKGFjdGl2aXRpZXMsICh4OiBXb3JrZmxvd3MuQWN0aXZpdHkpID0+IHguaWQgPT09IGlkKVswXTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgdXBkYXRlQ29ubmVjdGlvbnMgPSAocGx1bWJlcjoganNQbHVtYkluc3RhbmNlKSA9PiB7XHJcbiAgICAgICAgdmFyIHdvcmtmbG93SWQ6IG51bWJlciA9IHRoaXMud29ya2Zsb3dUeXBlLmlkO1xyXG5cclxuICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXHJcbiAgICAgICAgZm9yIChsZXQgdHJhbnNpdGlvbk1vZGVsIG9mIHRoaXMud29ya2Zsb3dUeXBlLnRyYW5zaXRpb25zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUVuZHBvaW50VXVpZDogc3RyaW5nID0gYCR7dHJhbnNpdGlvbk1vZGVsLnNvdXJjZUFjdGl2aXR5SWR9LSR7dHJhbnNpdGlvbk1vZGVsLnNvdXJjZU91dGNvbWVOYW1lfWA7XHJcbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUVuZHBvaW50OiBFbmRwb2ludCA9IHBsdW1iZXIuZ2V0RW5kcG9pbnQoc291cmNlRW5kcG9pbnRVdWlkKTtcclxuICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25FbGVtZW50SWQ6IHN0cmluZyA9IGBhY3Rpdml0eS0ke3dvcmtmbG93SWR9LSR7dHJhbnNpdGlvbk1vZGVsLmRlc3RpbmF0aW9uQWN0aXZpdHlJZH1gO1xyXG5cclxuICAgICAgICAgICAgcGx1bWJlci5jb25uZWN0KHtcclxuICAgICAgICAgICAgICAgIHNvdXJjZTogc291cmNlRW5kcG9pbnQsXHJcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IGRlc3RpbmF0aW9uRWxlbWVudElkXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgdXBkYXRlQ2FudmFzSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0ICRjb250YWluZXIgPSAkKHRoaXMuY29udGFpbmVyKTtcclxuXHJcbiAgICAgICAgLy8gR2V0IHRoZSBhY3Rpdml0eSBlbGVtZW50IHdpdGggdGhlIGhpZ2hlc3QgWSBjb29yZGluYXRlLlxyXG4gICAgICAgIGNvbnN0ICRhY3Rpdml0eUVsZW1lbnRzID0gJGNvbnRhaW5lci5maW5kKFwiLmFjdGl2aXR5XCIpO1xyXG4gICAgICAgIGxldCBjdXJyZW50RWxlbWVudFRvcCA9IDA7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRBY3Rpdml0eUhlaWdodCA9IDA7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGFjdGl2aXR5RWxlbWVudCBvZiAkYWN0aXZpdHlFbGVtZW50cy50b0FycmF5KCkpIHtcclxuICAgICAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudCA9ICQoYWN0aXZpdHlFbGVtZW50KTtcclxuICAgICAgICAgICAgY29uc3QgdG9wID0gJGFjdGl2aXR5RWxlbWVudC5wb3NpdGlvbigpLnRvcDtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b3AgPiBjdXJyZW50RWxlbWVudFRvcCkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudEVsZW1lbnRUb3AgPSB0b3A7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50QWN0aXZpdHlIZWlnaHQgPSAkYWN0aXZpdHlFbGVtZW50LmhlaWdodCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgbmV3Q2FudmFzSGVpZ2h0ID0gY3VycmVudEVsZW1lbnRUb3AgKyBjdXJyZW50QWN0aXZpdHlIZWlnaHQ7XHJcbiAgICAgICAgY29uc3QgZWxlbWVudEJvdHRvbSA9IGN1cnJlbnRFbGVtZW50VG9wICsgY3VycmVudEFjdGl2aXR5SGVpZ2h0O1xyXG4gICAgICAgIGNvbnN0IHN0cmV0Y2hWYWx1ZSA9IDEwMDtcclxuXHJcbiAgICAgICAgaWYgKG5ld0NhbnZhc0hlaWdodCAtIGVsZW1lbnRCb3R0b20gPD0gc3RyZXRjaFZhbHVlKSB7XHJcbiAgICAgICAgICAgIG5ld0NhbnZhc0hlaWdodCArPSBzdHJldGNoVmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY29udGFpbmVyLmhlaWdodChNYXRoLm1heCh0aGlzLm1pbkNhbnZhc0hlaWdodCwgbmV3Q2FudmFzSGVpZ2h0KSk7XHJcbiAgICB9O1xyXG59XHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XG52YXIgV29ya2Zsb3dDYW52YXMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gV29ya2Zsb3dDYW52YXMoY29udGFpbmVyLCB3b3JrZmxvd1R5cGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICAgIHRoaXMud29ya2Zsb3dUeXBlID0gd29ya2Zsb3dUeXBlO1xuICAgICAgICB0aGlzLm1pbkNhbnZhc0hlaWdodCA9IDQwMDtcbiAgICAgICAgdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICQoX3RoaXMuY29udGFpbmVyKS5maW5kKCcuYWN0aXZpdHknKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZXREZWZhdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgQW5jaG9yOiBcIkNvbnRpbnVvdXNcIixcbiAgICAgICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXG4gICAgICAgICAgICAgICAgRW5kcG9pbnRTdHlsZXM6IFt7IGZpbGxTdHlsZTogJyMyMjU1ODgnIH1dLFxuICAgICAgICAgICAgICAgIEVuZHBvaW50czogW1tcIkRvdFwiLCB7IHJhZGl1czogNyB9XSwgW1wiQmxhbmtcIl1dLFxuICAgICAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xuICAgICAgICAgICAgICAgICAgICBbXCJBcnJvd1wiLCB7IHdpZHRoOiAxMiwgbGVuZ3RoOiAxMiwgbG9jYXRpb246IC01IH1dLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgQ29ubmVjdG9yWkluZGV4OiA1XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNyZWF0ZUpzUGx1bWJJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBqc1BsdW1iLmdldEluc3RhbmNlKHtcbiAgICAgICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXG4gICAgICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXG4gICAgICAgICAgICAgICAgICAgIFsnQXJyb3cnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiAxMVxuICAgICAgICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICAgIFsnTGFiZWwnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDAuNSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ2xhYmVsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3NDbGFzczogJ2Nvbm5lY3Rpb24tbGFiZWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgQ29udGFpbmVyOiBfdGhpcy5jb250YWluZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldEVuZHBvaW50Q29sb3IgPSBmdW5jdGlvbiAoYWN0aXZpdHkpIHtcbiAgICAgICAgICAgIHJldHVybiBhY3Rpdml0eS5pc0Jsb2NraW5nIHx8IGFjdGl2aXR5LmlzU3RhcnQgPyAnIzdhYjAyYycgOiBhY3Rpdml0eS5pc0V2ZW50ID8gJyMzYThhY2QnIDogJyM3YWIwMmMnO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IGZ1bmN0aW9uIChhY3Rpdml0eSwgb3V0Y29tZSkge1xuICAgICAgICAgICAgLy8gVGhlIGRlZmluaXRpb24gb2Ygc291cmNlIGVuZHBvaW50cy5cbiAgICAgICAgICAgIHZhciBwYWludENvbG9yID0gX3RoaXMuZ2V0RW5kcG9pbnRDb2xvcihhY3Rpdml0eSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnRG90JyxcbiAgICAgICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcbiAgICAgICAgICAgICAgICBwYWludFN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZTogcGFpbnRDb2xvcixcbiAgICAgICAgICAgICAgICAgICAgZmlsbDogcGFpbnRDb2xvcixcbiAgICAgICAgICAgICAgICAgICAgcmFkaXVzOiA3LFxuICAgICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaXNTb3VyY2U6IHRydWUsXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yOiBbJ0Zsb3djaGFydCcsIHsgc3R1YjogWzQwLCA2MF0sIGdhcDogMCwgY29ybmVyUmFkaXVzOiA1LCBhbHdheXNSZXNwZWN0U3R1YnM6IHRydWUgfV0sXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yU3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZTogJyM5OTk5OTknLFxuICAgICAgICAgICAgICAgICAgICBqb2luc3R5bGU6ICdyb3VuZCcsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZScsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogMlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaG92ZXJQYWludFN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGw6ICcjMjE2NDc3JyxcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzIxNjQ3NydcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbm5lY3RvckhvdmVyU3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDMsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZTogJyMyMTY0NzcnLFxuICAgICAgICAgICAgICAgICAgICBvdXRsaW5lV2lkdGg6IDUsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbm5lY3Rvck92ZXJsYXlzOiBbWydMYWJlbCcsIHsgbG9jYXRpb246IFszLCAtMS41XSwgY3NzQ2xhc3M6ICdlbmRwb2ludFNvdXJjZUxhYmVsJyB9XV0sXG4gICAgICAgICAgICAgICAgZHJhZ09wdGlvbnM6IHt9LFxuICAgICAgICAgICAgICAgIHV1aWQ6IFwiXCIuY29uY2F0KGFjdGl2aXR5LmlkLCBcIi1cIikuY29uY2F0KG91dGNvbWUubmFtZSksXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgICAgICAgICAgICBvdXRjb21lOiBvdXRjb21lXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZXRBY3Rpdml0eSA9IGZ1bmN0aW9uIChpZCwgYWN0aXZpdGllcykge1xuICAgICAgICAgICAgaWYgKGFjdGl2aXRpZXMgPT09IHZvaWQgMCkgeyBhY3Rpdml0aWVzID0gbnVsbDsgfVxuICAgICAgICAgICAgaWYgKCFhY3Rpdml0aWVzKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZpdGllcyA9IHRoaXMud29ya2Zsb3dUeXBlLmFjdGl2aXRpZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJC5ncmVwKGFjdGl2aXRpZXMsIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmlkID09PSBpZDsgfSlbMF07XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudXBkYXRlQ29ubmVjdGlvbnMgPSBmdW5jdGlvbiAocGx1bWJlcikge1xuICAgICAgICAgICAgdmFyIHdvcmtmbG93SWQgPSBfdGhpcy53b3JrZmxvd1R5cGUuaWQ7XG4gICAgICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gX3RoaXMud29ya2Zsb3dUeXBlLnRyYW5zaXRpb25zOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIHZhciB0cmFuc2l0aW9uTW9kZWwgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50VXVpZCA9IFwiXCIuY29uY2F0KHRyYW5zaXRpb25Nb2RlbC5zb3VyY2VBY3Rpdml0eUlkLCBcIi1cIikuY29uY2F0KHRyYW5zaXRpb25Nb2RlbC5zb3VyY2VPdXRjb21lTmFtZSk7XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50ID0gcGx1bWJlci5nZXRFbmRwb2ludChzb3VyY2VFbmRwb2ludFV1aWQpO1xuICAgICAgICAgICAgICAgIHZhciBkZXN0aW5hdGlvbkVsZW1lbnRJZCA9IFwiYWN0aXZpdHktXCIuY29uY2F0KHdvcmtmbG93SWQsIFwiLVwiKS5jb25jYXQodHJhbnNpdGlvbk1vZGVsLmRlc3RpbmF0aW9uQWN0aXZpdHlJZCk7XG4gICAgICAgICAgICAgICAgcGx1bWJlci5jb25uZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBzb3VyY2VFbmRwb2ludCxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBkZXN0aW5hdGlvbkVsZW1lbnRJZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVwZGF0ZUNhbnZhc0hlaWdodCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciAkY29udGFpbmVyID0gJCh0aGlzLmNvbnRhaW5lcik7XG4gICAgICAgICAgICAvLyBHZXQgdGhlIGFjdGl2aXR5IGVsZW1lbnQgd2l0aCB0aGUgaGlnaGVzdCBZIGNvb3JkaW5hdGUuXG4gICAgICAgICAgICB2YXIgJGFjdGl2aXR5RWxlbWVudHMgPSAkY29udGFpbmVyLmZpbmQoXCIuYWN0aXZpdHlcIik7XG4gICAgICAgICAgICB2YXIgY3VycmVudEVsZW1lbnRUb3AgPSAwO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRBY3Rpdml0eUhlaWdodCA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gJGFjdGl2aXR5RWxlbWVudHMudG9BcnJheSgpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eUVsZW1lbnQgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgdmFyICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdmFyIHRvcF8xID0gJGFjdGl2aXR5RWxlbWVudC5wb3NpdGlvbigpLnRvcDtcbiAgICAgICAgICAgICAgICBpZiAodG9wXzEgPiBjdXJyZW50RWxlbWVudFRvcCkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RWxlbWVudFRvcCA9IHRvcF8xO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50QWN0aXZpdHlIZWlnaHQgPSAkYWN0aXZpdHlFbGVtZW50LmhlaWdodCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBuZXdDYW52YXNIZWlnaHQgPSBjdXJyZW50RWxlbWVudFRvcCArIGN1cnJlbnRBY3Rpdml0eUhlaWdodDtcbiAgICAgICAgICAgIHZhciBlbGVtZW50Qm90dG9tID0gY3VycmVudEVsZW1lbnRUb3AgKyBjdXJyZW50QWN0aXZpdHlIZWlnaHQ7XG4gICAgICAgICAgICB2YXIgc3RyZXRjaFZhbHVlID0gMTAwO1xuICAgICAgICAgICAgaWYgKG5ld0NhbnZhc0hlaWdodCAtIGVsZW1lbnRCb3R0b20gPD0gc3RyZXRjaFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgbmV3Q2FudmFzSGVpZ2h0ICs9IHN0cmV0Y2hWYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRjb250YWluZXIuaGVpZ2h0KE1hdGgubWF4KHRoaXMubWluQ2FudmFzSGVpZ2h0LCBuZXdDYW52YXNIZWlnaHQpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIFdvcmtmbG93Q2FudmFzO1xufSgpKTtcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pzcGx1bWIvdHlwaW5ncy5kLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctbW9kZWxzLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctY2FudmFzLnRzJyAvPlxyXG5cclxuY2xhc3MgV29ya2Zsb3dWaWV3ZXIgZXh0ZW5kcyBXb3JrZmxvd0NhbnZhcyB7XHJcbiAgICBwcml2YXRlIGpzUGx1bWJJbnN0YW5jZToganNQbHVtYkluc3RhbmNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBjb250YWluZXI6IEhUTUxFbGVtZW50LCBwcm90ZWN0ZWQgd29ya2Zsb3dUeXBlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlKSB7XHJcbiAgICAgICAgc3VwZXIoY29udGFpbmVyLCB3b3JrZmxvd1R5cGUpO1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBqc1BsdW1iLnJlYWR5KCgpID0+IHtcclxuICAgICAgICAgICAganNQbHVtYi5pbXBvcnREZWZhdWx0cyh0aGlzLmdldERlZmF1bHRzKCkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcGx1bWJlciA9IHRoaXMuY3JlYXRlSnNQbHVtYkluc3RhbmNlKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIG5ldyBjb25uZWN0aW9ucy5cclxuICAgICAgICAgICAgcGx1bWJlci5iaW5kKCdjb25uZWN0aW9uJywgZnVuY3Rpb24gKGNvbm5JbmZvLCBvcmlnaW5hbEV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uOiBDb25uZWN0aW9uID0gY29ubkluZm8uY29ubmVjdGlvbjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG91dGNvbWU6IFdvcmtmbG93cy5PdXRjb21lID0gY29ubmVjdGlvbi5nZXRQYXJhbWV0ZXJzKCkub3V0Y29tZTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbDogYW55ID0gY29ubmVjdGlvbi5nZXRPdmVybGF5KCdsYWJlbCcpO1xyXG4gICAgICAgICAgICAgICAgbGFiZWwuc2V0TGFiZWwob3V0Y29tZS5kaXNwbGF5TmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbGV0IGFjdGl2aXR5RWxlbWVudHMgPSB0aGlzLmdldEFjdGl2aXR5RWxlbWVudHMoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBhcmVFcXVhbE91dGNvbWVzID0gZnVuY3Rpb24gKG91dGNvbWVzMTogV29ya2Zsb3dzLk91dGNvbWVbXSwgb3V0Y29tZXMyOiBXb3JrZmxvd3MuT3V0Y29tZVtdKTogYm9vbGVhbiB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZXMxLmxlbmd0aCAhPSBvdXRjb21lczIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3V0Y29tZXMxLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3V0Y29tZTEgPSBvdXRjb21lczFbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3V0Y29tZTIgPSBvdXRjb21lczJbaV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvdXRjb21lMS5uYW1lICE9IG91dGNvbWUyLmRpc3BsYXlOYW1lIHx8IG91dGNvbWUxLmRpc3BsYXlOYW1lICE9IG91dGNvbWUyLmRpc3BsYXlOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFN1c3BlbmQgZHJhd2luZyBhbmQgaW5pdGlhbGl6ZS5cclxuICAgICAgICAgICAgcGx1bWJlci5iYXRjaCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgd29ya2Zsb3dJZDogbnVtYmVyID0gdGhpcy53b3JrZmxvd1R5cGUuaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5lYWNoKChpbmRleCwgYWN0aXZpdHlFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudCA9ICQoYWN0aXZpdHlFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1pZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5ID0gdGhpcy5nZXRBY3Rpdml0eShhY3Rpdml0eUlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29uZmlndXJlIHRoZSBhY3Rpdml0eSBhcyBhIHRhcmdldC5cclxuICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLm1ha2VUYXJnZXQoYWN0aXZpdHlFbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BPcHRpb25zOiB7IGhvdmVyQ2xhc3M6ICdob3ZlcicgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiAnQ29udGludW91cycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiBbJ0JsYW5rJywgeyByYWRpdXM6IDggfV1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNvdXJjZSBlbmRwb2ludHMuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgb3V0Y29tZSBvZiBhY3Rpdml0eS5vdXRjb21lcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VFbmRwb2ludE9wdGlvbnMgPSB0aGlzLmdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyhhY3Rpdml0eSwgb3V0Y29tZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsdW1iZXIuYWRkRW5kcG9pbnQoYWN0aXZpdHlFbGVtZW50LCB7IGNvbm5lY3Rvck92ZXJsYXlzOiBbWydMYWJlbCcsIHsgbGFiZWw6IG91dGNvbWUuZGlzcGxheU5hbWUsIGNzc0NsYXNzOiAnY29ubmVjdGlvbi1sYWJlbCcgfV1dIH0sIHNvdXJjZUVuZHBvaW50T3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ29ubmVjdCBhY3Rpdml0aWVzLlxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDb25uZWN0aW9ucyhwbHVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZS1xdWVyeSB0aGUgYWN0aXZpdHkgZWxlbWVudHMuXHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzID0gdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTWFrZSBhbGwgYWN0aXZpdHkgZWxlbWVudHMgdmlzaWJsZS5cclxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuc2hvdygpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5qc1BsdW1iSW5zdGFuY2UgPSBwbHVtYmVyO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXRFbmRwb2ludENvbG9yID0gKGFjdGl2aXR5OiBXb3JrZmxvd3MuQWN0aXZpdHkpID0+IHtcclxuICAgICAgICByZXR1cm4gYWN0aXZpdHkuaXNCbG9ja2luZyA/ICcjN2FiMDJjJyA6IGFjdGl2aXR5LmlzRXZlbnQgPyAnIzNhOGFjZCcgOiAnIzdhYjAyYyc7XHJcbiAgICB9XHJcbn1cclxuXHJcbiQuZm4ud29ya2Zsb3dWaWV3ZXIgPSBmdW5jdGlvbiAodGhpczogSlF1ZXJ5KTogSlF1ZXJ5IHtcclxuICAgIHRoaXMuZWFjaCgoaW5kZXgsIGVsZW1lbnQpID0+IHtcclxuICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xyXG4gICAgICAgIHZhciB3b3JrZmxvd1R5cGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy10eXBlJyk7XHJcblxyXG4gICAgICAgICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93Vmlld2VyJywgbmV3IFdvcmtmbG93Vmlld2VyKGVsZW1lbnQsIHdvcmtmbG93VHlwZSkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbn07XHJcblxyXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCB3b3JrZmxvd1ZpZXdlcjogV29ya2Zsb3dWaWV3ZXIgPSAkKCcud29ya2Zsb3ctY2FudmFzJykud29ya2Zsb3dWaWV3ZXIoKS5kYXRhKCd3b3JrZmxvd1ZpZXdlcicpO1xyXG59KTtcclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pzcGx1bWIvdHlwaW5ncy5kLnRzJyAvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPScuL3dvcmtmbG93LW1vZGVscy50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1jYW52YXMudHMnIC8+XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xudmFyIFdvcmtmbG93Vmlld2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhXb3JrZmxvd1ZpZXdlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBXb3JrZmxvd1ZpZXdlcihjb250YWluZXIsIHdvcmtmbG93VHlwZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBjb250YWluZXIsIHdvcmtmbG93VHlwZSkgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgICBfdGhpcy53b3JrZmxvd1R5cGUgPSB3b3JrZmxvd1R5cGU7XG4gICAgICAgIF90aGlzLmdldEVuZHBvaW50Q29sb3IgPSBmdW5jdGlvbiAoYWN0aXZpdHkpIHtcbiAgICAgICAgICAgIHJldHVybiBhY3Rpdml0eS5pc0Jsb2NraW5nID8gJyM3YWIwMmMnIDogYWN0aXZpdHkuaXNFdmVudCA/ICcjM2E4YWNkJyA6ICcjN2FiMDJjJztcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHNlbGYgPSBfdGhpcztcbiAgICAgICAganNQbHVtYi5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqc1BsdW1iLmltcG9ydERlZmF1bHRzKF90aGlzLmdldERlZmF1bHRzKCkpO1xuICAgICAgICAgICAgdmFyIHBsdW1iZXIgPSBfdGhpcy5jcmVhdGVKc1BsdW1iSW5zdGFuY2UoKTtcbiAgICAgICAgICAgIC8vIExpc3RlbiBmb3IgbmV3IGNvbm5lY3Rpb25zLlxuICAgICAgICAgICAgcGx1bWJlci5iaW5kKCdjb25uZWN0aW9uJywgZnVuY3Rpb24gKGNvbm5JbmZvLCBvcmlnaW5hbEV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbm5lY3Rpb24gPSBjb25uSW5mby5jb25uZWN0aW9uO1xuICAgICAgICAgICAgICAgIHZhciBvdXRjb21lID0gY29ubmVjdGlvbi5nZXRQYXJhbWV0ZXJzKCkub3V0Y29tZTtcbiAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSBjb25uZWN0aW9uLmdldE92ZXJsYXkoJ2xhYmVsJyk7XG4gICAgICAgICAgICAgICAgbGFiZWwuc2V0TGFiZWwob3V0Y29tZS5kaXNwbGF5TmFtZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciBhY3Rpdml0eUVsZW1lbnRzID0gX3RoaXMuZ2V0QWN0aXZpdHlFbGVtZW50cygpO1xuICAgICAgICAgICAgdmFyIGFyZUVxdWFsT3V0Y29tZXMgPSBmdW5jdGlvbiAob3V0Y29tZXMxLCBvdXRjb21lczIpIHtcbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZXMxLmxlbmd0aCAhPSBvdXRjb21lczIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvdXRjb21lczEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG91dGNvbWUxID0gb3V0Y29tZXMxW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZTIgPSBvdXRjb21lczJbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChvdXRjb21lMS5uYW1lICE9IG91dGNvbWUyLmRpc3BsYXlOYW1lIHx8IG91dGNvbWUxLmRpc3BsYXlOYW1lICE9IG91dGNvbWUyLmRpc3BsYXlOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8gU3VzcGVuZCBkcmF3aW5nIGFuZCBpbml0aWFsaXplLlxuICAgICAgICAgICAgcGx1bWJlci5iYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHdvcmtmbG93SWQgPSBfdGhpcy53b3JrZmxvd1R5cGUuaWQ7XG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5lYWNoKGZ1bmN0aW9uIChpbmRleCwgYWN0aXZpdHlFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkYWN0aXZpdHlFbGVtZW50ID0gJChhY3Rpdml0eUVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlJZCA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5ID0gX3RoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIENvbmZpZ3VyZSB0aGUgYWN0aXZpdHkgYXMgYSB0YXJnZXQuXG4gICAgICAgICAgICAgICAgICAgIHBsdW1iZXIubWFrZVRhcmdldChhY3Rpdml0eUVsZW1lbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BPcHRpb25zOiB7IGhvdmVyQ2xhc3M6ICdob3ZlcicgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogJ0NvbnRpbnVvdXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFsnQmxhbmsnLCB7IHJhZGl1czogOCB9XVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNvdXJjZSBlbmRwb2ludHMuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBhY3Rpdml0eS5vdXRjb21lczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvdXRjb21lID0gX2FbX2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IF90aGlzLmdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyhhY3Rpdml0eSwgb3V0Y29tZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLmFkZEVuZHBvaW50KGFjdGl2aXR5RWxlbWVudCwgeyBjb25uZWN0b3JPdmVybGF5czogW1snTGFiZWwnLCB7IGxhYmVsOiBvdXRjb21lLmRpc3BsYXlOYW1lLCBjc3NDbGFzczogJ2Nvbm5lY3Rpb24tbGFiZWwnIH1dXSB9LCBzb3VyY2VFbmRwb2ludE9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gQ29ubmVjdCBhY3Rpdml0aWVzLlxuICAgICAgICAgICAgICAgIF90aGlzLnVwZGF0ZUNvbm5lY3Rpb25zKHBsdW1iZXIpO1xuICAgICAgICAgICAgICAgIC8vIFJlLXF1ZXJ5IHRoZSBhY3Rpdml0eSBlbGVtZW50cy5cbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzID0gX3RoaXMuZ2V0QWN0aXZpdHlFbGVtZW50cygpO1xuICAgICAgICAgICAgICAgIC8vIE1ha2UgYWxsIGFjdGl2aXR5IGVsZW1lbnRzIHZpc2libGUuXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5zaG93KCk7XG4gICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIF90aGlzLmpzUGx1bWJJbnN0YW5jZSA9IHBsdW1iZXI7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBXb3JrZmxvd1ZpZXdlcjtcbn0oV29ya2Zsb3dDYW52YXMpKTtcbiQuZm4ud29ya2Zsb3dWaWV3ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICB2YXIgd29ya2Zsb3dUeXBlID0gJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3ctdHlwZScpO1xuICAgICAgICAkZWxlbWVudC5kYXRhKCd3b3JrZmxvd1ZpZXdlcicsIG5ldyBXb3JrZmxvd1ZpZXdlcihlbGVtZW50LCB3b3JrZmxvd1R5cGUpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbn07XG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHdvcmtmbG93Vmlld2VyID0gJCgnLndvcmtmbG93LWNhbnZhcycpLndvcmtmbG93Vmlld2VyKCkuZGF0YSgnd29ya2Zsb3dWaWV3ZXInKTtcbn0pO1xuIl19
