/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
var WorkflowCanvas = /** @class */function () {
  function WorkflowCanvas(container, workflowType) {
    var _this = this;
    this.container = container;
    this.workflowType = workflowType;
    this.minCanvasHeight = 400;
    this.getActivityElements = function () {
      return $(_this.container).find('.activity');
    };
    this.getDefaults = function () {
      return {
        Anchor: "Continuous",
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        EndpointStyles: [{
          fillStyle: '#225588'
        }],
        Endpoints: [["Dot", {
          radius: 7
        }], ["Blank"]],
        ConnectionOverlays: [["Arrow", {
          width: 12,
          length: 12,
          location: -5
        }]],
        ConnectorZIndex: 5
      };
    };
    this.createJsPlumbInstance = function () {
      return jsPlumb.getInstance({
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        ConnectionOverlays: [['Arrow', {
          location: 1,
          visible: true,
          width: 11,
          length: 11
        }], ['Label', {
          location: 0.5,
          id: 'label',
          cssClass: 'connection-label'
        }]],
        Container: _this.container
      });
    };
    this.getEndpointColor = function (activity) {
      return activity.isBlocking || activity.isStart ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };
    this.getSourceEndpointOptions = function (activity, outcome) {
      // The definition of source endpoints.
      var paintColor = _this.getEndpointColor(activity);
      return {
        endpoint: 'Dot',
        anchor: 'Continuous',
        paintStyle: {
          stroke: paintColor,
          fill: paintColor,
          radius: 7,
          strokeWidth: 1
        },
        isSource: true,
        connector: ['Flowchart', {
          stub: [40, 60],
          gap: 0,
          cornerRadius: 5,
          alwaysRespectStubs: true
        }],
        connectorStyle: {
          strokeWidth: 2,
          stroke: '#999999',
          joinstyle: 'round',
          outlineStroke: 'white',
          outlineWidth: 2
        },
        hoverPaintStyle: {
          fill: '#216477',
          stroke: '#216477'
        },
        connectorHoverStyle: {
          strokeWidth: 3,
          stroke: '#216477',
          outlineWidth: 5,
          outlineStroke: 'white'
        },
        connectorOverlays: [['Label', {
          location: [3, -1.5],
          cssClass: 'endpointSourceLabel'
        }]],
        dragOptions: {},
        uuid: "".concat(activity.id, "-").concat(outcome.name),
        parameters: {
          outcome: outcome
        }
      };
    };
    this.getActivity = function (id, activities) {
      if (activities === void 0) {
        activities = null;
      }
      if (!activities) {
        activities = this.workflowType.activities;
      }
      return $.grep(activities, function (x) {
        return x.id === id;
      })[0];
    };
    this.updateConnections = function (plumber) {
      var workflowId = _this.workflowType.id;
      // Connect activities.
      for (var _i = 0, _a = _this.workflowType.transitions; _i < _a.length; _i++) {
        var transitionModel = _a[_i];
        var sourceEndpointUuid = "".concat(transitionModel.sourceActivityId, "-").concat(transitionModel.sourceOutcomeName);
        var sourceEndpoint = plumber.getEndpoint(sourceEndpointUuid);
        var destinationElementId = "activity-".concat(workflowId, "-").concat(transitionModel.destinationActivityId);
        plumber.connect({
          source: sourceEndpoint,
          target: destinationElementId
        });
      }
    };
    this.updateCanvasHeight = function () {
      var $container = $(this.container);
      // Get the activity element with the highest Y coordinate.
      var $activityElements = $container.find(".activity");
      var currentElementTop = 0;
      var currentActivityHeight = 0;
      for (var _i = 0, _a = $activityElements.toArray(); _i < _a.length; _i++) {
        var activityElement = _a[_i];
        var $activityElement = $(activityElement);
        var top_1 = $activityElement.position().top;
        if (top_1 > currentElementTop) {
          currentElementTop = top_1;
          currentActivityHeight = $activityElement.height();
        }
      }
      var newCanvasHeight = currentElementTop + currentActivityHeight;
      var elementBottom = currentElementTop + currentActivityHeight;
      var stretchValue = 100;
      if (newCanvasHeight - elementBottom <= stretchValue) {
        newCanvasHeight += stretchValue;
      }
      $container.height(Math.max(this.minCanvasHeight, newCanvasHeight));
    };
  }
  return WorkflowCanvas;
}();
///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
///<reference path='./workflow-canvas.ts' />
var __extends = this && this.__extends || function () {
  var _extendStatics = function extendStatics(d, b) {
    _extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
    };
    return _extendStatics(d, b);
  };
  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    _extendStatics(d, b);
    function __() {
      this.constructor = d;
    }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();
var WorkflowViewer = /** @class */function (_super) {
  __extends(WorkflowViewer, _super);
  function WorkflowViewer(container, workflowType) {
    var _this = _super.call(this, container, workflowType) || this;
    _this.container = container;
    _this.workflowType = workflowType;
    _this.getEndpointColor = function (activity) {
      return activity.isBlocking ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };
    var self = _this;
    jsPlumb.ready(function () {
      jsPlumb.importDefaults(_this.getDefaults());
      var plumber = _this.createJsPlumbInstance();
      // Listen for new connections.
      plumber.bind('connection', function (connInfo, originalEvent) {
        var connection = connInfo.connection;
        var outcome = connection.getParameters().outcome;
        var label = connection.getOverlay('label');
        label.setLabel(outcome.displayName);
      });
      var activityElements = _this.getActivityElements();
      var areEqualOutcomes = function areEqualOutcomes(outcomes1, outcomes2) {
        if (outcomes1.length != outcomes2.length) {
          return false;
        }
        for (var i = 0; i < outcomes1.length; i++) {
          var outcome1 = outcomes1[i];
          var outcome2 = outcomes2[i];
          if (outcome1.name != outcome2.displayName || outcome1.displayName != outcome2.displayName) {
            return false;
          }
        }
        return true;
      };
      // Suspend drawing and initialize.
      plumber.batch(function () {
        var workflowId = _this.workflowType.id;
        activityElements.each(function (_, activityElement) {
          var $activityElement = $(activityElement);
          var activityId = $activityElement.data('activity-id');
          var activity = _this.getActivity(activityId);
          // Configure the activity as a target.
          plumber.makeTarget(activityElement, {
            dropOptions: {
              hoverClass: 'hover'
            },
            anchor: 'Continuous',
            endpoint: ['Blank', {
              radius: 8
            }]
          });
          // Add source endpoints.
          for (var _i = 0, _a = activity.outcomes; _i < _a.length; _i++) {
            var outcome = _a[_i];
            var sourceEndpointOptions = _this.getSourceEndpointOptions(activity, outcome);
            plumber.addEndpoint(activityElement, {
              connectorOverlays: [['Label', {
                label: outcome.displayName,
                cssClass: 'connection-label'
              }]]
            }, sourceEndpointOptions);
          }
        });
        // Connect activities.
        _this.updateConnections(plumber);
        // Re-query the activity elements.
        activityElements = _this.getActivityElements();
        // Make all activity elements visible.
        activityElements.show();
        _this.updateCanvasHeight();
      });
      _this.jsPlumbInstance = plumber;
    });
    return _this;
  }
  return WorkflowViewer;
}(WorkflowCanvas);
$.fn.workflowViewer = function () {
  this.each(function (index, element) {
    var $element = $(element);
    var workflowType = $element.data('workflow-type');
    $element.data('workflowViewer', new WorkflowViewer(element, workflowType));
  });
  return this;
};
$(document).ready(function () {
  var workflowViewer = $('.workflow-canvas').workflowViewer().data('workflowViewer');
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndvcmtmbG93LWNhbnZhcy50cyIsIndvcmtmbG93LWNhbnZhcy5qcyIsIndvcmtmbG93LXZpZXdlci50cyIsIndvcmtmbG93LXZpZXdlci5qcyJdLCJuYW1lcyI6WyJXb3JrZmxvd0NhbnZhcyIsImNvbnRhaW5lciIsIndvcmtmbG93VHlwZSIsIl90aGlzIiwibWluQ2FudmFzSGVpZ2h0IiwiZ2V0QWN0aXZpdHlFbGVtZW50cyIsIiQiLCJmaW5kIiwiZ2V0RGVmYXVsdHMiLCJBbmNob3IiLCJEcmFnT3B0aW9ucyIsImN1cnNvciIsInpJbmRleCIsIkVuZHBvaW50U3R5bGVzIiwiZmlsbFN0eWxlIiwiRW5kcG9pbnRzIiwicmFkaXVzIiwiQ29ubmVjdGlvbk92ZXJsYXlzIiwid2lkdGgiLCJsZW5ndGgiLCJsb2NhdGlvbiIsIkNvbm5lY3RvclpJbmRleCIsImNyZWF0ZUpzUGx1bWJJbnN0YW5jZSIsImpzUGx1bWIiLCJnZXRJbnN0YW5jZSIsInZpc2libGUiLCJpZCIsImNzc0NsYXNzIiwiQ29udGFpbmVyIiwiZ2V0RW5kcG9pbnRDb2xvciIsImFjdGl2aXR5IiwiaXNCbG9ja2luZyIsImlzU3RhcnQiLCJpc0V2ZW50IiwiZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zIiwib3V0Y29tZSIsInBhaW50Q29sb3IiLCJlbmRwb2ludCIsImFuY2hvciIsInBhaW50U3R5bGUiLCJzdHJva2UiLCJmaWxsIiwic3Ryb2tlV2lkdGgiLCJpc1NvdXJjZSIsImNvbm5lY3RvciIsInN0dWIiLCJnYXAiLCJjb3JuZXJSYWRpdXMiLCJhbHdheXNSZXNwZWN0U3R1YnMiLCJjb25uZWN0b3JTdHlsZSIsImpvaW5zdHlsZSIsIm91dGxpbmVTdHJva2UiLCJvdXRsaW5lV2lkdGgiLCJob3ZlclBhaW50U3R5bGUiLCJjb25uZWN0b3JIb3ZlclN0eWxlIiwiY29ubmVjdG9yT3ZlcmxheXMiLCJkcmFnT3B0aW9ucyIsInV1aWQiLCJjb25jYXQiLCJuYW1lIiwicGFyYW1ldGVycyIsImdldEFjdGl2aXR5IiwiYWN0aXZpdGllcyIsImdyZXAiLCJ4IiwidXBkYXRlQ29ubmVjdGlvbnMiLCJwbHVtYmVyIiwid29ya2Zsb3dJZCIsIl9pIiwiX2EiLCJ0cmFuc2l0aW9ucyIsInRyYW5zaXRpb25Nb2RlbCIsInNvdXJjZUVuZHBvaW50VXVpZCIsInNvdXJjZUFjdGl2aXR5SWQiLCJzb3VyY2VPdXRjb21lTmFtZSIsInNvdXJjZUVuZHBvaW50IiwiZ2V0RW5kcG9pbnQiLCJkZXN0aW5hdGlvbkVsZW1lbnRJZCIsImRlc3RpbmF0aW9uQWN0aXZpdHlJZCIsImNvbm5lY3QiLCJzb3VyY2UiLCJ0YXJnZXQiLCJ1cGRhdGVDYW52YXNIZWlnaHQiLCIkY29udGFpbmVyIiwiJGFjdGl2aXR5RWxlbWVudHMiLCJjdXJyZW50RWxlbWVudFRvcCIsImN1cnJlbnRBY3Rpdml0eUhlaWdodCIsInRvQXJyYXkiLCJhY3Rpdml0eUVsZW1lbnQiLCIkYWN0aXZpdHlFbGVtZW50IiwidG9wXzEiLCJwb3NpdGlvbiIsInRvcCIsImhlaWdodCIsIm5ld0NhbnZhc0hlaWdodCIsImVsZW1lbnRCb3R0b20iLCJzdHJldGNoVmFsdWUiLCJNYXRoIiwibWF4IiwiX19leHRlbmRzIiwiZXh0ZW5kU3RhdGljcyIsImQiLCJiIiwiT2JqZWN0Iiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJBcnJheSIsInAiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJUeXBlRXJyb3IiLCJTdHJpbmciLCJfXyIsImNvbnN0cnVjdG9yIiwiY3JlYXRlIiwiV29ya2Zsb3dWaWV3ZXIiLCJfc3VwZXIiLCJzZWxmIiwicmVhZHkiLCJpbXBvcnREZWZhdWx0cyIsImJpbmQiLCJjb25uSW5mbyIsIm9yaWdpbmFsRXZlbnQiLCJjb25uZWN0aW9uIiwiZ2V0UGFyYW1ldGVycyIsImxhYmVsIiwiZ2V0T3ZlcmxheSIsInNldExhYmVsIiwiZGlzcGxheU5hbWUiLCJhY3Rpdml0eUVsZW1lbnRzIiwiYXJlRXF1YWxPdXRjb21lcyIsIm91dGNvbWVzMSIsIm91dGNvbWVzMiIsImkiLCJvdXRjb21lMSIsIm91dGNvbWUyIiwiYmF0Y2giLCJlYWNoIiwiXyIsImFjdGl2aXR5SWQiLCJkYXRhIiwibWFrZVRhcmdldCIsImRyb3BPcHRpb25zIiwiaG92ZXJDbGFzcyIsIm91dGNvbWVzIiwic291cmNlRW5kcG9pbnRPcHRpb25zIiwiYWRkRW5kcG9pbnQiLCJzaG93IiwianNQbHVtYkluc3RhbmNlIiwiZm4iLCJ3b3JrZmxvd1ZpZXdlciIsImluZGV4IiwiZWxlbWVudCIsIiRlbGVtZW50IiwiZG9jdW1lbnQiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBRUEsSUFBQUEsY0FBQSxHQUFBLGFBQUEsWUFBQTtFQUdJLFNBQUFBLGNBQUFBLENBQXNCQyxTQUFzQixFQUFZQyxZQUFvQyxFQUFBO0lBQTVGLElBQUFDLEtBQUEsR0FBQSxJQUFBO0lBQXNCLElBQUEsQ0FBQUYsU0FBUyxHQUFUQSxTQUFTO0lBQXlCLElBQUEsQ0FBQUMsWUFBWSxHQUFaQSxZQUFZO0lBRjVELElBQUEsQ0FBQUUsZUFBZSxHQUFXLEdBQUc7SUFLM0IsSUFBQSxDQUFBQyxtQkFBbUIsR0FBRyxZQUFBO01BQzVCLE9BQU9DLENBQUMsQ0FBQ0gsS0FBSSxDQUFDRixTQUFTLENBQUMsQ0FBQ00sSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUM5QyxDQUFDO0lBRVMsSUFBQSxDQUFBQyxXQUFXLEdBQUcsWUFBQTtNQUNwQixPQUFPO1FBQ0hDLE1BQU0sRUFBRSxZQUFZO1FBQ3BCQyxXQUFXLEVBQUU7VUFBRUMsTUFBTSxFQUFFLFNBQVM7VUFBRUMsTUFBTSxFQUFFO1FBQUksQ0FBRTtRQUNoREMsY0FBYyxFQUFFLENBQUM7VUFBRUMsU0FBUyxFQUFFO1FBQVMsQ0FBRSxDQUFDO1FBQzFDQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRTtVQUFFQyxNQUFNLEVBQUU7UUFBQyxDQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzlDQyxr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LGlCQUFpQixDQUFDQyxPQUFPLENBQUM7UUFFL0I7UUFDQWdFLGdCQUFnQixHQUFHL0gsS0FBSSxDQUFDRSxtQkFBbUIsQ0FBQSxDQUFFO1FBRTdDO1FBQ0E2SCxnQkFBZ0IsQ0FBQ2tCLElBQUksQ0FBQSxDQUFFO1FBRXZCakosS0FBSSxDQUFDK0Usa0JBQWtCLENBQUEsQ0FBRTtNQUM3QixDQUFDLENBQUM7TUFFRi9FLEtBQUksQ0FBQ2tKLGVBQWUsR0FBR25GLE9BQU87SUFDbEMsQ0FBQyxDQUFDO0lDRUYsT0FBTy9ELEtBQUs7RUREaEI7RUFLSixPQUFBaUgsY0FBQztBQUFELENBbEZBLENBQTZCcEgsY0FBYyxDQUFBO0FBb0YzQ00sQ0FBQyxDQUFDZ0osRUFBRSxDQUFDQyxjQUFjLEdBQUcsWUFBQTtFQUNsQixJQUFJLENBQUNiLElBQUksQ0FBQyxVQUFDYyxLQUFLLEVBQUVDLE9BQU8sRUFBQTtJQUNyQixJQUFJQyxRQUFRLEdBQUdwSixDQUFDLENBQUNtSixPQUFPLENBQUM7SUFDekIsSUFBSXZKLFlBQVksR0FBMkJ3SixRQUFRLENBQUNiLElBQUksQ0FBQyxlQUFlLENBQUM7SUFFekVhLFFBQVEsQ0FBQ2IsSUFBSSxDQUFDLGdCQUFnQixFQUFFLElBQUl6QixjQUFjLENBQUNxQyxPQUFPLEVBQUV2SixZQUFZLENBQUMsQ0FBQztFQUM5RSxDQUFDLENBQUM7RUFFRixPQUFPLElBQUk7QUFDZixDQUFDO0FBRURJLENBQUMsQ0FBQ3FKLFFBQVEsQ0FBQyxDQUFDcEMsS0FBSyxDQUFDLFlBQUE7RUFDZCxJQUFNZ0MsY0FBYyxHQUFtQmpKLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDaUosY0FBYyxDQUFBLENBQUUsQ0FBQ1YsSUFBSSxDQUFDLGdCQUFnQixDQUFDO0FBQ3hHLENBQUMsQ0FBQyIsImZpbGUiOiJvcmNoYXJkLndvcmtmbG93cy12aWV3ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qcXVlcnkvdHlwaW5ncy5kLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPScuL3dvcmtmbG93LW1vZGVscy50cycgLz5cclxuXHJcbmFic3RyYWN0IGNsYXNzIFdvcmtmbG93Q2FudmFzIHtcclxuICAgIHByaXZhdGUgbWluQ2FudmFzSGVpZ2h0OiBudW1iZXIgPSA0MDA7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHByb3RlY3RlZCB3b3JrZmxvd1R5cGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUpIHtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0QWN0aXZpdHlFbGVtZW50cyA9ICgpOiBKUXVlcnkgPT4ge1xyXG4gICAgICAgIHJldHVybiAkKHRoaXMuY29udGFpbmVyKS5maW5kKCcuYWN0aXZpdHknKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0RGVmYXVsdHMgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgQW5jaG9yOiBcIkNvbnRpbnVvdXNcIixcclxuICAgICAgICAgICAgRHJhZ09wdGlvbnM6IHsgY3Vyc29yOiAncG9pbnRlcicsIHpJbmRleDogMjAwMCB9LFxyXG4gICAgICAgICAgICBFbmRwb2ludFN0eWxlczogW3sgZmlsbFN0eWxlOiAnIzIyNTU4OCcgfV0sXHJcbiAgICAgICAgICAgIEVuZHBvaW50czogW1tcIkRvdFwiLCB7IHJhZGl1czogNyB9XSwgW1wiQmxhbmtcIl1dLFxyXG4gICAgICAgICAgICBDb25uZWN0aW9uT3ZlcmxheXM6IFtcclxuICAgICAgICAgICAgICAgIFtcIkFycm93XCIsIHsgd2lkdGg6IDEyLCBsZW5ndGg6IDEyLCBsb2NhdGlvbjogLTUgfV0sXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIENvbm5lY3RvclpJbmRleDogNVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcHJvdGVjdGVkIGNyZWF0ZUpzUGx1bWJJbnN0YW5jZSA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4ganNQbHVtYi5nZXRJbnN0YW5jZSh7XHJcbiAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcclxuICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXHJcbiAgICAgICAgICAgICAgICBbJ0Fycm93Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDExLFxyXG4gICAgICAgICAgICAgICAgICAgIGxlbmd0aDogMTFcclxuICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICAgICAgWydMYWJlbCcsIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogMC41LFxyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbGFiZWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnY29ubmVjdGlvbi1sYWJlbCdcclxuICAgICAgICAgICAgICAgIH1dXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIENvbnRhaW5lcjogdGhpcy5jb250YWluZXJcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldEVuZHBvaW50Q29sb3IgPSAoYWN0aXZpdHk6IFdvcmtmbG93cy5BY3Rpdml0eSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBhY3Rpdml0eS5pc0Jsb2NraW5nIHx8IGFjdGl2aXR5LmlzU3RhcnQgPyAnIzdhYjAyYycgOiBhY3Rpdml0eS5pc0V2ZW50ID8gJyMzYThhY2QnIDogJyM3YWIwMmMnO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMgPSAoYWN0aXZpdHk6IFdvcmtmbG93cy5BY3Rpdml0eSwgb3V0Y29tZTogV29ya2Zsb3dzLk91dGNvbWUpOiBFbmRwb2ludE9wdGlvbnMgPT4ge1xyXG4gICAgICAgIC8vIFRoZSBkZWZpbml0aW9uIG9mIHNvdXJjZSBlbmRwb2ludHMuXHJcbiAgICAgICAgY29uc3QgcGFpbnRDb2xvciA9IHRoaXMuZ2V0RW5kcG9pbnRDb2xvcihhY3Rpdml0eSk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZW5kcG9pbnQ6ICdEb3QnLFxyXG4gICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcclxuICAgICAgICAgICAgcGFpbnRTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBwYWludENvbG9yLFxyXG4gICAgICAgICAgICAgICAgZmlsbDogcGFpbnRDb2xvcixcclxuICAgICAgICAgICAgICAgIHJhZGl1czogNyxcclxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlzU291cmNlOiB0cnVlLFxyXG4gICAgICAgICAgICBjb25uZWN0b3I6IFsnRmxvd2NoYXJ0JywgeyBzdHViOiBbNDAsIDYwXSwgZ2FwOiAwLCBjb3JuZXJSYWRpdXM6IDUsIGFsd2F5c1Jlc3BlY3RTdHViczogdHJ1ZSB9XSxcclxuICAgICAgICAgICAgY29ubmVjdG9yU3R5bGU6IHtcclxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzk5OTk5OScsXHJcbiAgICAgICAgICAgICAgICBqb2luc3R5bGU6ICdyb3VuZCcsXHJcbiAgICAgICAgICAgICAgICBvdXRsaW5lU3Ryb2tlOiAnd2hpdGUnLFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiAyXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGhvdmVyUGFpbnRTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgZmlsbDogJyMyMTY0NzcnLFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzIxNjQ3NydcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29ubmVjdG9ySG92ZXJTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDMsXHJcbiAgICAgICAgICAgICAgICBzdHJva2U6ICcjMjE2NDc3JyxcclxuICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogNSxcclxuICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsb2NhdGlvbjogWzMsIC0xLjVdLCBjc3NDbGFzczogJ2VuZHBvaW50U291cmNlTGFiZWwnIH1dXSxcclxuICAgICAgICAgICAgZHJhZ09wdGlvbnM6IHt9LFxyXG4gICAgICAgICAgICB1dWlkOiBgJHthY3Rpdml0eS5pZH0tJHtvdXRjb21lLm5hbWV9YCxcclxuICAgICAgICAgICAgcGFyYW1ldGVyczoge1xyXG4gICAgICAgICAgICAgICAgb3V0Y29tZTogb3V0Y29tZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldEFjdGl2aXR5ID0gZnVuY3Rpb24gKGlkOiBzdHJpbmcsIGFjdGl2aXRpZXM6IEFycmF5PFdvcmtmbG93cy5BY3Rpdml0eT4gPSBudWxsKTogV29ya2Zsb3dzLkFjdGl2aXR5IHtcclxuICAgICAgICBpZiAoIWFjdGl2aXRpZXMpIHtcclxuICAgICAgICAgICAgYWN0aXZpdGllcyA9IHRoaXMud29ya2Zsb3dUeXBlLmFjdGl2aXRpZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAkLmdyZXAoYWN0aXZpdGllcywgKHg6IFdvcmtmbG93cy5BY3Rpdml0eSkgPT4geC5pZCA9PT0gaWQpWzBdO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCB1cGRhdGVDb25uZWN0aW9ucyA9IChwbHVtYmVyOiBqc1BsdW1iSW5zdGFuY2UpID0+IHtcclxuICAgICAgICB2YXIgd29ya2Zsb3dJZDogbnVtYmVyID0gdGhpcy53b3JrZmxvd1R5cGUuaWQ7XHJcblxyXG4gICAgICAgIC8vIENvbm5lY3QgYWN0aXZpdGllcy5cclxuICAgICAgICBmb3IgKGxldCB0cmFuc2l0aW9uTW9kZWwgb2YgdGhpcy53b3JrZmxvd1R5cGUudHJhbnNpdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnRVdWlkOiBzdHJpbmcgPSBgJHt0cmFuc2l0aW9uTW9kZWwuc291cmNlQWN0aXZpdHlJZH0tJHt0cmFuc2l0aW9uTW9kZWwuc291cmNlT3V0Y29tZU5hbWV9YDtcclxuICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnQ6IEVuZHBvaW50ID0gcGx1bWJlci5nZXRFbmRwb2ludChzb3VyY2VFbmRwb2ludFV1aWQpO1xyXG4gICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbkVsZW1lbnRJZDogc3RyaW5nID0gYGFjdGl2aXR5LSR7d29ya2Zsb3dJZH0tJHt0cmFuc2l0aW9uTW9kZWwuZGVzdGluYXRpb25BY3Rpdml0eUlkfWA7XHJcblxyXG4gICAgICAgICAgICBwbHVtYmVyLmNvbm5lY3Qoe1xyXG4gICAgICAgICAgICAgICAgc291cmNlOiBzb3VyY2VFbmRwb2ludCxcclxuICAgICAgICAgICAgICAgIHRhcmdldDogZGVzdGluYXRpb25FbGVtZW50SWRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCB1cGRhdGVDYW52YXNIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgJGNvbnRhaW5lciA9ICQodGhpcy5jb250YWluZXIpO1xyXG5cclxuICAgICAgICAvLyBHZXQgdGhlIGFjdGl2aXR5IGVsZW1lbnQgd2l0aCB0aGUgaGlnaGVzdCBZIGNvb3JkaW5hdGUuXHJcbiAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudHMgPSAkY29udGFpbmVyLmZpbmQoXCIuYWN0aXZpdHlcIik7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRFbGVtZW50VG9wID0gMDtcclxuICAgICAgICBsZXQgY3VycmVudEFjdGl2aXR5SGVpZ2h0ID0gMDtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgYWN0aXZpdHlFbGVtZW50IG9mICRhY3Rpdml0eUVsZW1lbnRzLnRvQXJyYXkoKSkge1xyXG4gICAgICAgICAgICBjb25zdCAkYWN0aXZpdHlFbGVtZW50ID0gJChhY3Rpdml0eUVsZW1lbnQpO1xyXG4gICAgICAgICAgICBjb25zdCB0b3AgPSAkYWN0aXZpdHlFbGVtZW50LnBvc2l0aW9uKCkudG9wO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRvcCA+IGN1cnJlbnRFbGVtZW50VG9wKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50RWxlbWVudFRvcCA9IHRvcDtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRBY3Rpdml0eUhlaWdodCA9ICRhY3Rpdml0eUVsZW1lbnQuaGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBuZXdDYW52YXNIZWlnaHQgPSBjdXJyZW50RWxlbWVudFRvcCArIGN1cnJlbnRBY3Rpdml0eUhlaWdodDtcclxuICAgICAgICBjb25zdCBlbGVtZW50Qm90dG9tID0gY3VycmVudEVsZW1lbnRUb3AgKyBjdXJyZW50QWN0aXZpdHlIZWlnaHQ7XHJcbiAgICAgICAgY29uc3Qgc3RyZXRjaFZhbHVlID0gMTAwO1xyXG5cclxuICAgICAgICBpZiAobmV3Q2FudmFzSGVpZ2h0IC0gZWxlbWVudEJvdHRvbSA8PSBzdHJldGNoVmFsdWUpIHtcclxuICAgICAgICAgICAgbmV3Q2FudmFzSGVpZ2h0ICs9IHN0cmV0Y2hWYWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjb250YWluZXIuaGVpZ2h0KE1hdGgubWF4KHRoaXMubWluQ2FudmFzSGVpZ2h0LCBuZXdDYW52YXNIZWlnaHQpKTtcclxuICAgIH07XHJcbn1cclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pzcGx1bWIvdHlwaW5ncy5kLnRzJyAvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPScuL3dvcmtmbG93LW1vZGVscy50cycgLz5cbnZhciBXb3JrZmxvd0NhbnZhcyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBXb3JrZmxvd0NhbnZhcyhjb250YWluZXIsIHdvcmtmbG93VHlwZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICAgICAgdGhpcy53b3JrZmxvd1R5cGUgPSB3b3JrZmxvd1R5cGU7XG4gICAgICAgIHRoaXMubWluQ2FudmFzSGVpZ2h0ID0gNDAwO1xuICAgICAgICB0aGlzLmdldEFjdGl2aXR5RWxlbWVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJChfdGhpcy5jb250YWluZXIpLmZpbmQoJy5hY3Rpdml0eScpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldERlZmF1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBBbmNob3I6IFwiQ29udGludW91c1wiLFxuICAgICAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcbiAgICAgICAgICAgICAgICBFbmRwb2ludFN0eWxlczogW3sgZmlsbFN0eWxlOiAnIzIyNTU4OCcgfV0sXG4gICAgICAgICAgICAgICAgRW5kcG9pbnRzOiBbW1wiRG90XCIsIHsgcmFkaXVzOiA3IH1dLCBbXCJCbGFua1wiXV0sXG4gICAgICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXG4gICAgICAgICAgICAgICAgICAgIFtcIkFycm93XCIsIHsgd2lkdGg6IDEyLCBsZW5ndGg6IDEyLCBsb2NhdGlvbjogLTUgfV0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBDb25uZWN0b3JaSW5kZXg6IDVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY3JlYXRlSnNQbHVtYkluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGpzUGx1bWIuZ2V0SW5zdGFuY2Uoe1xuICAgICAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcbiAgICAgICAgICAgICAgICBDb25uZWN0aW9uT3ZlcmxheXM6IFtcbiAgICAgICAgICAgICAgICAgICAgWydBcnJvdycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IDExXG4gICAgICAgICAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICAgICAgWydMYWJlbCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogMC41LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnbGFiZWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnY29ubmVjdGlvbi1sYWJlbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBDb250YWluZXI6IF90aGlzLmNvbnRhaW5lclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ2V0RW5kcG9pbnRDb2xvciA9IGZ1bmN0aW9uIChhY3Rpdml0eSkge1xuICAgICAgICAgICAgcmV0dXJuIGFjdGl2aXR5LmlzQmxvY2tpbmcgfHwgYWN0aXZpdHkuaXNTdGFydCA/ICcjN2FiMDJjJyA6IGFjdGl2aXR5LmlzRXZlbnQgPyAnIzNhOGFjZCcgOiAnIzdhYjAyYyc7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zID0gZnVuY3Rpb24gKGFjdGl2aXR5LCBvdXRjb21lKSB7XG4gICAgICAgICAgICAvLyBUaGUgZGVmaW5pdGlvbiBvZiBzb3VyY2UgZW5kcG9pbnRzLlxuICAgICAgICAgICAgdmFyIHBhaW50Q29sb3IgPSBfdGhpcy5nZXRFbmRwb2ludENvbG9yKGFjdGl2aXR5KTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdEb3QnLFxuICAgICAgICAgICAgICAgIGFuY2hvcjogJ0NvbnRpbnVvdXMnLFxuICAgICAgICAgICAgICAgIHBhaW50U3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiBwYWludENvbG9yLFxuICAgICAgICAgICAgICAgICAgICBmaWxsOiBwYWludENvbG9yLFxuICAgICAgICAgICAgICAgICAgICByYWRpdXM6IDcsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpc1NvdXJjZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb25uZWN0b3I6IFsnRmxvd2NoYXJ0JywgeyBzdHViOiBbNDAsIDYwXSwgZ2FwOiAwLCBjb3JuZXJSYWRpdXM6IDUsIGFsd2F5c1Jlc3BlY3RTdHViczogdHJ1ZSB9XSxcbiAgICAgICAgICAgICAgICBjb25uZWN0b3JTdHlsZToge1xuICAgICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMixcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzk5OTk5OScsXG4gICAgICAgICAgICAgICAgICAgIGpvaW5zdHlsZTogJ3JvdW5kJyxcbiAgICAgICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogJ3doaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiAyXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBob3ZlclBhaW50U3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZmlsbDogJyMyMTY0NzcnLFxuICAgICAgICAgICAgICAgICAgICBzdHJva2U6ICcjMjE2NDc3J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29ubmVjdG9ySG92ZXJTdHlsZToge1xuICAgICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMyxcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzIxNjQ3NycsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogNSxcbiAgICAgICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogJ3doaXRlJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsb2NhdGlvbjogWzMsIC0xLjVdLCBjc3NDbGFzczogJ2VuZHBvaW50U291cmNlTGFiZWwnIH1dXSxcbiAgICAgICAgICAgICAgICBkcmFnT3B0aW9uczoge30sXG4gICAgICAgICAgICAgICAgdXVpZDogXCJcIi5jb25jYXQoYWN0aXZpdHkuaWQsIFwiLVwiKS5jb25jYXQob3V0Y29tZS5uYW1lKSxcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIG91dGNvbWU6IG91dGNvbWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldEFjdGl2aXR5ID0gZnVuY3Rpb24gKGlkLCBhY3Rpdml0aWVzKSB7XG4gICAgICAgICAgICBpZiAoYWN0aXZpdGllcyA9PT0gdm9pZCAwKSB7IGFjdGl2aXRpZXMgPSBudWxsOyB9XG4gICAgICAgICAgICBpZiAoIWFjdGl2aXRpZXMpIHtcbiAgICAgICAgICAgICAgICBhY3Rpdml0aWVzID0gdGhpcy53b3JrZmxvd1R5cGUuYWN0aXZpdGllcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkLmdyZXAoYWN0aXZpdGllcywgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguaWQgPT09IGlkOyB9KVswXTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy51cGRhdGVDb25uZWN0aW9ucyA9IGZ1bmN0aW9uIChwbHVtYmVyKSB7XG4gICAgICAgICAgICB2YXIgd29ya2Zsb3dJZCA9IF90aGlzLndvcmtmbG93VHlwZS5pZDtcbiAgICAgICAgICAgIC8vIENvbm5lY3QgYWN0aXZpdGllcy5cbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBfdGhpcy53b3JrZmxvd1R5cGUudHJhbnNpdGlvbnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRyYW5zaXRpb25Nb2RlbCA9IF9hW19pXTtcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlRW5kcG9pbnRVdWlkID0gXCJcIi5jb25jYXQodHJhbnNpdGlvbk1vZGVsLnNvdXJjZUFjdGl2aXR5SWQsIFwiLVwiKS5jb25jYXQodHJhbnNpdGlvbk1vZGVsLnNvdXJjZU91dGNvbWVOYW1lKTtcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlRW5kcG9pbnQgPSBwbHVtYmVyLmdldEVuZHBvaW50KHNvdXJjZUVuZHBvaW50VXVpZCk7XG4gICAgICAgICAgICAgICAgdmFyIGRlc3RpbmF0aW9uRWxlbWVudElkID0gXCJhY3Rpdml0eS1cIi5jb25jYXQod29ya2Zsb3dJZCwgXCItXCIpLmNvbmNhdCh0cmFuc2l0aW9uTW9kZWwuZGVzdGluYXRpb25BY3Rpdml0eUlkKTtcbiAgICAgICAgICAgICAgICBwbHVtYmVyLmNvbm5lY3Qoe1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IHNvdXJjZUVuZHBvaW50LFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IGRlc3RpbmF0aW9uRWxlbWVudElkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudXBkYXRlQ2FudmFzSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyICRjb250YWluZXIgPSAkKHRoaXMuY29udGFpbmVyKTtcbiAgICAgICAgICAgIC8vIEdldCB0aGUgYWN0aXZpdHkgZWxlbWVudCB3aXRoIHRoZSBoaWdoZXN0IFkgY29vcmRpbmF0ZS5cbiAgICAgICAgICAgIHZhciAkYWN0aXZpdHlFbGVtZW50cyA9ICRjb250YWluZXIuZmluZChcIi5hY3Rpdml0eVwiKTtcbiAgICAgICAgICAgIHZhciBjdXJyZW50RWxlbWVudFRvcCA9IDA7XG4gICAgICAgICAgICB2YXIgY3VycmVudEFjdGl2aXR5SGVpZ2h0ID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSAkYWN0aXZpdHlFbGVtZW50cy50b0FycmF5KCk7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5RWxlbWVudCA9IF9hW19pXTtcbiAgICAgICAgICAgICAgICB2YXIgJGFjdGl2aXR5RWxlbWVudCA9ICQoYWN0aXZpdHlFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB2YXIgdG9wXzEgPSAkYWN0aXZpdHlFbGVtZW50LnBvc2l0aW9uKCkudG9wO1xuICAgICAgICAgICAgICAgIGlmICh0b3BfMSA+IGN1cnJlbnRFbGVtZW50VG9wKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRFbGVtZW50VG9wID0gdG9wXzE7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBY3Rpdml0eUhlaWdodCA9ICRhY3Rpdml0eUVsZW1lbnQuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG5ld0NhbnZhc0hlaWdodCA9IGN1cnJlbnRFbGVtZW50VG9wICsgY3VycmVudEFjdGl2aXR5SGVpZ2h0O1xuICAgICAgICAgICAgdmFyIGVsZW1lbnRCb3R0b20gPSBjdXJyZW50RWxlbWVudFRvcCArIGN1cnJlbnRBY3Rpdml0eUhlaWdodDtcbiAgICAgICAgICAgIHZhciBzdHJldGNoVmFsdWUgPSAxMDA7XG4gICAgICAgICAgICBpZiAobmV3Q2FudmFzSGVpZ2h0IC0gZWxlbWVudEJvdHRvbSA8PSBzdHJldGNoVmFsdWUpIHtcbiAgICAgICAgICAgICAgICBuZXdDYW52YXNIZWlnaHQgKz0gc3RyZXRjaFZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGNvbnRhaW5lci5oZWlnaHQoTWF0aC5tYXgodGhpcy5taW5DYW52YXNIZWlnaHQsIG5ld0NhbnZhc0hlaWdodCkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gV29ya2Zsb3dDYW52YXM7XG59KCkpO1xuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50cycgLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanNwbHVtYi90eXBpbmdzLmQudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1jYW52YXMudHMnIC8+XHJcblxyXG5jbGFzcyBXb3JrZmxvd1ZpZXdlciBleHRlbmRzIFdvcmtmbG93Q2FudmFzIHtcclxuICAgIHByaXZhdGUganNQbHVtYkluc3RhbmNlOiBqc1BsdW1iSW5zdGFuY2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHByb3RlY3RlZCB3b3JrZmxvd1R5cGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUpIHtcclxuICAgICAgICBzdXBlcihjb250YWluZXIsIHdvcmtmbG93VHlwZSk7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIGpzUGx1bWIucmVhZHkoKCkgPT4ge1xyXG4gICAgICAgICAgICBqc1BsdW1iLmltcG9ydERlZmF1bHRzKHRoaXMuZ2V0RGVmYXVsdHMoKSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBwbHVtYmVyID0gdGhpcy5jcmVhdGVKc1BsdW1iSW5zdGFuY2UoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIExpc3RlbiBmb3IgbmV3IGNvbm5lY3Rpb25zLlxyXG4gICAgICAgICAgICBwbHVtYmVyLmJpbmQoJ2Nvbm5lY3Rpb24nLCBmdW5jdGlvbiAoY29ubkluZm8sIG9yaWdpbmFsRXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb246IENvbm5lY3Rpb24gPSBjb25uSW5mby5jb25uZWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3V0Y29tZTogV29ya2Zsb3dzLk91dGNvbWUgPSBjb25uZWN0aW9uLmdldFBhcmFtZXRlcnMoKS5vdXRjb21lO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsOiBhbnkgPSBjb25uZWN0aW9uLmdldE92ZXJsYXkoJ2xhYmVsJyk7XHJcbiAgICAgICAgICAgICAgICBsYWJlbC5zZXRMYWJlbChvdXRjb21lLmRpc3BsYXlOYW1lKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgYWN0aXZpdHlFbGVtZW50cyA9IHRoaXMuZ2V0QWN0aXZpdHlFbGVtZW50cygpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFyZUVxdWFsT3V0Y29tZXMgPSBmdW5jdGlvbiAob3V0Y29tZXMxOiBXb3JrZmxvd3MuT3V0Y29tZVtdLCBvdXRjb21lczI6IFdvcmtmbG93cy5PdXRjb21lW10pOiBib29sZWFuIHtcclxuICAgICAgICAgICAgICAgIGlmIChvdXRjb21lczEubGVuZ3RoICE9IG91dGNvbWVzMi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvdXRjb21lczEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdXRjb21lMSA9IG91dGNvbWVzMVtpXTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdXRjb21lMiA9IG91dGNvbWVzMltpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG91dGNvbWUxLm5hbWUgIT0gb3V0Y29tZTIuZGlzcGxheU5hbWUgfHwgb3V0Y29tZTEuZGlzcGxheU5hbWUgIT0gb3V0Y29tZTIuZGlzcGxheU5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gU3VzcGVuZCBkcmF3aW5nIGFuZCBpbml0aWFsaXplLlxyXG4gICAgICAgICAgICBwbHVtYmVyLmJhdGNoKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciB3b3JrZmxvd0lkOiBudW1iZXIgPSB0aGlzLndvcmtmbG93VHlwZS5pZDtcclxuXHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLmVhY2goKF8sIGFjdGl2aXR5RWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0ICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktaWQnKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpdml0eSA9IHRoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIENvbmZpZ3VyZSB0aGUgYWN0aXZpdHkgYXMgYSB0YXJnZXQuXHJcbiAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5tYWtlVGFyZ2V0KGFjdGl2aXR5RWxlbWVudCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wT3B0aW9uczogeyBob3ZlckNsYXNzOiAnaG92ZXInIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogJ0NvbnRpbnVvdXMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogWydCbGFuaycsIHsgcmFkaXVzOiA4IH1dXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCBzb3VyY2UgZW5kcG9pbnRzLlxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG91dGNvbWUgb2YgYWN0aXZpdHkub3V0Y29tZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnRPcHRpb25zID0gdGhpcy5nZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMoYWN0aXZpdHksIG91dGNvbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLmFkZEVuZHBvaW50KGFjdGl2aXR5RWxlbWVudCwgeyBjb25uZWN0b3JPdmVybGF5czogW1snTGFiZWwnLCB7IGxhYmVsOiBvdXRjb21lLmRpc3BsYXlOYW1lLCBjc3NDbGFzczogJ2Nvbm5lY3Rpb24tbGFiZWwnIH1dXSB9LCBzb3VyY2VFbmRwb2ludE9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENvbm5lY3QgYWN0aXZpdGllcy5cclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ29ubmVjdGlvbnMocGx1bWJlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmUtcXVlcnkgdGhlIGFjdGl2aXR5IGVsZW1lbnRzLlxyXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cyA9IHRoaXMuZ2V0QWN0aXZpdHlFbGVtZW50cygpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE1ha2UgYWxsIGFjdGl2aXR5IGVsZW1lbnRzIHZpc2libGUuXHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnNob3coKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNhbnZhc0hlaWdodCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuanNQbHVtYkluc3RhbmNlID0gcGx1bWJlcjtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0RW5kcG9pbnRDb2xvciA9IChhY3Rpdml0eTogV29ya2Zsb3dzLkFjdGl2aXR5KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGFjdGl2aXR5LmlzQmxvY2tpbmcgPyAnIzdhYjAyYycgOiBhY3Rpdml0eS5pc0V2ZW50ID8gJyMzYThhY2QnIDogJyM3YWIwMmMnO1xyXG4gICAgfVxyXG59XHJcblxyXG4kLmZuLndvcmtmbG93Vmlld2VyID0gZnVuY3Rpb24gKHRoaXM6IEpRdWVyeSk6IEpRdWVyeSB7XHJcbiAgICB0aGlzLmVhY2goKGluZGV4LCBlbGVtZW50KSA9PiB7XHJcbiAgICAgICAgdmFyICRlbGVtZW50ID0gJChlbGVtZW50KTtcclxuICAgICAgICB2YXIgd29ya2Zsb3dUeXBlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0gJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3ctdHlwZScpO1xyXG5cclxuICAgICAgICAkZWxlbWVudC5kYXRhKCd3b3JrZmxvd1ZpZXdlcicsIG5ldyBXb3JrZmxvd1ZpZXdlcihlbGVtZW50LCB3b3JrZmxvd1R5cGUpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3Qgd29ya2Zsb3dWaWV3ZXI6IFdvcmtmbG93Vmlld2VyID0gJCgnLndvcmtmbG93LWNhbnZhcycpLndvcmtmbG93Vmlld2VyKCkuZGF0YSgnd29ya2Zsb3dWaWV3ZXInKTtcclxufSk7XHJcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctY2FudmFzLnRzJyAvPlxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbnZhciBXb3JrZmxvd1ZpZXdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoV29ya2Zsb3dWaWV3ZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gV29ya2Zsb3dWaWV3ZXIoY29udGFpbmVyLCB3b3JrZmxvd1R5cGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgY29udGFpbmVyLCB3b3JrZmxvd1R5cGUpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICAgICAgX3RoaXMud29ya2Zsb3dUeXBlID0gd29ya2Zsb3dUeXBlO1xuICAgICAgICBfdGhpcy5nZXRFbmRwb2ludENvbG9yID0gZnVuY3Rpb24gKGFjdGl2aXR5KSB7XG4gICAgICAgICAgICByZXR1cm4gYWN0aXZpdHkuaXNCbG9ja2luZyA/ICcjN2FiMDJjJyA6IGFjdGl2aXR5LmlzRXZlbnQgPyAnIzNhOGFjZCcgOiAnIzdhYjAyYyc7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBzZWxmID0gX3RoaXM7XG4gICAgICAgIGpzUGx1bWIucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAganNQbHVtYi5pbXBvcnREZWZhdWx0cyhfdGhpcy5nZXREZWZhdWx0cygpKTtcbiAgICAgICAgICAgIHZhciBwbHVtYmVyID0gX3RoaXMuY3JlYXRlSnNQbHVtYkluc3RhbmNlKCk7XG4gICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIG5ldyBjb25uZWN0aW9ucy5cbiAgICAgICAgICAgIHBsdW1iZXIuYmluZCgnY29ubmVjdGlvbicsIGZ1bmN0aW9uIChjb25uSW5mbywgb3JpZ2luYWxFdmVudCkge1xuICAgICAgICAgICAgICAgIHZhciBjb25uZWN0aW9uID0gY29ubkluZm8uY29ubmVjdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IGNvbm5lY3Rpb24uZ2V0UGFyYW1ldGVycygpLm91dGNvbWU7XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gY29ubmVjdGlvbi5nZXRPdmVybGF5KCdsYWJlbCcpO1xuICAgICAgICAgICAgICAgIGxhYmVsLnNldExhYmVsKG91dGNvbWUuZGlzcGxheU5hbWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgYWN0aXZpdHlFbGVtZW50cyA9IF90aGlzLmdldEFjdGl2aXR5RWxlbWVudHMoKTtcbiAgICAgICAgICAgIHZhciBhcmVFcXVhbE91dGNvbWVzID0gZnVuY3Rpb24gKG91dGNvbWVzMSwgb3V0Y29tZXMyKSB7XG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWVzMS5sZW5ndGggIT0gb3V0Y29tZXMyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3V0Y29tZXMxLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvdXRjb21lMSA9IG91dGNvbWVzMVtpXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG91dGNvbWUyID0gb3V0Y29tZXMyW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAob3V0Y29tZTEubmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSB8fCBvdXRjb21lMS5kaXNwbGF5TmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIFN1c3BlbmQgZHJhd2luZyBhbmQgaW5pdGlhbGl6ZS5cbiAgICAgICAgICAgIHBsdW1iZXIuYmF0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB3b3JrZmxvd0lkID0gX3RoaXMud29ya2Zsb3dUeXBlLmlkO1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuZWFjaChmdW5jdGlvbiAoXywgYWN0aXZpdHlFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkYWN0aXZpdHlFbGVtZW50ID0gJChhY3Rpdml0eUVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlJZCA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5ID0gX3RoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIENvbmZpZ3VyZSB0aGUgYWN0aXZpdHkgYXMgYSB0YXJnZXQuXG4gICAgICAgICAgICAgICAgICAgIHBsdW1iZXIubWFrZVRhcmdldChhY3Rpdml0eUVsZW1lbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BPcHRpb25zOiB7IGhvdmVyQ2xhc3M6ICdob3ZlcicgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogJ0NvbnRpbnVvdXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFsnQmxhbmsnLCB7IHJhZGl1czogOCB9XVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNvdXJjZSBlbmRwb2ludHMuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBhY3Rpdml0eS5vdXRjb21lczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvdXRjb21lID0gX2FbX2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IF90aGlzLmdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyhhY3Rpdml0eSwgb3V0Y29tZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLmFkZEVuZHBvaW50KGFjdGl2aXR5RWxlbWVudCwgeyBjb25uZWN0b3JPdmVybGF5czogW1snTGFiZWwnLCB7IGxhYmVsOiBvdXRjb21lLmRpc3BsYXlOYW1lLCBjc3NDbGFzczogJ2Nvbm5lY3Rpb24tbGFiZWwnIH1dXSB9LCBzb3VyY2VFbmRwb2ludE9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gQ29ubmVjdCBhY3Rpdml0aWVzLlxuICAgICAgICAgICAgICAgIF90aGlzLnVwZGF0ZUNvbm5lY3Rpb25zKHBsdW1iZXIpO1xuICAgICAgICAgICAgICAgIC8vIFJlLXF1ZXJ5IHRoZSBhY3Rpdml0eSBlbGVtZW50cy5cbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzID0gX3RoaXMuZ2V0QWN0aXZpdHlFbGVtZW50cygpO1xuICAgICAgICAgICAgICAgIC8vIE1ha2UgYWxsIGFjdGl2aXR5IGVsZW1lbnRzIHZpc2libGUuXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5zaG93KCk7XG4gICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIF90aGlzLmpzUGx1bWJJbnN0YW5jZSA9IHBsdW1iZXI7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBXb3JrZmxvd1ZpZXdlcjtcbn0oV29ya2Zsb3dDYW52YXMpKTtcbiQuZm4ud29ya2Zsb3dWaWV3ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICB2YXIgd29ya2Zsb3dUeXBlID0gJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3ctdHlwZScpO1xuICAgICAgICAkZWxlbWVudC5kYXRhKCd3b3JrZmxvd1ZpZXdlcicsIG5ldyBXb3JrZmxvd1ZpZXdlcihlbGVtZW50LCB3b3JrZmxvd1R5cGUpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbn07XG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHdvcmtmbG93Vmlld2VyID0gJCgnLndvcmtmbG93LWNhbnZhcycpLndvcmtmbG93Vmlld2VyKCkuZGF0YSgnd29ya2Zsb3dWaWV3ZXInKTtcbn0pO1xuIl19
