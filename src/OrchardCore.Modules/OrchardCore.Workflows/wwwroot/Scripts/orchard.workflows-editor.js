/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path='../Lib/jquery/typings.d.ts' />
var applyFilter = function applyFilter(category, q) {
  var type = $('.modal-activities').data('activity-type');
  category = category || $('.activity-picker-categories .nav-link.active').attr('href').substr(1);
  q = q || $('.modal-activities input[type=search]').val();
  var $cards = $('.activity.col').show();
  // Remove activities whoes type doesn't match the configured activity type.
  $cards.filter(function (i, el) {
    return $(el).data('activity-type') != type;
  }).hide();
  if (q.length > 0) {
    // Remove activities whose title doesn't match the query.
    $cards.filter(function (i, el) {
      return $(el).find('.card-title').text().toLowerCase().indexOf(q.toLowerCase()) < 0 && q && q.length > 0;
    }).hide();
  } else {
    // Remove activities whose category doesn't match the selected one.
    $cards.filter(function (i, el) {
      return $(el).data('category').toLowerCase() != category.toLowerCase() && category.toLowerCase() != 'all';
    }).hide();
  }
  // Show or hide categories based on whether there are any available activities.
  $('.activity-picker-categories [data-category]').each(function (i, el) {
    var categoryListItem = $(el);
    var category = categoryListItem.data('category');
    // Count number of activities within this category and for the specified activity type (Event or Task).
    var activityCount = $(".activity.col[data-category='".concat(category, "'][data-activity-type='").concat(type, "']")).length;
    activityCount == 0 ? categoryListItem.hide() : categoryListItem.show();
  });
};
$(function () {
  $('.activity-picker-categories').on('click', '.nav-link', function (e) {
    applyFilter($(e.target).attr('href').substr(1), null);
  });
  $('.modal-activities input[type=search]').on('keyup', function (e) {
    applyFilter(null, $(e.target).val());
  });
  $('#activity-picker').on('show.bs.modal', function (event) {
    var modalEvent = event;
    var button = $(modalEvent.relatedTarget); // Button that triggered the modal.
    var title = button.data('picker-title');
    var type = button.data('activity-type');
    var modal = $(this);
    modal.find('[href="#all"]').click();
    modal.find('.modal-title').text(title);
    modal.data('activity-type', type);
    applyFilter(null, null);
  });
});
///<reference path="../../../Assets/Lib/jquery/typings.d.ts" />
$(function () {
  var generateWorkflowUrl = function generateWorkflowUrl() {
    var workflowTypeId = $('[data-workflow-type-id]').data('workflow-type-id');
    var activityId = $('[data-activity-id]').data('activity-id');
    var tokenLifeSpan = $('#token-lifespan').val();
    var generateUrl = $('[data-generate-url]').data('generate-url') + "?workflowTypeId=".concat(workflowTypeId, "&activityId=").concat(activityId, "&tokenLifeSpan=").concat(tokenLifeSpan);
    var antiforgeryHeaderName = $('[data-antiforgery-header-name]').data('antiforgery-header-name');
    var antiforgeryToken = $('[data-antiforgery-token]').data('antiforgery-token');
    var headers = {};
    headers[antiforgeryHeaderName] = antiforgeryToken;
    $.post({
      url: generateUrl,
      headers: headers
    }).done(function (url) {
      $('#workflow-url-text').val(url);
    });
  };
  $('#generate-url-button').on('click', function (e) {
    generateWorkflowUrl();
  });
  if ($('#workflow-url-text').val() == '') {
    generateWorkflowUrl();
  }
});
///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
var WorkflowCanvas = /** @class */function () {
  function WorkflowCanvas(container, workflowType) {
    var _this = this;
    this.container = container;
    this.workflowType = workflowType;
    this.minCanvasHeight = 400;
    this.getActivityElements = function () {
      return $(_this.container).find('.activity');
    };
    this.getDefaults = function () {
      return {
        Anchor: "Continuous",
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        EndpointStyles: [{
          fillStyle: '#225588'
        }],
        Endpoints: [["Dot", {
          radius: 7
        }], ["Blank"]],
        ConnectionOverlays: [["Arrow", {
          width: 12,
          length: 12,
          location: -5
        }]],
        ConnectorZIndex: 5
      };
    };
    this.createJsPlumbInstance = function () {
      return jsPlumb.getInstance({
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        ConnectionOverlays: [['Arrow', {
          location: 1,
          visible: true,
          width: 11,
          length: 11
        }], ['Label', {
          location: 0.5,
          id: 'label',
          cssClass: 'connection-label'
        }]],
        Container: _this.container
      });
    };
    this.getEndpointColor = function (activity) {
      return activity.isBlocking || activity.isStart ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };
    this.getSourceEndpointOptions = function (activity, outcome) {
      // The definition of source endpoints.
      var paintColor = _this.getEndpointColor(activity);
      return {
        endpoint: 'Dot',
        anchor: 'Continuous',
        paintStyle: {
          stroke: paintColor,
          fill: paintColor,
          radius: 7,
          strokeWidth: 1
        },
        isSource: true,
        connector: ['Flowchart', {
          stub: [40, 60],
          gap: 0,
          cornerRadius: 5,
          alwaysRespectStubs: true
        }],
        connectorStyle: {
          strokeWidth: 2,
          stroke: '#999999',
          joinstyle: 'round',
          outlineStroke: 'white',
          outlineWidth: 2
        },
        hoverPaintStyle: {
          fill: '#216477',
          stroke: '#216477'
        },
        connectorHoverStyle: {
          strokeWidth: 3,
          stroke: '#216477',
          outlineWidth: 5,
          outlineStroke: 'white'
        },
        connectorOverlays: [['Label', {
          location: [3, -1.5],
          cssClass: 'endpointSourceLabel'
        }]],
        dragOptions: {},
        uuid: "".concat(activity.id, "-").concat(outcome.name),
        parameters: {
          outcome: outcome
        }
      };
    };
    this.getActivity = function (id, activities) {
      if (activities === void 0) {
        activities = null;
      }
      if (!activities) {
        activities = this.workflowType.activities;
      }
      return $.grep(activities, function (x) {
        return x.id === id;
      })[0];
    };
    this.updateConnections = function (plumber) {
      var workflowId = _this.workflowType.id;
      // Connect activities.
      for (var _i = 0, _a = _this.workflowType.transitions; _i < _a.length; _i++) {
        var transitionModel = _a[_i];
        var sourceEndpointUuid = "".concat(transitionModel.sourceActivityId, "-").concat(transitionModel.sourceOutcomeName);
        var sourceEndpoint = plumber.getEndpoint(sourceEndpointUuid);
        var destinationElementId = "activity-".concat(workflowId, "-").concat(transitionModel.destinationActivityId);
        plumber.connect({
          source: sourceEndpoint,
          target: destinationElementId
        });
      }
    };
    this.updateCanvasHeight = function () {
      var $container = $(this.container);
      // Get the activity element with the highest Y coordinate.
      var $activityElements = $container.find(".activity");
      var currentElementTop = 0;
      var currentActivityHeight = 0;
      for (var _i = 0, _a = $activityElements.toArray(); _i < _a.length; _i++) {
        var activityElement = _a[_i];
        var $activityElement = $(activityElement);
        var top_1 = $activityElement.position().top;
        if (top_1 > currentElementTop) {
          currentElementTop = top_1;
          currentActivityHeight = $activityElement.height();
        }
      }
      var newCanvasHeight = currentElementTop + currentActivityHeight;
      var elementBottom = currentElementTop + currentActivityHeight;
      var stretchValue = 100;
      if (newCanvasHeight - elementBottom <= stretchValue) {
        newCanvasHeight += stretchValue;
      }
      $container.height(Math.max(this.minCanvasHeight, newCanvasHeight));
    };
  }
  return WorkflowCanvas;
}();
///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
///<reference path='./workflow-canvas.ts' />
var __extends = this && this.__extends || function () {
  var _extendStatics = function extendStatics(d, b) {
    _extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
    };
    return _extendStatics(d, b);
  };
  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    _extendStatics(d, b);
    function __() {
      this.constructor = d;
    }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();
// TODO: Re-implement this using a MVVM approach.
var WorkflowEditor = /** @class */function (_super) {
  __extends(WorkflowEditor, _super);
  function WorkflowEditor(container, workflowType, deleteActivityPrompt, localId, loadLocalState) {
    var _this = _super.call(this, container, workflowType) || this;
    _this.container = container;
    _this.workflowType = workflowType;
    _this.deleteActivityPrompt = deleteActivityPrompt;
    _this.localId = localId;
    _this.getState = function () {
      var $allActivityElements = $(_this.container).find('.activity');
      var workflow = {
        id: _this.workflowType.id,
        activities: [],
        transitions: [],
        removedActivities: _this.workflowType.removedActivities
      };
      // Collect activities.
      for (var i = 0; i < $allActivityElements.length; i++) {
        var $activityElement = $($allActivityElements[i]);
        var activityId = $activityElement.data('activity-id');
        var activityIsStart = $activityElement.data('activity-start');
        var activityIsEvent = $activityElement.data('activity-type') === 'Event';
        var activityPosition = $activityElement.position();
        var activity = _this.getActivity(activityId);
        workflow.activities.push({
          id: activityId,
          isStart: activityIsStart,
          isEvent: activityIsEvent,
          outcomes: activity.outcomes,
          x: activityPosition.left,
          y: activityPosition.top
        });
      }
      // Collect connections.
      var allConnections = _this.jsPlumbInstance.getConnections();
      for (var i = 0; i < allConnections.length; i++) {
        var connection = allConnections[i];
        var sourceEndpoint = connection.endpoints[0];
        var sourceOutcomeName = sourceEndpoint.getParameters().outcome.name;
        var sourceActivityId = $(connection.source).data('activity-id');
        var destinationActivityId = $(connection.target).data('activity-id');
        workflow.transitions.push({
          sourceActivityId: sourceActivityId,
          destinationActivityId: destinationActivityId,
          sourceOutcomeName: sourceOutcomeName
        });
      }
      return workflow;
    };
    _this.serialize = function () {
      var workflow = _this.getState();
      return JSON.stringify(workflow);
    };
    _this.saveLocalState = function () {
      sessionStorage[_this.localId] = _this.serialize();
    };
    _this.loadLocalState = function () {
      return JSON.parse(sessionStorage[_this.localId]);
    };
    var self = _this;
    jsPlumb.ready(function () {
      jsPlumb.importDefaults(_this.getDefaults());
      var plumber = _this.createJsPlumbInstance();
      // Listen for new connections.
      plumber.bind('connection', function (connInfo, originalEvent) {
        var connection = connInfo.connection;
        var outcome = connection.getParameters().outcome;
        var label = connection.getOverlay('label');
        label.setLabel(outcome.displayName);
      });
      var activityElements = _this.getActivityElements();
      var areEqualOutcomes = function areEqualOutcomes(outcomes1, outcomes2) {
        if (outcomes1.length != outcomes2.length) {
          return false;
        }
        for (var i = 0; i < outcomes1.length; i++) {
          var outcome1 = outcomes1[i];
          var outcome2 = outcomes2[i];
          if (outcome1.name != outcome2.displayName || outcome1.displayName != outcome2.displayName) {
            return false;
          }
        }
        return true;
      };
      // Suspend drawing and initialize.
      plumber.batch(function () {
        var serverworkflowType = _this.workflowType;
        var workflowId = _this.workflowType.id;
        if (loadLocalState) {
          var localState = _this.loadLocalState();
          if (localState) {
            _this.workflowType = localState;
          }
        }
        activityElements.each(function (_, activityElement) {
          var $activityElement = $(activityElement);
          var activityId = $activityElement.data('activity-id');
          var isDeleted = _this.workflowType.removedActivities.indexOf(activityId) > -1;
          if (isDeleted) {
            $activityElement.remove();
            return;
          }
          var activity = _this.getActivity(activityId);
          var serverActivity = _this.getActivity(activityId, serverworkflowType.activities);
          // Update the activity's visual state.
          if (loadLocalState) {
            if (activity == null) {
              // This is a newly added activity not yet added to local state.
              activity = serverActivity;
              _this.workflowType.activities.push(activity);
              activity.x = 50;
              activity.y = 50;
            } else {
              // The available outcomes might have changed when editing an activity,
              // so we need to check for that and update the client's activity outcomes if so.
              var sameOutcomes = areEqualOutcomes(activity.outcomes, serverActivity.outcomes);
              if (!sameOutcomes) {
                activity.outcomes = serverActivity.outcomes;
              }
              $activityElement.css({
                left: activity.x,
                top: activity.y
              }).toggleClass('activity-start', activity.isStart).data('activity-start', activity.isStart);
            }
          }
          // Make the activity draggable.
          plumber.draggable(activityElement, {
            grid: [10, 10],
            containment: true,
            start: function start(args) {
              _this.dragStart = {
                left: args.e.screenX,
                top: args.e.screenY
              };
            },
            stop: function stop(args) {
              _this.hasDragged = _this.dragStart.left != args.e.screenX || _this.dragStart.top != args.e.screenY;
              _this.updateCanvasHeight();
            }
          });
          // Configure the activity as a target.
          plumber.makeTarget(activityElement, {
            dropOptions: {
              hoverClass: 'hover'
            },
            anchor: 'Continuous',
            endpoint: ['Blank', {
              radius: 8
            }]
          });
          // Add source endpoints.
          for (var _i = 0, _a = activity.outcomes; _i < _a.length; _i++) {
            var outcome = _a[_i];
            var sourceEndpointOptions = _this.getSourceEndpointOptions(activity, outcome);
            plumber.addEndpoint(activityElement, {
              connectorOverlays: [['Label', {
                label: outcome.displayName,
                cssClass: 'connection-label'
              }]]
            }, sourceEndpointOptions);
          }
        });
        // Connect activities.
        _this.updateConnections(plumber);
        // Re-query the activity elements.
        activityElements = _this.getActivityElements();
        // Make all activity elements visible.
        activityElements.show();
        _this.updateCanvasHeight();
      });
      // Initialize popovers.
      activityElements.each(function (_, item) {
        var activityElement = $(item);
        activityElement.popover({
          trigger: 'manual',
          html: true,
          content: function content() {
            var $content = activityElement.find('.activity-commands').clone();
            var startButton = $content.find('.activity-start-action');
            var isStart = activityElement.data('activity-start') === true;
            var activityId = activityElement.data('activity-id');
            startButton.attr('aria-pressed', activityElement.data('activity-start'));
            startButton.toggleClass('active', isStart);
            $content.on('click', '.activity-start-action', function (e) {
              e.preventDefault();
              var button = $(e.currentTarget);
              var isStart = button.is('.active');
              activityElement.data('activity-start', isStart);
              activityElement.toggleClass('activity-start', isStart);
            });
            $content.on('click', '.activity-delete-action', function (e) {
              e.preventDefault();
              // TODO: The prompts are really annoying. Consider showing some sort of small message balloon somewhere to undo the action instead.
              //if (!confirm(self.deleteActivityPrompt)) {
              //    return;
              //}
              self.workflowType.removedActivities.push(activityId);
              plumber.remove(activityElement);
              activityElement.popover('dispose');
            });
            $content.on('click', '[data-persist-workflow]', function (e) {
              self.saveLocalState();
            });
            return $content.get(0);
          }
        });
      });
      $(container).on('click', '.activity', function (e) {
        if (_this.hasDragged) {
          _this.hasDragged = false;
          return;
        }
        // if any other popovers are visible, hide them
        if (_this.isPopoverVisible) {
          activityElements.popover('hide');
        }
        var sender = $(e.currentTarget);
        sender.popover('show');
        // handle clicking on the popover itself.
        $('.popover').off('click').on('click', function (e2) {
          e2.stopPropagation();
        });
        e.stopPropagation();
        _this.isPopoverVisible = true;
      });
      $(container).on('dblclick', '.activity', function (e) {
        var sender = $(e.currentTarget);
        var hasEditor = sender.data('activity-has-editor');
        if (hasEditor) {
          _this.saveLocalState();
          sender.find('.activity-edit-action').get(0).click();
        }
      });
      // Hide all popovers when clicking anywhere but on an activity.
      $('body').on('click', function (e) {
        activityElements.popover('hide');
        _this.isPopoverVisible = false;
      });
      // Save local changes if the event target has the 'data-persist-workflow' attribute.
      $('body').on('click', '[data-persist-workflow]', function (e) {
        _this.saveLocalState();
      });
      _this.jsPlumbInstance = plumber;
    });
    return _this;
  }
  return WorkflowEditor;
}(WorkflowCanvas);
$.fn.workflowEditor = function () {
  this.each(function (index, element) {
    var $element = $(element);
    var workflowType = $element.data('workflow-type');
    var deleteActivityPrompt = $element.data('workflow-delete-activity-prompt');
    var localId = $element.data('workflow-local-id');
    var loadLocalState = $element.data('workflow-load-local-state');
    workflowType.removedActivities = workflowType.removedActivities || [];
    $element.data('workflowEditor', new WorkflowEditor(element, workflowType, deleteActivityPrompt, localId, loadLocalState));
  });
  return this;
};
$(document).ready(function () {
  var workflowEditor = $('.workflow-canvas').workflowEditor().data('workflowEditor');
  $('#workflowEditorForm').on('submit', function (s, e) {
    var state = workflowEditor.serialize();
    $('#workflowStateInput').val(state);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2aXR5LXBpY2tlci50cyIsImFjdGl2aXR5LXBpY2tlci5qcyIsIndvcmtmbG93LXVybC1nZW5lcmF0b3IudHMiLCJ3b3JrZmxvdy11cmwtZ2VuZXJhdG9yLmpzIiwid29ya2Zsb3ctY2FudmFzLnRzIiwid29ya2Zsb3ctY2FudmFzLmpzIiwid29ya2Zsb3ctZWRpdG9yLnRzIiwid29ya2Zsb3ctZWRpdG9yLmpzIl0sIm5hbWVzIjpbImFwcGx5RmlsdGVyIiwiY2F0ZWdvcnkiLCJxIiwidHlwZSIsIiQiLCJkYXRhIiwiYXR0ciIsInN1YnN0ciIsInZhbCIsIiRjYXJkcyIsInNob3ciLCJmaWx0ZXIiLCJpIiwiZWwiLCJoaWRlIiwibGVuZ3RoIiwiZmluZCIsInRleHQiLCJ0b0xvd2VyQ2FzZSIsImluZGV4T2YiLCJlYWNoIiwiY2F0ZWdvcnlMaXN0SXRlbSIsImFjdGl2aXR5Q291bnQiLCJjb25jYXQiLCJvbiIsImUiLCJ0YXJnZXQiLCJldmVudCIsIm1vZGFsRXZlbnQiLCJidXR0b24iLCJyZWxhdGVkVGFyZ2V0IiwidGl0bGUiLCJtb2RhbCIsImNsaWNrIiwiZ2VuZXJhdGVXb3JrZmxvd1VybCIsIndvcmtmbG93VHlwZUlkIiwiYWN0aXZpdHlJZCIsInRva2VuTGlmZVNwYW4iLCJnZW5lcmF0ZVVybCIsImFudGlmb3JnZXJ5SGVhZGVyTmFtZSIsImFudGlmb3JnZXJ5VG9rZW4iLCJoZWFkZXJzIiwicG9zdCIsInVybCIsImRvbmUiLCJXb3JrZmxvd0NhbnZhcyIsImNvbnRhaW5lciIsIndvcmtmbG93VHlwZSIsIl90aGlzIiwibWluQ2FudmFzSGVpZ2h0IiwiZ2V0QWN0aXZpdHlFbGVtZW50cyIsImdldERlZmF1bHRzIiwiQW5jaG9yIiwiRHJhZ09wdGlvbnMiLCJjdXJzb3IiLCJ6SW5kZXgiLCJFbmRwb2ludFN0eWxlcyIsImZpbGxTdHlsZSIsIkVuZHBvaW50cyIsInJhZGl1cyIsIkNvbm5lY3Rpb25PdmVybGF5cyIsIndpZHRoIiwibG9jYXRpb24iLCJDb25uZWN0b3JaSW5kZXgiLCJjcmVhdGVKc1BsdW1iSW5zdGFuY2UiLCJqc1BsdW1iIiwiZ2V0SW5zdGFuY2UiLCJ2aXNpYmxlIiwiaWQiLCJjc3NDbGFzcyIsIkNvbnRhaW5lciIsImdldEVuZHBvaW50Q29sb3IiLCJhY3Rpdml0eSIsImlzQmxvY2tpbmciLCJpc1N0YXJ0IiwiaXNFdmVudCIsImdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyIsIm91dGNvbWUiLCJwYWludENvbG9yIiwiZW5kcG9pbnQiLCJhbmNob3IiLCJwYWludFN0eWxlIiwic3Ryb2tlIiwiZmlsbCIsInN0cm9rZVdpZHRoIiwiaXNTb3VyY2UiLCJjb25uZWN0b3IiLCJzdHViIiwiZ2FwIiwiY29ybmVyUmFkaXVzIiwiYWx3YXlzUmVzcGVjdFN0dWJzIiwiY29ubmVjdG9yU3R5bGUiLCJqb2luc3R5bGUiLCJvdXRsaW5lU3Ryb2tlIiwib3V0bGluZVdpZHRoIiwiaG92ZXJQYWludFN0eWxlIiwiY29ubmVjdG9ySG92ZXJTdHlsZSIsImNvbm5lY3Rvck92ZXJsYXlzIiwiZHJhZ09wdGlvbnMiLCJ1dWlkIiwibmFtZSIsInBhcmFtZXRlcnMiLCJnZXRBY3Rpdml0eSIsImFjdGl2aXRpZXMiLCJncmVwIiwieCIsInVwZGF0ZUNvbm5lY3Rpb25zIiwicGx1bWJlciIsIndvcmtmbG93SWQiLCJfaSIsIl9hIiwidHJhbnNpdGlvbnMiLCJ0cmFuc2l0aW9uTW9kZWwiLCJzb3VyY2VFbmRwb2ludFV1aWQiLCJzb3VyY2VBY3Rpdml0eUlkIiwic291cmNlT3V0Y29tZU5hbWUiLCJzb3VyY2VFbmRwb2ludCIsImdldEVuZHBvaW50IiwiZGVzdGluYXRpb25FbGVtZW50SWQiLCJkZXN0aW5hdGlvbkFjdGl2aXR5SWQiLCJjb25uZWN0Iiwic291cmNlIiwidXBkYXRlQ2FudmFzSGVpZ2h0IiwiJGNvbnRhaW5lciIsIiRhY3Rpdml0eUVsZW1lbnRzIiwiY3VycmVudEVsZW1lbnRUb3AiLCJjdXJyZW50QWN0aXZpdHlIZWlnaHQiLCJ0b0FycmF5IiwiYWN0aXZpdHlFbGVtZW50IiwiJGFjdGl2aXR5RWxlbWVudCIsInRvcF8xIiwicG9zaXRpb24iLCJ0b3AiLCJoZWlnaHQiLCJuZXdDYW52YXNIZWlnaHQiLCJlbGVtZW50Qm90dG9tIiwic3RyZXRjaFZhbHVlIiwiTWF0aCIsIm1heCIsIl9fZXh0ZW5kcyIsImV4dGVuZFN0YXRpY3MiLCJkIiwiYiIsIk9iamVjdCIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJwIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiVHlwZUVycm9yIiwiU3RyaW5nIiwiX18iLCJjb25zdHJ1Y3RvciIsImNyZWF0ZSIsIldvcmtmbG93RWRpdG9yIiwiX3N1cGVyIiwiZGVsZXRlQWN0aXZpdHlQcm9tcHQiLCJsb2NhbElkIiwibG9hZExvY2FsU3RhdGUiLCJnZXRTdGF0ZSIsIiRhbGxBY3Rpdml0eUVsZW1lbnRzIiwid29ya2Zsb3ciLCJyZW1vdmVkQWN0aXZpdGllcyIsImFjdGl2aXR5SXNTdGFydCIsImFjdGl2aXR5SXNFdmVudCIsImFjdGl2aXR5UG9zaXRpb24iLCJwdXNoIiwib3V0Y29tZXMiLCJsZWZ0IiwieSIsImFsbENvbm5lY3Rpb25zIiwianNQbHVtYkluc3RhbmNlIiwiZ2V0Q29ubmVjdGlvbnMiLCJjb25uZWN0aW9uIiwiZW5kcG9pbnRzIiwiZ2V0UGFyYW1ldGVycyIsInNlcmlhbGl6ZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzYXZlTG9jYWxTdGF0ZSIsInNlc3Npb25TdG9yYWdlIiwicGFyc2UiLCJzZWxmIiwicmVhZHkiLCJpbXBvcnREZWZhdWx0cyIsImJpbmQiLCJjb25uSW5mbyIsIm9yaWdpbmFsRXZlbnQiLCJsYWJlbCIsImdldE92ZXJsYXkiLCJzZXRMYWJlbCIsImRpc3BsYXlOYW1lIiwiYWN0aXZpdHlFbGVtZW50cyIsImFyZUVxdWFsT3V0Y29tZXMiLCJvdXRjb21lczEiLCJvdXRjb21lczIiLCJvdXRjb21lMSIsIm91dGNvbWUyIiwiYmF0Y2giLCJzZXJ2ZXJ3b3JrZmxvd1R5cGUiLCJsb2NhbFN0YXRlIiwiXyIsImlzRGVsZXRlZCIsInJlbW92ZSIsInNlcnZlckFjdGl2aXR5Iiwic2FtZU91dGNvbWVzIiwiY3NzIiwidG9nZ2xlQ2xhc3MiLCJkcmFnZ2FibGUiLCJncmlkIiwiY29udGFpbm1lbnQiLCJzdGFydCIsImFyZ3MiLCJkcmFnU3RhcnQiLCJzY3JlZW5YIiwic2NyZWVuWSIsInN0b3AiLCJoYXNEcmFnZ2VkIiwibWFrZVRhcmdldCIsImRyb3BPcHRpb25zIiwiaG92ZXJDbGFzcyIsInNvdXJjZUVuZHBvaW50T3B0aW9ucyIsImFkZEVuZHBvaW50IiwiaXRlbSIsInBvcG92ZXIiLCJ0cmlnZ2VyIiwiaHRtbCIsImNvbnRlbnQiLCIkY29udGVudCIsImNsb25lIiwic3RhcnRCdXR0b24iLCJwcmV2ZW50RGVmYXVsdCIsImN1cnJlbnRUYXJnZXQiLCJpcyIsImdldCIsImlzUG9wb3ZlclZpc2libGUiLCJzZW5kZXIiLCJvZmYiLCJlMiIsInN0b3BQcm9wYWdhdGlvbiIsImhhc0VkaXRvciIsImZuIiwid29ya2Zsb3dFZGl0b3IiLCJpbmRleCIsImVsZW1lbnQiLCIkZWxlbWVudCIsImRvY3VtZW50IiwicyIsInN0YXRlIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBRUEsSUFBSUEsV0FBVyxHQUFHLFNBQWRBLFdBQVdBLENBQWFDLFFBQWdCLEVBQUVDLENBQVMsRUFBQTtFQUNuRCxJQUFNQyxJQUFJLEdBQUdDLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDQyxJQUFJLENBQUMsZUFBZSxDQUFDO0VBQ3pESixRQUFRLEdBQUdBLFFBQVEsSUFBSUcsQ0FBQyxDQUFDLDhDQUE4QyxDQUFDLENBQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQ0MsTUFBTSxDQUFDLENBQUMsQ0FBQztFQUMvRkwsQ0FBQyxHQUFHQSxDQUFDLElBQVlFLENBQUMsQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDSSxHQUFHLENBQUEsQ0FBRTtFQUVoRSxJQUFNQyxN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LENBQUM7RUFDdkMsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDIiwiZmlsZSI6Im9yY2hhcmQud29ya2Zsb3dzLWVkaXRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XHJcblxyXG52YXIgYXBwbHlGaWx0ZXIgPSBmdW5jdGlvbiAoY2F0ZWdvcnk6IHN0cmluZywgcTogc3RyaW5nKSB7XHJcbiAgICBjb25zdCB0eXBlID0gJCgnLm1vZGFsLWFjdGl2aXRpZXMnKS5kYXRhKCdhY3Rpdml0eS10eXBlJyk7XHJcbiAgICBjYXRlZ29yeSA9IGNhdGVnb3J5IHx8ICQoJy5hY3Rpdml0eS1waWNrZXItY2F0ZWdvcmllcyAubmF2LWxpbmsuYWN0aXZlJykuYXR0cignaHJlZicpLnN1YnN0cigxKTtcclxuICAgIHEgPSBxIHx8IDxzdHJpbmc+JCgnLm1vZGFsLWFjdGl2aXRpZXMgaW5wdXRbdHlwZT1zZWFyY2hdJykudmFsKCk7XHJcblxyXG4gICAgY29uc3QgJGNhcmRzID0gJCgnLmFjdGl2aXR5LmNvbCcpLnNob3coKTtcclxuXHJcbiAgICAvLyBSZW1vdmUgYWN0aXZpdGllcyB3aG9lcyB0eXBlIGRvZXNuJ3QgbWF0Y2ggdGhlIGNvbmZpZ3VyZWQgYWN0aXZpdHkgdHlwZS5cclxuICAgICRjYXJkcy5maWx0ZXIoKGksIGVsKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEoJ2FjdGl2aXR5LXR5cGUnKSAhPSB0eXBlO1xyXG4gICAgfSkuaGlkZSgpO1xyXG5cclxuICAgIGlmIChxLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyBSZW1vdmUgYWN0aXZpdGllcyB3aG9zZSB0aXRsZSBkb2Vzbid0IG1hdGNoIHRoZSBxdWVyeS5cclxuICAgICAgICAkY2FyZHMuZmlsdGVyKChpLCBlbCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gJChlbCkuZmluZCgnLmNhcmQtdGl0bGUnKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHEudG9Mb3dlckNhc2UoKSkgPCAwICYmIHEgJiYgcS5sZW5ndGggPiAwO1xyXG4gICAgICAgIH0pLmhpZGUoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIFJlbW92ZSBhY3Rpdml0aWVzIHdob3NlIGNhdGVnb3J5IGRvZXNuJ3QgbWF0Y2ggdGhlIHNlbGVjdGVkIG9uZS5cclxuICAgICAgICAkY2FyZHMuZmlsdGVyKChpLCBlbCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gJChlbCkuZGF0YSgnY2F0ZWdvcnknKS50b0xvd2VyQ2FzZSgpICE9IGNhdGVnb3J5LnRvTG93ZXJDYXNlKCkgJiYgY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSAhPSAnYWxsJztcclxuICAgICAgICB9KS5oaWRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2hvdyBvciBoaWRlIGNhdGVnb3JpZXMgYmFzZWQgb24gd2hldGhlciB0aGVyZSBhcmUgYW55IGF2YWlsYWJsZSBhY3Rpdml0aWVzLlxyXG4gICAgJCgnLmFjdGl2aXR5LXBpY2tlci1jYXRlZ29yaWVzIFtkYXRhLWNhdGVnb3J5XScpLmVhY2goKGksIGVsKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2F0ZWdvcnlMaXN0SXRlbSA9ICQoZWwpO1xyXG4gICAgICAgIGNvbnN0IGNhdGVnb3J5ID0gY2F0ZWdvcnlMaXN0SXRlbS5kYXRhKCdjYXRlZ29yeScpO1xyXG5cclxuICAgICAgICAvLyBDb3VudCBudW1iZXIgb2YgYWN0aXZpdGllcyB3aXRoaW4gdGhpcyBjYXRlZ29yeSBhbmQgZm9yIHRoZSBzcGVjaWZpZWQgYWN0aXZpdHkgdHlwZSAoRXZlbnQgb3IgVGFzaykuXHJcbiAgICAgICAgY29uc3QgYWN0aXZpdHlDb3VudCA9ICQoYC5hY3Rpdml0eS5jb2xbZGF0YS1jYXRlZ29yeT0nJHtjYXRlZ29yeX0nXVtkYXRhLWFjdGl2aXR5LXR5cGU9JyR7dHlwZX0nXWApLmxlbmd0aDtcclxuICAgICAgICBhY3Rpdml0eUNvdW50ID09IDAgPyBjYXRlZ29yeUxpc3RJdGVtLmhpZGUoKSA6IGNhdGVnb3J5TGlzdEl0ZW0uc2hvdygpO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG4kKCgpID0+IHtcclxuICAgICQoJy5hY3Rpdml0eS1waWNrZXItY2F0ZWdvcmllcycpLm9uKCdjbGljaycsICcubmF2LWxpbmsnLCBlID0+IHtcclxuICAgICAgICBhcHBseUZpbHRlcigkKGUudGFyZ2V0KS5hdHRyKCdocmVmJykuc3Vic3RyKDEpLCBudWxsKTtcclxuICAgIH0pO1xyXG5cclxuICAgICQoJy5tb2RhbC1hY3Rpdml0aWVzIGlucHV0W3R5cGU9c2VhcmNoXScpLm9uKCdrZXl1cCcsIGUgPT4ge1xyXG4gICAgICAgIGFwcGx5RmlsdGVyKG51bGwsIDxzdHJpbmc+JChlLnRhcmdldCkudmFsKCkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnI2FjdGl2aXR5LXBpY2tlcicpLm9uKCdzaG93LmJzLm1vZGFsJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdmFyIG1vZGFsRXZlbnQgPSBldmVudCBhcyBhbnk7XHJcbiAgICAgICAgdmFyIGJ1dHRvbiA9ICQobW9kYWxFdmVudC5yZWxhdGVkVGFyZ2V0KTsgLy8gQnV0dG9uIHRoYXQgdHJpZ2dlcmVkIHRoZSBtb2RhbC5cclxuICAgICAgICB2YXIgdGl0bGUgPSBidXR0b24uZGF0YSgncGlja2VyLXRpdGxlJyk7XHJcbiAgICAgICAgdmFyIHR5cGUgPSBidXR0b24uZGF0YSgnYWN0aXZpdHktdHlwZScpO1xyXG4gICAgICAgIHZhciBtb2RhbCA9ICQodGhpcyk7XHJcbiAgICAgICAgbW9kYWwuZmluZCgnW2hyZWY9XCIjYWxsXCJdJykuY2xpY2soKTtcclxuICAgICAgICBtb2RhbC5maW5kKCcubW9kYWwtdGl0bGUnKS50ZXh0KHRpdGxlKTtcclxuICAgICAgICBtb2RhbC5kYXRhKCdhY3Rpdml0eS10eXBlJywgdHlwZSk7XHJcbiAgICAgICAgYXBwbHlGaWx0ZXIobnVsbCwgbnVsbCk7XHJcbiAgICB9KVxyXG59KTtcclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50cycgLz5cbnZhciBhcHBseUZpbHRlciA9IGZ1bmN0aW9uIChjYXRlZ29yeSwgcSkge1xuICAgIHZhciB0eXBlID0gJCgnLm1vZGFsLWFjdGl2aXRpZXMnKS5kYXRhKCdhY3Rpdml0eS10eXBlJyk7XG4gICAgY2F0ZWdvcnkgPSBjYXRlZ29yeSB8fCAkKCcuYWN0aXZpdHktcGlja2VyLWNhdGVnb3JpZXMgLm5hdi1saW5rLmFjdGl2ZScpLmF0dHIoJ2hyZWYnKS5zdWJzdHIoMSk7XG4gICAgcSA9IHEgfHwgJCgnLm1vZGFsLWFjdGl2aXRpZXMgaW5wdXRbdHlwZT1zZWFyY2hdJykudmFsKCk7XG4gICAgdmFyICRjYXJkcyA9ICQoJy5hY3Rpdml0eS5jb2wnKS5zaG93KCk7XG4gICAgLy8gUmVtb3ZlIGFjdGl2aXRpZXMgd2hvZXMgdHlwZSBkb2Vzbid0IG1hdGNoIHRoZSBjb25maWd1cmVkIGFjdGl2aXR5IHR5cGUuXG4gICAgJGNhcmRzLmZpbHRlcihmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEoJ2FjdGl2aXR5LXR5cGUnKSAhPSB0eXBlO1xuICAgIH0pLmhpZGUoKTtcbiAgICBpZiAocS5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIFJlbW92ZSBhY3Rpdml0aWVzIHdob3NlIHRpdGxlIGRvZXNuJ3QgbWF0Y2ggdGhlIHF1ZXJ5LlxuICAgICAgICAkY2FyZHMuZmlsdGVyKGZ1bmN0aW9uIChpLCBlbCkge1xuICAgICAgICAgICAgcmV0dXJuICQoZWwpLmZpbmQoJy5jYXJkLXRpdGxlJykudGV4dCgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihxLnRvTG93ZXJDYXNlKCkpIDwgMCAmJiBxICYmIHEubGVuZ3RoID4gMDtcbiAgICAgICAgfSkuaGlkZSgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gUmVtb3ZlIGFjdGl2aXRpZXMgd2hvc2UgY2F0ZWdvcnkgZG9lc24ndCBtYXRjaCB0aGUgc2VsZWN0ZWQgb25lLlxuICAgICAgICAkY2FyZHMuZmlsdGVyKGZ1bmN0aW9uIChpLCBlbCkge1xuICAgICAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEoJ2NhdGVnb3J5JykudG9Mb3dlckNhc2UoKSAhPSBjYXRlZ29yeS50b0xvd2VyQ2FzZSgpICYmIGNhdGVnb3J5LnRvTG93ZXJDYXNlKCkgIT0gJ2FsbCc7XG4gICAgICAgIH0pLmhpZGUoKTtcbiAgICB9XG4gICAgLy8gU2hvdyBvciBoaWRlIGNhdGVnb3JpZXMgYmFzZWQgb24gd2hldGhlciB0aGVyZSBhcmUgYW55IGF2YWlsYWJsZSBhY3Rpdml0aWVzLlxuICAgICQoJy5hY3Rpdml0eS1waWNrZXItY2F0ZWdvcmllcyBbZGF0YS1jYXRlZ29yeV0nKS5lYWNoKGZ1bmN0aW9uIChpLCBlbCkge1xuICAgICAgICB2YXIgY2F0ZWdvcnlMaXN0SXRlbSA9ICQoZWwpO1xuICAgICAgICB2YXIgY2F0ZWdvcnkgPSBjYXRlZ29yeUxpc3RJdGVtLmRhdGEoJ2NhdGVnb3J5Jyk7XG4gICAgICAgIC8vIENvdW50IG51bWJlciBvZiBhY3Rpdml0aWVzIHdpdGhpbiB0aGlzIGNhdGVnb3J5IGFuZCBmb3IgdGhlIHNwZWNpZmllZCBhY3Rpdml0eSB0eXBlIChFdmVudCBvciBUYXNrKS5cbiAgICAgICAgdmFyIGFjdGl2aXR5Q291bnQgPSAkKFwiLmFjdGl2aXR5LmNvbFtkYXRhLWNhdGVnb3J5PSdcIi5jb25jYXQoY2F0ZWdvcnksIFwiJ11bZGF0YS1hY3Rpdml0eS10eXBlPSdcIikuY29uY2F0KHR5cGUsIFwiJ11cIikpLmxlbmd0aDtcbiAgICAgICAgYWN0aXZpdHlDb3VudCA9PSAwID8gY2F0ZWdvcnlMaXN0SXRlbS5oaWRlKCkgOiBjYXRlZ29yeUxpc3RJdGVtLnNob3coKTtcbiAgICB9KTtcbn07XG4kKGZ1bmN0aW9uICgpIHtcbiAgICAkKCcuYWN0aXZpdHktcGlja2VyLWNhdGVnb3JpZXMnKS5vbignY2xpY2snLCAnLm5hdi1saW5rJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgYXBwbHlGaWx0ZXIoJChlLnRhcmdldCkuYXR0cignaHJlZicpLnN1YnN0cigxKSwgbnVsbCk7XG4gICAgfSk7XG4gICAgJCgnLm1vZGFsLWFjdGl2aXRpZXMgaW5wdXRbdHlwZT1zZWFyY2hdJykub24oJ2tleXVwJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgYXBwbHlGaWx0ZXIobnVsbCwgJChlLnRhcmdldCkudmFsKCkpO1xuICAgIH0pO1xuICAgICQoJyNhY3Rpdml0eS1waWNrZXInKS5vbignc2hvdy5icy5tb2RhbCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgbW9kYWxFdmVudCA9IGV2ZW50O1xuICAgICAgICB2YXIgYnV0dG9uID0gJChtb2RhbEV2ZW50LnJlbGF0ZWRUYXJnZXQpOyAvLyBCdXR0b24gdGhhdCB0cmlnZ2VyZWQgdGhlIG1vZGFsLlxuICAgICAgICB2YXIgdGl0bGUgPSBidXR0b24uZGF0YSgncGlja2VyLXRpdGxlJyk7XG4gICAgICAgIHZhciB0eXBlID0gYnV0dG9uLmRhdGEoJ2FjdGl2aXR5LXR5cGUnKTtcbiAgICAgICAgdmFyIG1vZGFsID0gJCh0aGlzKTtcbiAgICAgICAgbW9kYWwuZmluZCgnW2hyZWY9XCIjYWxsXCJdJykuY2xpY2soKTtcbiAgICAgICAgbW9kYWwuZmluZCgnLm1vZGFsLXRpdGxlJykudGV4dCh0aXRsZSk7XG4gICAgICAgIG1vZGFsLmRhdGEoJ2FjdGl2aXR5LXR5cGUnLCB0eXBlKTtcbiAgICAgICAgYXBwbHlGaWx0ZXIobnVsbCwgbnVsbCk7XG4gICAgfSk7XG59KTtcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uL0Fzc2V0cy9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50c1wiIC8+XHJcblxyXG4kKCgpID0+IHtcclxuICAgIGNvbnN0IGdlbmVyYXRlV29ya2Zsb3dVcmwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3Qgd29ya2Zsb3dUeXBlSWQ6IHN0cmluZyA9ICQoJ1tkYXRhLXdvcmtmbG93LXR5cGUtaWRdJykuZGF0YSgnd29ya2Zsb3ctdHlwZS1pZCcpO1xyXG4gICAgICAgIGNvbnN0IGFjdGl2aXR5SWQ6IHN0cmluZyA9ICQoJ1tkYXRhLWFjdGl2aXR5LWlkXScpLmRhdGEoJ2FjdGl2aXR5LWlkJyk7XHJcbiAgICAgICAgdmFyIHRva2VuTGlmZVNwYW4gPSAkKCcjdG9rZW4tbGlmZXNwYW4nKS52YWwoKTtcclxuICAgICAgICBjb25zdCBnZW5lcmF0ZVVybDogc3RyaW5nID0gJCgnW2RhdGEtZ2VuZXJhdGUtdXJsXScpLmRhdGEoJ2dlbmVyYXRlLXVybCcpICsgYD93b3JrZmxvd1R5cGVJZD0ke3dvcmtmbG93VHlwZUlkfSZhY3Rpdml0eUlkPSR7YWN0aXZpdHlJZH0mdG9rZW5MaWZlU3Bhbj0ke3Rva2VuTGlmZVNwYW59YDtcclxuICAgICAgICBjb25zdCBhbnRpZm9yZ2VyeUhlYWRlck5hbWU6IHN0cmluZyA9ICQoJ1tkYXRhLWFudGlmb3JnZXJ5LWhlYWRlci1uYW1lXScpLmRhdGEoJ2FudGlmb3JnZXJ5LWhlYWRlci1uYW1lJyk7XHJcbiAgICAgICAgY29uc3QgYW50aWZvcmdlcnlUb2tlbjogc3RyaW5nID0gJCgnW2RhdGEtYW50aWZvcmdlcnktdG9rZW5dJykuZGF0YSgnYW50aWZvcmdlcnktdG9rZW4nKTtcclxuICAgICAgICBjb25zdCBoZWFkZXJzOiBhbnkgPSB7fTtcclxuXHJcbiAgICAgICAgaGVhZGVyc1thbnRpZm9yZ2VyeUhlYWRlck5hbWVdID0gYW50aWZvcmdlcnlUb2tlbjtcclxuXHJcbiAgICAgICAgJC5wb3N0KHtcclxuICAgICAgICAgICAgdXJsOiBnZW5lcmF0ZVVybCxcclxuICAgICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xyXG4gICAgICAgIH0pLmRvbmUodXJsID0+IHtcclxuICAgICAgICAgICAgJCgnI3dvcmtmbG93LXVybC10ZXh0JykudmFsKHVybCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgICQoJyNnZW5lcmF0ZS11cmwtYnV0dG9uJykub24oJ2NsaWNrJywgZSA9PiB7XHJcbiAgICAgICAgZ2VuZXJhdGVXb3JrZmxvd1VybCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCQoJyN3b3JrZmxvdy11cmwtdGV4dCcpLnZhbCgpID09ICcnKSB7XHJcbiAgICAgICAgZ2VuZXJhdGVXb3JrZmxvd1VybCgpO1xyXG4gICAgfVxyXG59KTtcclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vLi4vQXNzZXRzL0xpYi9qcXVlcnkvdHlwaW5ncy5kLnRzXCIgLz5cbiQoZnVuY3Rpb24gKCkge1xuICAgIHZhciBnZW5lcmF0ZVdvcmtmbG93VXJsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgd29ya2Zsb3dUeXBlSWQgPSAkKCdbZGF0YS13b3JrZmxvdy10eXBlLWlkXScpLmRhdGEoJ3dvcmtmbG93LXR5cGUtaWQnKTtcbiAgICAgICAgdmFyIGFjdGl2aXR5SWQgPSAkKCdbZGF0YS1hY3Rpdml0eS1pZF0nKS5kYXRhKCdhY3Rpdml0eS1pZCcpO1xuICAgICAgICB2YXIgdG9rZW5MaWZlU3BhbiA9ICQoJyN0b2tlbi1saWZlc3BhbicpLnZhbCgpO1xuICAgICAgICB2YXIgZ2VuZXJhdGVVcmwgPSAkKCdbZGF0YS1nZW5lcmF0ZS11cmxdJykuZGF0YSgnZ2VuZXJhdGUtdXJsJykgKyBcIj93b3JrZmxvd1R5cGVJZD1cIi5jb25jYXQod29ya2Zsb3dUeXBlSWQsIFwiJmFjdGl2aXR5SWQ9XCIpLmNvbmNhdChhY3Rpdml0eUlkLCBcIiZ0b2tlbkxpZmVTcGFuPVwiKS5jb25jYXQodG9rZW5MaWZlU3Bhbik7XG4gICAgICAgIHZhciBhbnRpZm9yZ2VyeUhlYWRlck5hbWUgPSAkKCdbZGF0YS1hbnRpZm9yZ2VyeS1oZWFkZXItbmFtZV0nKS5kYXRhKCdhbnRpZm9yZ2VyeS1oZWFkZXItbmFtZScpO1xuICAgICAgICB2YXIgYW50aWZvcmdlcnlUb2tlbiA9ICQoJ1tkYXRhLWFudGlmb3JnZXJ5LXRva2VuXScpLmRhdGEoJ2FudGlmb3JnZXJ5LXRva2VuJyk7XG4gICAgICAgIHZhciBoZWFkZXJzID0ge307XG4gICAgICAgIGhlYWRlcnNbYW50aWZvcmdlcnlIZWFkZXJOYW1lXSA9IGFudGlmb3JnZXJ5VG9rZW47XG4gICAgICAgICQucG9zdCh7XG4gICAgICAgICAgICB1cmw6IGdlbmVyYXRlVXJsLFxuICAgICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xuICAgICAgICB9KS5kb25lKGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgICAgICQoJyN3b3JrZmxvdy11cmwtdGV4dCcpLnZhbCh1cmwpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgICQoJyNnZW5lcmF0ZS11cmwtYnV0dG9uJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZ2VuZXJhdGVXb3JrZmxvd1VybCgpO1xuICAgIH0pO1xuICAgIGlmICgkKCcjd29ya2Zsb3ctdXJsLXRleHQnKS52YWwoKSA9PSAnJykge1xuICAgICAgICBnZW5lcmF0ZVdvcmtmbG93VXJsKCk7XG4gICAgfVxufSk7XG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qcXVlcnkvdHlwaW5ncy5kLnRzJyAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPScuL3dvcmtmbG93LW1vZGVscy50cycgLz5cclxuXHJcbmFic3RyYWN0IGNsYXNzIFdvcmtmbG93Q2FudmFzIHtcclxuICAgIHByaXZhdGUgbWluQ2FudmFzSGVpZ2h0OiBudW1iZXIgPSA0MDA7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHByb3RlY3RlZCB3b3JrZmxvd1R5cGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUpIHtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0QWN0aXZpdHlFbGVtZW50cyA9ICgpOiBKUXVlcnkgPT4ge1xyXG4gICAgICAgIHJldHVybiAkKHRoaXMuY29udGFpbmVyKS5maW5kKCcuYWN0aXZpdHknKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0RGVmYXVsdHMgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgQW5jaG9yOiBcIkNvbnRpbnVvdXNcIixcclxuICAgICAgICAgICAgRHJhZ09wdGlvbnM6IHsgY3Vyc29yOiAncG9pbnRlcicsIHpJbmRleDogMjAwMCB9LFxyXG4gICAgICAgICAgICBFbmRwb2ludFN0eWxlczogW3sgZmlsbFN0eWxlOiAnIzIyNTU4OCcgfV0sXHJcbiAgICAgICAgICAgIEVuZHBvaW50czogW1tcIkRvdFwiLCB7IHJhZGl1czogNyB9XSwgW1wiQmxhbmtcIl1dLFxyXG4gICAgICAgICAgICBDb25uZWN0aW9uT3ZlcmxheXM6IFtcclxuICAgICAgICAgICAgICAgIFtcIkFycm93XCIsIHsgd2lkdGg6IDEyLCBsZW5ndGg6IDEyLCBsb2NhdGlvbjogLTUgfV0sXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIENvbm5lY3RvclpJbmRleDogNVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcHJvdGVjdGVkIGNyZWF0ZUpzUGx1bWJJbnN0YW5jZSA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4ganNQbHVtYi5nZXRJbnN0YW5jZSh7XHJcbiAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcclxuICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXHJcbiAgICAgICAgICAgICAgICBbJ0Fycm93Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDExLFxyXG4gICAgICAgICAgICAgICAgICAgIGxlbmd0aDogMTFcclxuICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICAgICAgWydMYWJlbCcsIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogMC41LFxyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbGFiZWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnY29ubmVjdGlvbi1sYWJlbCdcclxuICAgICAgICAgICAgICAgIH1dXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIENvbnRhaW5lcjogdGhpcy5jb250YWluZXJcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldEVuZHBvaW50Q29sb3IgPSAoYWN0aXZpdHk6IFdvcmtmbG93cy5BY3Rpdml0eSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBhY3Rpdml0eS5pc0Jsb2NraW5nIHx8IGFjdGl2aXR5LmlzU3RhcnQgPyAnIzdhYjAyYycgOiBhY3Rpdml0eS5pc0V2ZW50ID8gJyMzYThhY2QnIDogJyM3YWIwMmMnO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMgPSAoYWN0aXZpdHk6IFdvcmtmbG93cy5BY3Rpdml0eSwgb3V0Y29tZTogV29ya2Zsb3dzLk91dGNvbWUpOiBFbmRwb2ludE9wdGlvbnMgPT4ge1xyXG4gICAgICAgIC8vIFRoZSBkZWZpbml0aW9uIG9mIHNvdXJjZSBlbmRwb2ludHMuXHJcbiAgICAgICAgY29uc3QgcGFpbnRDb2xvciA9IHRoaXMuZ2V0RW5kcG9pbnRDb2xvcihhY3Rpdml0eSk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZW5kcG9pbnQ6ICdEb3QnLFxyXG4gICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcclxuICAgICAgICAgICAgcGFpbnRTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBwYWludENvbG9yLFxyXG4gICAgICAgICAgICAgICAgZmlsbDogcGFpbnRDb2xvcixcclxuICAgICAgICAgICAgICAgIHJhZGl1czogNyxcclxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlzU291cmNlOiB0cnVlLFxyXG4gICAgICAgICAgICBjb25uZWN0b3I6IFsnRmxvd2NoYXJ0JywgeyBzdHViOiBbNDAsIDYwXSwgZ2FwOiAwLCBjb3JuZXJSYWRpdXM6IDUsIGFsd2F5c1Jlc3BlY3RTdHViczogdHJ1ZSB9XSxcclxuICAgICAgICAgICAgY29ubmVjdG9yU3R5bGU6IHtcclxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzk5OTk5OScsXHJcbiAgICAgICAgICAgICAgICBqb2luc3R5bGU6ICdyb3VuZCcsXHJcbiAgICAgICAgICAgICAgICBvdXRsaW5lU3Ryb2tlOiAnd2hpdGUnLFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiAyXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGhvdmVyUGFpbnRTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgZmlsbDogJyMyMTY0NzcnLFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzIxNjQ3NydcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29ubmVjdG9ySG92ZXJTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDMsXHJcbiAgICAgICAgICAgICAgICBzdHJva2U6ICcjMjE2NDc3JyxcclxuICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogNSxcclxuICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsb2NhdGlvbjogWzMsIC0xLjVdLCBjc3NDbGFzczogJ2VuZHBvaW50U291cmNlTGFiZWwnIH1dXSxcclxuICAgICAgICAgICAgZHJhZ09wdGlvbnM6IHt9LFxyXG4gICAgICAgICAgICB1dWlkOiBgJHthY3Rpdml0eS5pZH0tJHtvdXRjb21lLm5hbWV9YCxcclxuICAgICAgICAgICAgcGFyYW1ldGVyczoge1xyXG4gICAgICAgICAgICAgICAgb3V0Y29tZTogb3V0Y29tZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldEFjdGl2aXR5ID0gZnVuY3Rpb24gKGlkOiBzdHJpbmcsIGFjdGl2aXRpZXM6IEFycmF5PFdvcmtmbG93cy5BY3Rpdml0eT4gPSBudWxsKTogV29ya2Zsb3dzLkFjdGl2aXR5IHtcclxuICAgICAgICBpZiAoIWFjdGl2aXRpZXMpIHtcclxuICAgICAgICAgICAgYWN0aXZpdGllcyA9IHRoaXMud29ya2Zsb3dUeXBlLmFjdGl2aXRpZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAkLmdyZXAoYWN0aXZpdGllcywgKHg6IFdvcmtmbG93cy5BY3Rpdml0eSkgPT4geC5pZCA9PT0gaWQpWzBdO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCB1cGRhdGVDb25uZWN0aW9ucyA9IChwbHVtYmVyOiBqc1BsdW1iSW5zdGFuY2UpID0+IHtcclxuICAgICAgICB2YXIgd29ya2Zsb3dJZDogbnVtYmVyID0gdGhpcy53b3JrZmxvd1R5cGUuaWQ7XHJcblxyXG4gICAgICAgIC8vIENvbm5lY3QgYWN0aXZpdGllcy5cclxuICAgICAgICBmb3IgKGxldCB0cmFuc2l0aW9uTW9kZWwgb2YgdGhpcy53b3JrZmxvd1R5cGUudHJhbnNpdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnRVdWlkOiBzdHJpbmcgPSBgJHt0cmFuc2l0aW9uTW9kZWwuc291cmNlQWN0aXZpdHlJZH0tJHt0cmFuc2l0aW9uTW9kZWwuc291cmNlT3V0Y29tZU5hbWV9YDtcclxuICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnQ6IEVuZHBvaW50ID0gcGx1bWJlci5nZXRFbmRwb2ludChzb3VyY2VFbmRwb2ludFV1aWQpO1xyXG4gICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbkVsZW1lbnRJZDogc3RyaW5nID0gYGFjdGl2aXR5LSR7d29ya2Zsb3dJZH0tJHt0cmFuc2l0aW9uTW9kZWwuZGVzdGluYXRpb25BY3Rpdml0eUlkfWA7XHJcblxyXG4gICAgICAgICAgICBwbHVtYmVyLmNvbm5lY3Qoe1xyXG4gICAgICAgICAgICAgICAgc291cmNlOiBzb3VyY2VFbmRwb2ludCxcclxuICAgICAgICAgICAgICAgIHRhcmdldDogZGVzdGluYXRpb25FbGVtZW50SWRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCB1cGRhdGVDYW52YXNIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgJGNvbnRhaW5lciA9ICQodGhpcy5jb250YWluZXIpO1xyXG5cclxuICAgICAgICAvLyBHZXQgdGhlIGFjdGl2aXR5IGVsZW1lbnQgd2l0aCB0aGUgaGlnaGVzdCBZIGNvb3JkaW5hdGUuXHJcbiAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudHMgPSAkY29udGFpbmVyLmZpbmQoXCIuYWN0aXZpdHlcIik7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRFbGVtZW50VG9wID0gMDtcclxuICAgICAgICBsZXQgY3VycmVudEFjdGl2aXR5SGVpZ2h0ID0gMDtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgYWN0aXZpdHlFbGVtZW50IG9mICRhY3Rpdml0eUVsZW1lbnRzLnRvQXJyYXkoKSkge1xyXG4gICAgICAgICAgICBjb25zdCAkYWN0aXZpdHlFbGVtZW50ID0gJChhY3Rpdml0eUVsZW1lbnQpO1xyXG4gICAgICAgICAgICBjb25zdCB0b3AgPSAkYWN0aXZpdHlFbGVtZW50LnBvc2l0aW9uKCkudG9wO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRvcCA+IGN1cnJlbnRFbGVtZW50VG9wKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50RWxlbWVudFRvcCA9IHRvcDtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRBY3Rpdml0eUhlaWdodCA9ICRhY3Rpdml0eUVsZW1lbnQuaGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBuZXdDYW52YXNIZWlnaHQgPSBjdXJyZW50RWxlbWVudFRvcCArIGN1cnJlbnRBY3Rpdml0eUhlaWdodDtcclxuICAgICAgICBjb25zdCBlbGVtZW50Qm90dG9tID0gY3VycmVudEVsZW1lbnRUb3AgKyBjdXJyZW50QWN0aXZpdHlIZWlnaHQ7XHJcbiAgICAgICAgY29uc3Qgc3RyZXRjaFZhbHVlID0gMTAwO1xyXG5cclxuICAgICAgICBpZiAobmV3Q2FudmFzSGVpZ2h0IC0gZWxlbWVudEJvdHRvbSA8PSBzdHJldGNoVmFsdWUpIHtcclxuICAgICAgICAgICAgbmV3Q2FudmFzSGVpZ2h0ICs9IHN0cmV0Y2hWYWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjb250YWluZXIuaGVpZ2h0KE1hdGgubWF4KHRoaXMubWluQ2FudmFzSGVpZ2h0LCBuZXdDYW52YXNIZWlnaHQpKTtcclxuICAgIH07XHJcbn1cclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pzcGx1bWIvdHlwaW5ncy5kLnRzJyAvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPScuL3dvcmtmbG93LW1vZGVscy50cycgLz5cbnZhciBXb3JrZmxvd0NhbnZhcyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBXb3JrZmxvd0NhbnZhcyhjb250YWluZXIsIHdvcmtmbG93VHlwZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICAgICAgdGhpcy53b3JrZmxvd1R5cGUgPSB3b3JrZmxvd1R5cGU7XG4gICAgICAgIHRoaXMubWluQ2FudmFzSGVpZ2h0ID0gNDAwO1xuICAgICAgICB0aGlzLmdldEFjdGl2aXR5RWxlbWVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJChfdGhpcy5jb250YWluZXIpLmZpbmQoJy5hY3Rpdml0eScpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldERlZmF1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBBbmNob3I6IFwiQ29udGludW91c1wiLFxuICAgICAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcbiAgICAgICAgICAgICAgICBFbmRwb2ludFN0eWxlczogW3sgZmlsbFN0eWxlOiAnIzIyNTU4OCcgfV0sXG4gICAgICAgICAgICAgICAgRW5kcG9pbnRzOiBbW1wiRG90XCIsIHsgcmFkaXVzOiA3IH1dLCBbXCJCbGFua1wiXV0sXG4gICAgICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXG4gICAgICAgICAgICAgICAgICAgIFtcIkFycm93XCIsIHsgd2lkdGg6IDEyLCBsZW5ndGg6IDEyLCBsb2NhdGlvbjogLTUgfV0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBDb25uZWN0b3JaSW5kZXg6IDVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY3JlYXRlSnNQbHVtYkluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGpzUGx1bWIuZ2V0SW5zdGFuY2Uoe1xuICAgICAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcbiAgICAgICAgICAgICAgICBDb25uZWN0aW9uT3ZlcmxheXM6IFtcbiAgICAgICAgICAgICAgICAgICAgWydBcnJvdycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IDExXG4gICAgICAgICAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICAgICAgWydMYWJlbCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogMC41LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnbGFiZWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnY29ubmVjdGlvbi1sYWJlbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBDb250YWluZXI6IF90aGlzLmNvbnRhaW5lclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ2V0RW5kcG9pbnRDb2xvciA9IGZ1bmN0aW9uIChhY3Rpdml0eSkge1xuICAgICAgICAgICAgcmV0dXJuIGFjdGl2aXR5LmlzQmxvY2tpbmcgfHwgYWN0aXZpdHkuaXNTdGFydCA/ICcjN2FiMDJjJyA6IGFjdGl2aXR5LmlzRXZlbnQgPyAnIzNhOGFjZCcgOiAnIzdhYjAyYyc7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zID0gZnVuY3Rpb24gKGFjdGl2aXR5LCBvdXRjb21lKSB7XG4gICAgICAgICAgICAvLyBUaGUgZGVmaW5pdGlvbiBvZiBzb3VyY2UgZW5kcG9pbnRzLlxuICAgICAgICAgICAgdmFyIHBhaW50Q29sb3IgPSBfdGhpcy5nZXRFbmRwb2ludENvbG9yKGFjdGl2aXR5KTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdEb3QnLFxuICAgICAgICAgICAgICAgIGFuY2hvcjogJ0NvbnRpbnVvdXMnLFxuICAgICAgICAgICAgICAgIHBhaW50U3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiBwYWludENvbG9yLFxuICAgICAgICAgICAgICAgICAgICBmaWxsOiBwYWludENvbG9yLFxuICAgICAgICAgICAgICAgICAgICByYWRpdXM6IDcsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpc1NvdXJjZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb25uZWN0b3I6IFsnRmxvd2NoYXJ0JywgeyBzdHViOiBbNDAsIDYwXSwgZ2FwOiAwLCBjb3JuZXJSYWRpdXM6IDUsIGFsd2F5c1Jlc3BlY3RTdHViczogdHJ1ZSB9XSxcbiAgICAgICAgICAgICAgICBjb25uZWN0b3JTdHlsZToge1xuICAgICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMixcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzk5OTk5OScsXG4gICAgICAgICAgICAgICAgICAgIGpvaW5zdHlsZTogJ3JvdW5kJyxcbiAgICAgICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogJ3doaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiAyXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBob3ZlclBhaW50U3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZmlsbDogJyMyMTY0NzcnLFxuICAgICAgICAgICAgICAgICAgICBzdHJva2U6ICcjMjE2NDc3J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29ubmVjdG9ySG92ZXJTdHlsZToge1xuICAgICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMyxcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzIxNjQ3NycsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogNSxcbiAgICAgICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogJ3doaXRlJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsb2NhdGlvbjogWzMsIC0xLjVdLCBjc3NDbGFzczogJ2VuZHBvaW50U291cmNlTGFiZWwnIH1dXSxcbiAgICAgICAgICAgICAgICBkcmFnT3B0aW9uczoge30sXG4gICAgICAgICAgICAgICAgdXVpZDogXCJcIi5jb25jYXQoYWN0aXZpdHkuaWQsIFwiLVwiKS5jb25jYXQob3V0Y29tZS5uYW1lKSxcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIG91dGNvbWU6IG91dGNvbWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldEFjdGl2aXR5ID0gZnVuY3Rpb24gKGlkLCBhY3Rpdml0aWVzKSB7XG4gICAgICAgICAgICBpZiAoYWN0aXZpdGllcyA9PT0gdm9pZCAwKSB7IGFjdGl2aXRpZXMgPSBudWxsOyB9XG4gICAgICAgICAgICBpZiAoIWFjdGl2aXRpZXMpIHtcbiAgICAgICAgICAgICAgICBhY3Rpdml0aWVzID0gdGhpcy53b3JrZmxvd1R5cGUuYWN0aXZpdGllcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkLmdyZXAoYWN0aXZpdGllcywgZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguaWQgPT09IGlkOyB9KVswXTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy51cGRhdGVDb25uZWN0aW9ucyA9IGZ1bmN0aW9uIChwbHVtYmVyKSB7XG4gICAgICAgICAgICB2YXIgd29ya2Zsb3dJZCA9IF90aGlzLndvcmtmbG93VHlwZS5pZDtcbiAgICAgICAgICAgIC8vIENvbm5lY3QgYWN0aXZpdGllcy5cbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBfdGhpcy53b3JrZmxvd1R5cGUudHJhbnNpdGlvbnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRyYW5zaXRpb25Nb2RlbCA9IF9hW19pXTtcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlRW5kcG9pbnRVdWlkID0gXCJcIi5jb25jYXQodHJhbnNpdGlvbk1vZGVsLnNvdXJjZUFjdGl2aXR5SWQsIFwiLVwiKS5jb25jYXQodHJhbnNpdGlvbk1vZGVsLnNvdXJjZU91dGNvbWVOYW1lKTtcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlRW5kcG9pbnQgPSBwbHVtYmVyLmdldEVuZHBvaW50KHNvdXJjZUVuZHBvaW50VXVpZCk7XG4gICAgICAgICAgICAgICAgdmFyIGRlc3RpbmF0aW9uRWxlbWVudElkID0gXCJhY3Rpdml0eS1cIi5jb25jYXQod29ya2Zsb3dJZCwgXCItXCIpLmNvbmNhdCh0cmFuc2l0aW9uTW9kZWwuZGVzdGluYXRpb25BY3Rpdml0eUlkKTtcbiAgICAgICAgICAgICAgICBwbHVtYmVyLmNvbm5lY3Qoe1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IHNvdXJjZUVuZHBvaW50LFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IGRlc3RpbmF0aW9uRWxlbWVudElkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudXBkYXRlQ2FudmFzSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyICRjb250YWluZXIgPSAkKHRoaXMuY29udGFpbmVyKTtcbiAgICAgICAgICAgIC8vIEdldCB0aGUgYWN0aXZpdHkgZWxlbWVudCB3aXRoIHRoZSBoaWdoZXN0IFkgY29vcmRpbmF0ZS5cbiAgICAgICAgICAgIHZhciAkYWN0aXZpdHlFbGVtZW50cyA9ICRjb250YWluZXIuZmluZChcIi5hY3Rpdml0eVwiKTtcbiAgICAgICAgICAgIHZhciBjdXJyZW50RWxlbWVudFRvcCA9IDA7XG4gICAgICAgICAgICB2YXIgY3VycmVudEFjdGl2aXR5SGVpZ2h0ID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSAkYWN0aXZpdHlFbGVtZW50cy50b0FycmF5KCk7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5RWxlbWVudCA9IF9hW19pXTtcbiAgICAgICAgICAgICAgICB2YXIgJGFjdGl2aXR5RWxlbWVudCA9ICQoYWN0aXZpdHlFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB2YXIgdG9wXzEgPSAkYWN0aXZpdHlFbGVtZW50LnBvc2l0aW9uKCkudG9wO1xuICAgICAgICAgICAgICAgIGlmICh0b3BfMSA+IGN1cnJlbnRFbGVtZW50VG9wKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRFbGVtZW50VG9wID0gdG9wXzE7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBY3Rpdml0eUhlaWdodCA9ICRhY3Rpdml0eUVsZW1lbnQuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG5ld0NhbnZhc0hlaWdodCA9IGN1cnJlbnRFbGVtZW50VG9wICsgY3VycmVudEFjdGl2aXR5SGVpZ2h0O1xuICAgICAgICAgICAgdmFyIGVsZW1lbnRCb3R0b20gPSBjdXJyZW50RWxlbWVudFRvcCArIGN1cnJlbnRBY3Rpdml0eUhlaWdodDtcbiAgICAgICAgICAgIHZhciBzdHJldGNoVmFsdWUgPSAxMDA7XG4gICAgICAgICAgICBpZiAobmV3Q2FudmFzSGVpZ2h0IC0gZWxlbWVudEJvdHRvbSA8PSBzdHJldGNoVmFsdWUpIHtcbiAgICAgICAgICAgICAgICBuZXdDYW52YXNIZWlnaHQgKz0gc3RyZXRjaFZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGNvbnRhaW5lci5oZWlnaHQoTWF0aC5tYXgodGhpcy5taW5DYW52YXNIZWlnaHQsIG5ld0NhbnZhc0hlaWdodCkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gV29ya2Zsb3dDYW52YXM7XG59KCkpO1xuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50cycgLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanNwbHVtYi90eXBpbmdzLmQudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1jYW52YXMudHMnIC8+XHJcblxyXG4vLyBUT0RPOiBSZS1pbXBsZW1lbnQgdGhpcyB1c2luZyBhIE1WVk0gYXBwcm9hY2guXHJcbmNsYXNzIFdvcmtmbG93RWRpdG9yIGV4dGVuZHMgV29ya2Zsb3dDYW52YXMge1xyXG4gICAgcHJpdmF0ZSBqc1BsdW1iSW5zdGFuY2U6IGpzUGx1bWJJbnN0YW5jZTtcclxuICAgIHByaXZhdGUgaXNQb3BvdmVyVmlzaWJsZTogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgaGFzRHJhZ2dlZDogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgZHJhZ1N0YXJ0OiBKUXVlcnkuQ29vcmRpbmF0ZXM7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHByb3RlY3RlZCB3b3JrZmxvd1R5cGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUsIHByaXZhdGUgZGVsZXRlQWN0aXZpdHlQcm9tcHQ6IHN0cmluZywgcHJpdmF0ZSBsb2NhbElkOiBzdHJpbmcsIGxvYWRMb2NhbFN0YXRlOiBib29sZWFuKSB7XHJcbiAgICAgICAgc3VwZXIoY29udGFpbmVyLCB3b3JrZmxvd1R5cGUpO1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBqc1BsdW1iLnJlYWR5KCgpID0+IHtcclxuICAgICAgICAgICAganNQbHVtYi5pbXBvcnREZWZhdWx0cyh0aGlzLmdldERlZmF1bHRzKCkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcGx1bWJlciA9IHRoaXMuY3JlYXRlSnNQbHVtYkluc3RhbmNlKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIG5ldyBjb25uZWN0aW9ucy5cclxuICAgICAgICAgICAgcGx1bWJlci5iaW5kKCdjb25uZWN0aW9uJywgZnVuY3Rpb24gKGNvbm5JbmZvLCBvcmlnaW5hbEV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uOiBDb25uZWN0aW9uID0gY29ubkluZm8uY29ubmVjdGlvbjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG91dGNvbWU6IFdvcmtmbG93cy5PdXRjb21lID0gY29ubmVjdGlvbi5nZXRQYXJhbWV0ZXJzKCkub3V0Y29tZTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbDogYW55ID0gY29ubmVjdGlvbi5nZXRPdmVybGF5KCdsYWJlbCcpO1xyXG4gICAgICAgICAgICAgICAgbGFiZWwuc2V0TGFiZWwob3V0Y29tZS5kaXNwbGF5TmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbGV0IGFjdGl2aXR5RWxlbWVudHMgPSB0aGlzLmdldEFjdGl2aXR5RWxlbWVudHMoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBhcmVFcXVhbE91dGNvbWVzID0gZnVuY3Rpb24gKG91dGNvbWVzMTogV29ya2Zsb3dzLk91dGNvbWVbXSwgb3V0Y29tZXMyOiBXb3JrZmxvd3MuT3V0Y29tZVtdKTogYm9vbGVhbiB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZXMxLmxlbmd0aCAhPSBvdXRjb21lczIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3V0Y29tZXMxLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3V0Y29tZTEgPSBvdXRjb21lczFbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3V0Y29tZTIgPSBvdXRjb21lczJbaV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvdXRjb21lMS5uYW1lICE9IG91dGNvbWUyLmRpc3BsYXlOYW1lIHx8IG91dGNvbWUxLmRpc3BsYXlOYW1lICE9IG91dGNvbWUyLmRpc3BsYXlOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFN1c3BlbmQgZHJhd2luZyBhbmQgaW5pdGlhbGl6ZS5cclxuICAgICAgICAgICAgcGx1bWJlci5iYXRjaCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VydmVyd29ya2Zsb3dUeXBlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0gdGhpcy53b3JrZmxvd1R5cGU7XHJcbiAgICAgICAgICAgICAgICB2YXIgd29ya2Zsb3dJZDogbnVtYmVyID0gdGhpcy53b3JrZmxvd1R5cGUuaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGxvYWRMb2NhbFN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYWxTdGF0ZTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9IHRoaXMubG9hZExvY2FsU3RhdGUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsU3RhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53b3JrZmxvd1R5cGUgPSBsb2NhbFN0YXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLmVhY2goKF8sIGFjdGl2aXR5RWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0ICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktaWQnKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0RlbGV0ZWQgPSB0aGlzLndvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcy5pbmRleE9mKGFjdGl2aXR5SWQpID4gLTE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0RlbGV0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGl2aXR5RWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGFjdGl2aXR5ID0gdGhpcy5nZXRBY3Rpdml0eShhY3Rpdml0eUlkKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXJ2ZXJBY3Rpdml0eSA9IHRoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCwgc2VydmVyd29ya2Zsb3dUeXBlLmFjdGl2aXRpZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGFjdGl2aXR5J3MgdmlzdWFsIHN0YXRlLlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2FkTG9jYWxTdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZpdHkgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIG5ld2x5IGFkZGVkIGFjdGl2aXR5IG5vdCB5ZXQgYWRkZWQgdG8gbG9jYWwgc3RhdGUuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eSA9IHNlcnZlckFjdGl2aXR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53b3JrZmxvd1R5cGUuYWN0aXZpdGllcy5wdXNoKGFjdGl2aXR5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS54ID0gNTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS55ID0gNTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgYXZhaWxhYmxlIG91dGNvbWVzIG1pZ2h0IGhhdmUgY2hhbmdlZCB3aGVuIGVkaXRpbmcgYW4gYWN0aXZpdHksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSBuZWVkIHRvIGNoZWNrIGZvciB0aGF0IGFuZCB1cGRhdGUgdGhlIGNsaWVudCdzIGFjdGl2aXR5IG91dGNvbWVzIGlmIHNvLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FtZU91dGNvbWVzID0gYXJlRXF1YWxPdXRjb21lcyhhY3Rpdml0eS5vdXRjb21lcywgc2VydmVyQWN0aXZpdHkub3V0Y29tZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2FtZU91dGNvbWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkub3V0Y29tZXMgPSBzZXJ2ZXJBY3Rpdml0eS5vdXRjb21lcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZpdHlFbGVtZW50XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNzcyh7IGxlZnQ6IGFjdGl2aXR5LngsIHRvcDogYWN0aXZpdHkueSB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50b2dnbGVDbGFzcygnYWN0aXZpdHktc3RhcnQnLCBhY3Rpdml0eS5pc1N0YXJ0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKCdhY3Rpdml0eS1zdGFydCcsIGFjdGl2aXR5LmlzU3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHRoZSBhY3Rpdml0eSBkcmFnZ2FibGUuXHJcbiAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5kcmFnZ2FibGUoYWN0aXZpdHlFbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWQ6IFsxMCwgMTBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWlubWVudDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IChhcmdzOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ1N0YXJ0ID0geyBsZWZ0OiBhcmdzLmUuc2NyZWVuWCwgdG9wOiBhcmdzLmUuc2NyZWVuWSB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdG9wOiAoYXJnczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc0RyYWdnZWQgPSB0aGlzLmRyYWdTdGFydC5sZWZ0ICE9IGFyZ3MuZS5zY3JlZW5YIHx8IHRoaXMuZHJhZ1N0YXJ0LnRvcCAhPSBhcmdzLmUuc2NyZWVuWTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29uZmlndXJlIHRoZSBhY3Rpdml0eSBhcyBhIHRhcmdldC5cclxuICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLm1ha2VUYXJnZXQoYWN0aXZpdHlFbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BPcHRpb25zOiB7IGhvdmVyQ2xhc3M6ICdob3ZlcicgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiAnQ29udGludW91cycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiBbJ0JsYW5rJywgeyByYWRpdXM6IDggfV1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNvdXJjZSBlbmRwb2ludHMuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgb3V0Y29tZSBvZiBhY3Rpdml0eS5vdXRjb21lcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VFbmRwb2ludE9wdGlvbnMgPSB0aGlzLmdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyhhY3Rpdml0eSwgb3V0Y29tZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsdW1iZXIuYWRkRW5kcG9pbnQoYWN0aXZpdHlFbGVtZW50LCB7IGNvbm5lY3Rvck92ZXJsYXlzOiBbWydMYWJlbCcsIHsgbGFiZWw6IG91dGNvbWUuZGlzcGxheU5hbWUsIGNzc0NsYXNzOiAnY29ubmVjdGlvbi1sYWJlbCcgfV1dIH0sIHNvdXJjZUVuZHBvaW50T3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ29ubmVjdCBhY3Rpdml0aWVzLlxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDb25uZWN0aW9ucyhwbHVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZS1xdWVyeSB0aGUgYWN0aXZpdHkgZWxlbWVudHMuXHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzID0gdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTWFrZSBhbGwgYWN0aXZpdHkgZWxlbWVudHMgdmlzaWJsZS5cclxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuc2hvdygpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBwb3BvdmVycy5cclxuICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5lYWNoKChfLCBpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlFbGVtZW50ID0gJChpdGVtKTtcclxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC5wb3BvdmVyKHtcclxuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiAnbWFudWFsJyxcclxuICAgICAgICAgICAgICAgICAgICBodG1sOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgJGNvbnRlbnQ6IEpRdWVyeTxFbGVtZW50PiA9IGFjdGl2aXR5RWxlbWVudC5maW5kKCcuYWN0aXZpdHktY29tbWFuZHMnKS5jbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydEJ1dHRvbiA9ICRjb250ZW50LmZpbmQoJy5hY3Rpdml0eS1zdGFydC1hY3Rpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNTdGFydCA9IGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcpID09PSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlkOiBudW1iZXIgPSBhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktaWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRCdXR0b24uYXR0cignYXJpYS1wcmVzc2VkJywgYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LXN0YXJ0JykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEJ1dHRvbi50b2dnbGVDbGFzcygnYWN0aXZlJywgaXNTdGFydCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkY29udGVudC5vbignY2xpY2snLCAnLmFjdGl2aXR5LXN0YXJ0LWFjdGlvbicsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzU3RhcnQgPSBidXR0b24uaXMoJy5hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcsIGlzU3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50LnRvZ2dsZUNsYXNzKCdhY3Rpdml0eS1zdGFydCcsIGlzU3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50Lm9uKCdjbGljaycsICcuYWN0aXZpdHktZGVsZXRlLWFjdGlvbicsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFRoZSBwcm9tcHRzIGFyZSByZWFsbHkgYW5ub3lpbmcuIENvbnNpZGVyIHNob3dpbmcgc29tZSBzb3J0IG9mIHNtYWxsIG1lc3NhZ2UgYmFsbG9vbiBzb21ld2hlcmUgdG8gdW5kbyB0aGUgYWN0aW9uIGluc3RlYWQuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmICghY29uZmlybShzZWxmLmRlbGV0ZUFjdGl2aXR5UHJvbXB0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy99XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi53b3JrZmxvd1R5cGUucmVtb3ZlZEFjdGl2aXRpZXMucHVzaChhY3Rpdml0eUlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsdW1iZXIucmVtb3ZlKGFjdGl2aXR5RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnQucG9wb3ZlcignZGlzcG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50Lm9uKCdjbGljaycsICdbZGF0YS1wZXJzaXN0LXdvcmtmbG93XScsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYXZlTG9jYWxTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkY29udGVudC5nZXQoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICAkKGNvbnRhaW5lcikub24oJ2NsaWNrJywgJy5hY3Rpdml0eScsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzRHJhZ2dlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzRHJhZ2dlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpZiBhbnkgb3RoZXIgcG9wb3ZlcnMgYXJlIHZpc2libGUsIGhpZGUgdGhlbVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNQb3BvdmVyVmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMucG9wb3ZlcignaGlkZScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIHNlbmRlci5wb3BvdmVyKCdzaG93Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIGNsaWNraW5nIG9uIHRoZSBwb3BvdmVyIGl0c2VsZi5cclxuICAgICAgICAgICAgICAgICQoJy5wb3BvdmVyJykub2ZmKCdjbGljaycpLm9uKCdjbGljaycsIGUyID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBlMi5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNQb3BvdmVyVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChjb250YWluZXIpLm9uKCdkYmxjbGljaycsICcuYWN0aXZpdHknLCBlID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhhc0VkaXRvciA9IHNlbmRlci5kYXRhKCdhY3Rpdml0eS1oYXMtZWRpdG9yJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGhhc0VkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZUxvY2FsU3RhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZW5kZXIuZmluZCgnLmFjdGl2aXR5LWVkaXQtYWN0aW9uJykuZ2V0KDApLmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gSGlkZSBhbGwgcG9wb3ZlcnMgd2hlbiBjbGlja2luZyBhbnl3aGVyZSBidXQgb24gYW4gYWN0aXZpdHkuXHJcbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCBlID0+IHtcclxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMucG9wb3ZlcignaGlkZScpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc1BvcG92ZXJWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gU2F2ZSBsb2NhbCBjaGFuZ2VzIGlmIHRoZSBldmVudCB0YXJnZXQgaGFzIHRoZSAnZGF0YS1wZXJzaXN0LXdvcmtmbG93JyBhdHRyaWJ1dGUuXHJcbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCAnW2RhdGEtcGVyc2lzdC13b3JrZmxvd10nLCBlID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZUxvY2FsU3RhdGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmpzUGx1bWJJbnN0YW5jZSA9IHBsdW1iZXI7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRTdGF0ZSA9ICgpOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0+IHtcclxuICAgICAgICBjb25zdCAkYWxsQWN0aXZpdHlFbGVtZW50cyA9ICQodGhpcy5jb250YWluZXIpLmZpbmQoJy5hY3Rpdml0eScpO1xyXG4gICAgICAgIGNvbnN0IHdvcmtmbG93OiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0ge1xyXG4gICAgICAgICAgICBpZDogdGhpcy53b3JrZmxvd1R5cGUuaWQsXHJcbiAgICAgICAgICAgIGFjdGl2aXRpZXM6IFtdLFxyXG4gICAgICAgICAgICB0cmFuc2l0aW9uczogW10sXHJcbiAgICAgICAgICAgIHJlbW92ZWRBY3Rpdml0aWVzOiB0aGlzLndvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllc1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIENvbGxlY3QgYWN0aXZpdGllcy5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8ICRhbGxBY3Rpdml0eUVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0ICRhY3Rpdml0eUVsZW1lbnQ6IEpRdWVyeSA9ICQoJGFsbEFjdGl2aXR5RWxlbWVudHNbaV0pO1xyXG4gICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlkOiBzdHJpbmcgPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5SXNTdGFydDogYm9vbGVhbiA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnKTtcclxuICAgICAgICAgICAgY29uc3QgYWN0aXZpdHlJc0V2ZW50OiBib29sZWFuID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS10eXBlJykgPT09ICdFdmVudCc7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5UG9zaXRpb246IEpRdWVyeS5Db29yZGluYXRlcyA9ICRhY3Rpdml0eUVsZW1lbnQucG9zaXRpb24oKTtcclxuICAgICAgICAgICAgY29uc3QgYWN0aXZpdHk6IFdvcmtmbG93cy5BY3Rpdml0eSA9IHRoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCk7XHJcblxyXG4gICAgICAgICAgICB3b3JrZmxvdy5hY3Rpdml0aWVzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgaWQ6IGFjdGl2aXR5SWQsXHJcbiAgICAgICAgICAgICAgICBpc1N0YXJ0OiBhY3Rpdml0eUlzU3RhcnQsXHJcbiAgICAgICAgICAgICAgICBpc0V2ZW50OiBhY3Rpdml0eUlzRXZlbnQsXHJcbiAgICAgICAgICAgICAgICBvdXRjb21lczogYWN0aXZpdHkub3V0Y29tZXMsXHJcbiAgICAgICAgICAgICAgICB4OiBhY3Rpdml0eVBvc2l0aW9uLmxlZnQsXHJcbiAgICAgICAgICAgICAgICB5OiBhY3Rpdml0eVBvc2l0aW9uLnRvcFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENvbGxlY3QgY29ubmVjdGlvbnMuXHJcbiAgICAgICAgY29uc3QgYWxsQ29ubmVjdGlvbnMgPSB0aGlzLmpzUGx1bWJJbnN0YW5jZS5nZXRDb25uZWN0aW9ucygpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsbENvbm5lY3Rpb25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBjb25uZWN0aW9uID0gYWxsQ29ubmVjdGlvbnNbaV07XHJcbiAgICAgICAgICAgIHZhciBzb3VyY2VFbmRwb2ludDogRW5kcG9pbnQgPSBjb25uZWN0aW9uLmVuZHBvaW50c1swXTtcclxuICAgICAgICAgICAgdmFyIHNvdXJjZU91dGNvbWVOYW1lID0gc291cmNlRW5kcG9pbnQuZ2V0UGFyYW1ldGVycygpLm91dGNvbWUubmFtZTtcclxuICAgICAgICAgICAgdmFyIHNvdXJjZUFjdGl2aXR5SWQ6IHN0cmluZyA9ICQoY29ubmVjdGlvbi5zb3VyY2UpLmRhdGEoJ2FjdGl2aXR5LWlkJyk7XHJcbiAgICAgICAgICAgIHZhciBkZXN0aW5hdGlvbkFjdGl2aXR5SWQ6IHN0cmluZyA9ICQoY29ubmVjdGlvbi50YXJnZXQpLmRhdGEoJ2FjdGl2aXR5LWlkJyk7XHJcblxyXG4gICAgICAgICAgICB3b3JrZmxvdy50cmFuc2l0aW9ucy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIHNvdXJjZUFjdGl2aXR5SWQ6IHNvdXJjZUFjdGl2aXR5SWQsXHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbkFjdGl2aXR5SWQ6IGRlc3RpbmF0aW9uQWN0aXZpdHlJZCxcclxuICAgICAgICAgICAgICAgIHNvdXJjZU91dGNvbWVOYW1lOiBzb3VyY2VPdXRjb21lTmFtZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB3b3JrZmxvdztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2VyaWFsaXplID0gKCk6IHN0cmluZyA9PiB7XHJcbiAgICAgICAgY29uc3Qgd29ya2Zsb3c6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUgPSB0aGlzLmdldFN0YXRlKCk7XHJcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHdvcmtmbG93KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNhdmVMb2NhbFN0YXRlID0gKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgIHNlc3Npb25TdG9yYWdlW3RoaXMubG9jYWxJZF0gPSB0aGlzLnNlcmlhbGl6ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9hZExvY2FsU3RhdGUgPSAoKTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2VbdGhpcy5sb2NhbElkXSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbiQuZm4ud29ya2Zsb3dFZGl0b3IgPSBmdW5jdGlvbiAodGhpczogSlF1ZXJ5KTogSlF1ZXJ5IHtcclxuICAgIHRoaXMuZWFjaCgoaW5kZXgsIGVsZW1lbnQpID0+IHtcclxuICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xyXG4gICAgICAgIHZhciB3b3JrZmxvd1R5cGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy10eXBlJyk7XHJcbiAgICAgICAgdmFyIGRlbGV0ZUFjdGl2aXR5UHJvbXB0OiBzdHJpbmcgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy1kZWxldGUtYWN0aXZpdHktcHJvbXB0Jyk7XHJcbiAgICAgICAgdmFyIGxvY2FsSWQ6IHN0cmluZyA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LWxvY2FsLWlkJyk7XHJcbiAgICAgICAgdmFyIGxvYWRMb2NhbFN0YXRlOiBib29sZWFuID0gJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3ctbG9hZC1sb2NhbC1zdGF0ZScpO1xyXG5cclxuICAgICAgICB3b3JrZmxvd1R5cGUucmVtb3ZlZEFjdGl2aXRpZXMgPSB3b3JrZmxvd1R5cGUucmVtb3ZlZEFjdGl2aXRpZXMgfHwgW107XHJcbiAgICAgICAgJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3dFZGl0b3InLCBuZXcgV29ya2Zsb3dFZGl0b3IoZWxlbWVudCwgd29ya2Zsb3dUeXBlLCBkZWxldGVBY3Rpdml0eVByb21wdCwgbG9jYWxJZCwgbG9hZExvY2FsU3RhdGUpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3Qgd29ya2Zsb3dFZGl0b3I6IFdvcmtmbG93RWRpdG9yID0gJCgnLndvcmtmbG93LWNhbnZhcycpLndvcmtmbG93RWRpdG9yKCkuZGF0YSgnd29ya2Zsb3dFZGl0b3InKTtcclxuXHJcbiAgICAkKCcjd29ya2Zsb3dFZGl0b3JGb3JtJykub24oJ3N1Ym1pdCcsIChzLCBlKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc3RhdGUgPSB3b3JrZmxvd0VkaXRvci5zZXJpYWxpemUoKTtcclxuICAgICAgICAkKCcjd29ya2Zsb3dTdGF0ZUlucHV0JykudmFsKHN0YXRlKTtcclxuICAgIH0pO1xyXG59KTtcclxuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPScuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pzcGx1bWIvdHlwaW5ncy5kLnRzJyAvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPScuL3dvcmtmbG93LW1vZGVscy50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1jYW52YXMudHMnIC8+XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuLy8gVE9ETzogUmUtaW1wbGVtZW50IHRoaXMgdXNpbmcgYSBNVlZNIGFwcHJvYWNoLlxudmFyIFdvcmtmbG93RWRpdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhXb3JrZmxvd0VkaXRvciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBXb3JrZmxvd0VkaXRvcihjb250YWluZXIsIHdvcmtmbG93VHlwZSwgZGVsZXRlQWN0aXZpdHlQcm9tcHQsIGxvY2FsSWQsIGxvYWRMb2NhbFN0YXRlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGNvbnRhaW5lciwgd29ya2Zsb3dUeXBlKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICAgIF90aGlzLndvcmtmbG93VHlwZSA9IHdvcmtmbG93VHlwZTtcbiAgICAgICAgX3RoaXMuZGVsZXRlQWN0aXZpdHlQcm9tcHQgPSBkZWxldGVBY3Rpdml0eVByb21wdDtcbiAgICAgICAgX3RoaXMubG9jYWxJZCA9IGxvY2FsSWQ7XG4gICAgICAgIF90aGlzLmdldFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyICRhbGxBY3Rpdml0eUVsZW1lbnRzID0gJChfdGhpcy5jb250YWluZXIpLmZpbmQoJy5hY3Rpdml0eScpO1xuICAgICAgICAgICAgdmFyIHdvcmtmbG93ID0ge1xuICAgICAgICAgICAgICAgIGlkOiBfdGhpcy53b3JrZmxvd1R5cGUuaWQsXG4gICAgICAgICAgICAgICAgYWN0aXZpdGllczogW10sXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbnM6IFtdLFxuICAgICAgICAgICAgICAgIHJlbW92ZWRBY3Rpdml0aWVzOiBfdGhpcy53b3JrZmxvd1R5cGUucmVtb3ZlZEFjdGl2aXRpZXNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBDb2xsZWN0IGFjdGl2aXRpZXMuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRhbGxBY3Rpdml0eUVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyICRhY3Rpdml0eUVsZW1lbnQgPSAkKCRhbGxBY3Rpdml0eUVsZW1lbnRzW2ldKTtcbiAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlJZCA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktaWQnKTtcbiAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlJc1N0YXJ0ID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcpO1xuICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eUlzRXZlbnQgPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LXR5cGUnKSA9PT0gJ0V2ZW50JztcbiAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlQb3NpdGlvbiA9ICRhY3Rpdml0eUVsZW1lbnQucG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHkgPSBfdGhpcy5nZXRBY3Rpdml0eShhY3Rpdml0eUlkKTtcbiAgICAgICAgICAgICAgICB3b3JrZmxvdy5hY3Rpdml0aWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgICAgICAgICAgaXNTdGFydDogYWN0aXZpdHlJc1N0YXJ0LFxuICAgICAgICAgICAgICAgICAgICBpc0V2ZW50OiBhY3Rpdml0eUlzRXZlbnQsXG4gICAgICAgICAgICAgICAgICAgIG91dGNvbWVzOiBhY3Rpdml0eS5vdXRjb21lcyxcbiAgICAgICAgICAgICAgICAgICAgeDogYWN0aXZpdHlQb3NpdGlvbi5sZWZ0LFxuICAgICAgICAgICAgICAgICAgICB5OiBhY3Rpdml0eVBvc2l0aW9uLnRvcFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQ29sbGVjdCBjb25uZWN0aW9ucy5cbiAgICAgICAgICAgIHZhciBhbGxDb25uZWN0aW9ucyA9IF90aGlzLmpzUGx1bWJJbnN0YW5jZS5nZXRDb25uZWN0aW9ucygpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbGxDb25uZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBjb25uZWN0aW9uID0gYWxsQ29ubmVjdGlvbnNbaV07XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50ID0gY29ubmVjdGlvbi5lbmRwb2ludHNbMF07XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZU91dGNvbWVOYW1lID0gc291cmNlRW5kcG9pbnQuZ2V0UGFyYW1ldGVycygpLm91dGNvbWUubmFtZTtcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlQWN0aXZpdHlJZCA9ICQoY29ubmVjdGlvbi5zb3VyY2UpLmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgICAgICAgICAgdmFyIGRlc3RpbmF0aW9uQWN0aXZpdHlJZCA9ICQoY29ubmVjdGlvbi50YXJnZXQpLmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgICAgICAgICAgd29ya2Zsb3cudHJhbnNpdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZUFjdGl2aXR5SWQ6IHNvdXJjZUFjdGl2aXR5SWQsXG4gICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uQWN0aXZpdHlJZDogZGVzdGluYXRpb25BY3Rpdml0eUlkLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VPdXRjb21lTmFtZTogc291cmNlT3V0Y29tZU5hbWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3b3JrZmxvdztcbiAgICAgICAgfTtcbiAgICAgICAgX3RoaXMuc2VyaWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHdvcmtmbG93ID0gX3RoaXMuZ2V0U3RhdGUoKTtcbiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh3b3JrZmxvdyk7XG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLnNhdmVMb2NhbFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2VbX3RoaXMubG9jYWxJZF0gPSBfdGhpcy5zZXJpYWxpemUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgX3RoaXMubG9hZExvY2FsU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZVtfdGhpcy5sb2NhbElkXSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBzZWxmID0gX3RoaXM7XG4gICAgICAgIGpzUGx1bWIucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAganNQbHVtYi5pbXBvcnREZWZhdWx0cyhfdGhpcy5nZXREZWZhdWx0cygpKTtcbiAgICAgICAgICAgIHZhciBwbHVtYmVyID0gX3RoaXMuY3JlYXRlSnNQbHVtYkluc3RhbmNlKCk7XG4gICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIG5ldyBjb25uZWN0aW9ucy5cbiAgICAgICAgICAgIHBsdW1iZXIuYmluZCgnY29ubmVjdGlvbicsIGZ1bmN0aW9uIChjb25uSW5mbywgb3JpZ2luYWxFdmVudCkge1xuICAgICAgICAgICAgICAgIHZhciBjb25uZWN0aW9uID0gY29ubkluZm8uY29ubmVjdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IGNvbm5lY3Rpb24uZ2V0UGFyYW1ldGVycygpLm91dGNvbWU7XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gY29ubmVjdGlvbi5nZXRPdmVybGF5KCdsYWJlbCcpO1xuICAgICAgICAgICAgICAgIGxhYmVsLnNldExhYmVsKG91dGNvbWUuZGlzcGxheU5hbWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgYWN0aXZpdHlFbGVtZW50cyA9IF90aGlzLmdldEFjdGl2aXR5RWxlbWVudHMoKTtcbiAgICAgICAgICAgIHZhciBhcmVFcXVhbE91dGNvbWVzID0gZnVuY3Rpb24gKG91dGNvbWVzMSwgb3V0Y29tZXMyKSB7XG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWVzMS5sZW5ndGggIT0gb3V0Y29tZXMyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3V0Y29tZXMxLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvdXRjb21lMSA9IG91dGNvbWVzMVtpXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG91dGNvbWUyID0gb3V0Y29tZXMyW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAob3V0Y29tZTEubmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSB8fCBvdXRjb21lMS5kaXNwbGF5TmFtZSAhPSBvdXRjb21lMi5kaXNwbGF5TmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIFN1c3BlbmQgZHJhd2luZyBhbmQgaW5pdGlhbGl6ZS5cbiAgICAgICAgICAgIHBsdW1iZXIuYmF0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXJ3b3JrZmxvd1R5cGUgPSBfdGhpcy53b3JrZmxvd1R5cGU7XG4gICAgICAgICAgICAgICAgdmFyIHdvcmtmbG93SWQgPSBfdGhpcy53b3JrZmxvd1R5cGUuaWQ7XG4gICAgICAgICAgICAgICAgaWYgKGxvYWRMb2NhbFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsb2NhbFN0YXRlID0gX3RoaXMubG9hZExvY2FsU3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsU3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLndvcmtmbG93VHlwZSA9IGxvY2FsU3RhdGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5lYWNoKGZ1bmN0aW9uIChfLCBhY3Rpdml0eUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eUlkID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1pZCcpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXNEZWxldGVkID0gX3RoaXMud29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzLmluZGV4T2YoYWN0aXZpdHlJZCkgPiAtMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGVsZXRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGl2aXR5RWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHkgPSBfdGhpcy5nZXRBY3Rpdml0eShhY3Rpdml0eUlkKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlcnZlckFjdGl2aXR5ID0gX3RoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCwgc2VydmVyd29ya2Zsb3dUeXBlLmFjdGl2aXRpZXMpO1xuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGFjdGl2aXR5J3MgdmlzdWFsIHN0YXRlLlxuICAgICAgICAgICAgICAgICAgICBpZiAobG9hZExvY2FsU3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpdml0eSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIG5ld2x5IGFkZGVkIGFjdGl2aXR5IG5vdCB5ZXQgYWRkZWQgdG8gbG9jYWwgc3RhdGUuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkgPSBzZXJ2ZXJBY3Rpdml0eTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy53b3JrZmxvd1R5cGUuYWN0aXZpdGllcy5wdXNoKGFjdGl2aXR5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS54ID0gNTA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkueSA9IDUwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGF2YWlsYWJsZSBvdXRjb21lcyBtaWdodCBoYXZlIGNoYW5nZWQgd2hlbiBlZGl0aW5nIGFuIGFjdGl2aXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIG5lZWQgdG8gY2hlY2sgZm9yIHRoYXQgYW5kIHVwZGF0ZSB0aGUgY2xpZW50J3MgYWN0aXZpdHkgb3V0Y29tZXMgaWYgc28uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNhbWVPdXRjb21lcyA9IGFyZUVxdWFsT3V0Y29tZXMoYWN0aXZpdHkub3V0Y29tZXMsIHNlcnZlckFjdGl2aXR5Lm91dGNvbWVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNhbWVPdXRjb21lcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5vdXRjb21lcyA9IHNlcnZlckFjdGl2aXR5Lm91dGNvbWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZpdHlFbGVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoeyBsZWZ0OiBhY3Rpdml0eS54LCB0b3A6IGFjdGl2aXR5LnkgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRvZ2dsZUNsYXNzKCdhY3Rpdml0eS1zdGFydCcsIGFjdGl2aXR5LmlzU3RhcnQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKCdhY3Rpdml0eS1zdGFydCcsIGFjdGl2aXR5LmlzU3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIGFjdGl2aXR5IGRyYWdnYWJsZS5cbiAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5kcmFnZ2FibGUoYWN0aXZpdHlFbGVtZW50LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkOiBbMTAsIDEwXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5tZW50OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhZ1N0YXJ0ID0geyBsZWZ0OiBhcmdzLmUuc2NyZWVuWCwgdG9wOiBhcmdzLmUuc2NyZWVuWSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaGFzRHJhZ2dlZCA9IF90aGlzLmRyYWdTdGFydC5sZWZ0ICE9IGFyZ3MuZS5zY3JlZW5YIHx8IF90aGlzLmRyYWdTdGFydC50b3AgIT0gYXJncy5lLnNjcmVlblk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBDb25maWd1cmUgdGhlIGFjdGl2aXR5IGFzIGEgdGFyZ2V0LlxuICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLm1ha2VUYXJnZXQoYWN0aXZpdHlFbGVtZW50LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wT3B0aW9uczogeyBob3ZlckNsYXNzOiAnaG92ZXInIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiBbJ0JsYW5rJywgeyByYWRpdXM6IDggfV1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCBzb3VyY2UgZW5kcG9pbnRzLlxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gYWN0aXZpdHkub3V0Y29tZXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IF9hW19pXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2VFbmRwb2ludE9wdGlvbnMgPSBfdGhpcy5nZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMoYWN0aXZpdHksIG91dGNvbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5hZGRFbmRwb2ludChhY3Rpdml0eUVsZW1lbnQsIHsgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsYWJlbDogb3V0Y29tZS5kaXNwbGF5TmFtZSwgY3NzQ2xhc3M6ICdjb25uZWN0aW9uLWxhYmVsJyB9XV0gfSwgc291cmNlRW5kcG9pbnRPcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIENvbm5lY3QgYWN0aXZpdGllcy5cbiAgICAgICAgICAgICAgICBfdGhpcy51cGRhdGVDb25uZWN0aW9ucyhwbHVtYmVyKTtcbiAgICAgICAgICAgICAgICAvLyBSZS1xdWVyeSB0aGUgYWN0aXZpdHkgZWxlbWVudHMuXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cyA9IF90aGlzLmdldEFjdGl2aXR5RWxlbWVudHMoKTtcbiAgICAgICAgICAgICAgICAvLyBNYWtlIGFsbCBhY3Rpdml0eSBlbGVtZW50cyB2aXNpYmxlLlxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuc2hvdygpO1xuICAgICAgICAgICAgICAgIF90aGlzLnVwZGF0ZUNhbnZhc0hlaWdodCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIHBvcG92ZXJzLlxuICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5lYWNoKGZ1bmN0aW9uIChfLCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5RWxlbWVudCA9ICQoaXRlbSk7XG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50LnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiAnbWFudWFsJyxcbiAgICAgICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjb250ZW50ID0gYWN0aXZpdHlFbGVtZW50LmZpbmQoJy5hY3Rpdml0eS1jb21tYW5kcycpLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRCdXR0b24gPSAkY29udGVudC5maW5kKCcuYWN0aXZpdHktc3RhcnQtYWN0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNTdGFydCA9IGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcpID09PSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5SWQgPSBhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0QnV0dG9uLmF0dHIoJ2FyaWEtcHJlc3NlZCcsIGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0QnV0dG9uLnRvZ2dsZUNsYXNzKCdhY3RpdmUnLCBpc1N0YXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50Lm9uKCdjbGljaycsICcuYWN0aXZpdHktc3RhcnQtYWN0aW9uJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNTdGFydCA9IGJ1dHRvbi5pcygnLmFjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcsIGlzU3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC50b2dnbGVDbGFzcygnYWN0aXZpdHktc3RhcnQnLCBpc1N0YXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnQub24oJ2NsaWNrJywgJy5hY3Rpdml0eS1kZWxldGUtYWN0aW9uJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogVGhlIHByb21wdHMgYXJlIHJlYWxseSBhbm5veWluZy4gQ29uc2lkZXIgc2hvd2luZyBzb21lIHNvcnQgb2Ygc21hbGwgbWVzc2FnZSBiYWxsb29uIHNvbWV3aGVyZSB0byB1bmRvIHRoZSBhY3Rpb24gaW5zdGVhZC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmICghY29uZmlybShzZWxmLmRlbGV0ZUFjdGl2aXR5UHJvbXB0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLndvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcy5wdXNoKGFjdGl2aXR5SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsdW1iZXIucmVtb3ZlKGFjdGl2aXR5RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50LnBvcG92ZXIoJ2Rpc3Bvc2UnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnQub24oJ2NsaWNrJywgJ1tkYXRhLXBlcnNpc3Qtd29ya2Zsb3ddJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNhdmVMb2NhbFN0YXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkY29udGVudC5nZXQoMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJChjb250YWluZXIpLm9uKCdjbGljaycsICcuYWN0aXZpdHknLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNEcmFnZ2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmhhc0RyYWdnZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBpZiBhbnkgb3RoZXIgcG9wb3ZlcnMgYXJlIHZpc2libGUsIGhpZGUgdGhlbVxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5pc1BvcG92ZXJWaXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMucG9wb3ZlcignaGlkZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgc2VuZGVyID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICAgICAgICAgIHNlbmRlci5wb3BvdmVyKCdzaG93Jyk7XG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIGNsaWNraW5nIG9uIHRoZSBwb3BvdmVyIGl0c2VsZi5cbiAgICAgICAgICAgICAgICAkKCcucG9wb3ZlcicpLm9mZignY2xpY2snKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZTIpIHtcbiAgICAgICAgICAgICAgICAgICAgZTIuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5pc1BvcG92ZXJWaXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJChjb250YWluZXIpLm9uKCdkYmxjbGljaycsICcuYWN0aXZpdHknLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHZhciBzZW5kZXIgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgICAgICAgICAgICAgdmFyIGhhc0VkaXRvciA9IHNlbmRlci5kYXRhKCdhY3Rpdml0eS1oYXMtZWRpdG9yJyk7XG4gICAgICAgICAgICAgICAgaWYgKGhhc0VkaXRvcikge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zYXZlTG9jYWxTdGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBzZW5kZXIuZmluZCgnLmFjdGl2aXR5LWVkaXQtYWN0aW9uJykuZ2V0KDApLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBIaWRlIGFsbCBwb3BvdmVycyB3aGVuIGNsaWNraW5nIGFueXdoZXJlIGJ1dCBvbiBhbiBhY3Rpdml0eS5cbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMucG9wb3ZlcignaGlkZScpO1xuICAgICAgICAgICAgICAgIF90aGlzLmlzUG9wb3ZlclZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gU2F2ZSBsb2NhbCBjaGFuZ2VzIGlmIHRoZSBldmVudCB0YXJnZXQgaGFzIHRoZSAnZGF0YS1wZXJzaXN0LXdvcmtmbG93JyBhdHRyaWJ1dGUuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJ1tkYXRhLXBlcnNpc3Qtd29ya2Zsb3ddJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5zYXZlTG9jYWxTdGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBfdGhpcy5qc1BsdW1iSW5zdGFuY2UgPSBwbHVtYmVyO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gV29ya2Zsb3dFZGl0b3I7XG59KFdvcmtmbG93Q2FudmFzKSk7XG4kLmZuLndvcmtmbG93RWRpdG9yID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyICRlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdmFyIHdvcmtmbG93VHlwZSA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LXR5cGUnKTtcbiAgICAgICAgdmFyIGRlbGV0ZUFjdGl2aXR5UHJvbXB0ID0gJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3ctZGVsZXRlLWFjdGl2aXR5LXByb21wdCcpO1xuICAgICAgICB2YXIgbG9jYWxJZCA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LWxvY2FsLWlkJyk7XG4gICAgICAgIHZhciBsb2FkTG9jYWxTdGF0ZSA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LWxvYWQtbG9jYWwtc3RhdGUnKTtcbiAgICAgICAgd29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzID0gd29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzIHx8IFtdO1xuICAgICAgICAkZWxlbWVudC5kYXRhKCd3b3JrZmxvd0VkaXRvcicsIG5ldyBXb3JrZmxvd0VkaXRvcihlbGVtZW50LCB3b3JrZmxvd1R5cGUsIGRlbGV0ZUFjdGl2aXR5UHJvbXB0LCBsb2NhbElkLCBsb2FkTG9jYWxTdGF0ZSkpO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzO1xufTtcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgd29ya2Zsb3dFZGl0b3IgPSAkKCcud29ya2Zsb3ctY2FudmFzJykud29ya2Zsb3dFZGl0b3IoKS5kYXRhKCd3b3JrZmxvd0VkaXRvcicpO1xuICAgICQoJyN3b3JrZmxvd0VkaXRvckZvcm0nKS5vbignc3VibWl0JywgZnVuY3Rpb24gKHMsIGUpIHtcbiAgICAgICAgdmFyIHN0YXRlID0gd29ya2Zsb3dFZGl0b3Iuc2VyaWFsaXplKCk7XG4gICAgICAgICQoJyN3b3JrZmxvd1N0YXRlSW5wdXQnKS52YWwoc3RhdGUpO1xuICAgIH0pO1xufSk7XG4iXX0=
